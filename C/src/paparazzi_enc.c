// Generated enums and structures for Mavlink dialect paparazzi #0 version 3
// Generated by gomavlink, DO NOT EDIT.

#include <assert.h>
#include <string.h>

#include "paparazzi.h"

// defined in paparazzi_crc.h
uint8_t paparazzi_crcextra(enum PAPARAZZI_MESSAGE mid);

inline static void append_byte(uint8_t **p, uint8_t v) { *(*p)++ = v; }
inline static void append_int8(uint8_t **p, int8_t v) { *(*p)++ = v; }
inline static void append_int16(uint8_t **p, int16_t v) {
  *(*p)++ = v;
  *(*p)++ = v >> 8;
}
inline static void append_uint16(uint8_t **p, uint16_t v) {
  *(*p)++ = v;
  *(*p)++ = v >> 8;
}
inline static void append_int32(uint8_t **p, int32_t v) {
  *(*p)++ = v;
  *(*p)++ = v >> 8;
  *(*p)++ = v >> 16;
  *(*p)++ = v >> 24;
}
inline static void append_uint32(uint8_t **p, uint32_t v) {
  *(*p)++ = v;
  *(*p)++ = v >> 8;
  *(*p)++ = v >> 16;
  *(*p)++ = v >> 24;
}
inline static void append_int64(uint8_t **p, int64_t v) {
  *(*p)++ = v;
  *(*p)++ = v >> 8;
  *(*p)++ = v >> 16;
  *(*p)++ = v >> 24;
  *(*p)++ = v >> 32;
  *(*p)++ = v >> 40;
  *(*p)++ = v >> 48;
  *(*p)++ = v >> 56;
}
inline static void append_uint64(uint8_t **p, uint64_t v) {
  *(*p)++ = v;
  *(*p)++ = v >> 8;
  *(*p)++ = v >> 16;
  *(*p)++ = v >> 24;
  *(*p)++ = v >> 32;
  *(*p)++ = v >> 40;
  *(*p)++ = v >> 48;
  *(*p)++ = v >> 56;
}

inline static void append_float32(uint8_t **p, float v) {
  append_uint32(p, *(uint32_t *)&v);
}
inline static void append_float64(uint8_t **p, double v) {
  append_uint64(p, *(uint64_t *)&v);
}

inline static uint16_t x25(uint16_t crc, uint8_t v) {
  v ^= crc;
  v ^= v << 4;
  return (crc >> 8) ^ (v << 8) ^ (v << 3) ^
         (v >> 4); // (uint8_t << int) is promoted to int (!!)
}

static void append_payload_base(uint8_t **p, struct paparazzi_message *msg) {
  switch (msg->msg_id) {

  case PAPARAZZI_MESSAGE_HEARTBEAT:
    append_uint32(p, msg->heartbeat.custom_mode);
    append_byte(p, msg->heartbeat.type);
    append_byte(p, msg->heartbeat.autopilot);
    append_byte(p, msg->heartbeat.base_mode);
    append_byte(p, msg->heartbeat.system_status);
    append_byte(p, msg->heartbeat.mavlink_version);
    break;

  case PAPARAZZI_MESSAGE_SYS_STATUS:
    append_uint32(p, msg->sys_status.onboard_control_sensors_present);
    append_uint32(p, msg->sys_status.onboard_control_sensors_enabled);
    append_uint32(p, msg->sys_status.onboard_control_sensors_health);
    append_uint16(p, msg->sys_status.load);
    append_uint16(p, msg->sys_status.voltage_battery);
    append_int16(p, msg->sys_status.current_battery);
    append_uint16(p, msg->sys_status.drop_rate_comm);
    append_uint16(p, msg->sys_status.errors_comm);
    append_uint16(p, msg->sys_status.errors_count1);
    append_uint16(p, msg->sys_status.errors_count2);
    append_uint16(p, msg->sys_status.errors_count3);
    append_uint16(p, msg->sys_status.errors_count4);
    append_int8(p, msg->sys_status.battery_remaining);
    break;

  case PAPARAZZI_MESSAGE_SYSTEM_TIME:
    append_uint64(p, msg->system_time.time_unix_usec);
    append_uint32(p, msg->system_time.time_boot_ms);
    break;

  case PAPARAZZI_MESSAGE_PING:
    append_uint64(p, msg->ping.time_usec);
    append_uint32(p, msg->ping.seq);
    append_byte(p, msg->ping.target_system);
    append_byte(p, msg->ping.target_component);
    break;

  case PAPARAZZI_MESSAGE_CHANGE_OPERATOR_CONTROL:
    append_byte(p, msg->change_operator_control.target_system);
    append_byte(p, msg->change_operator_control.control_request);
    append_byte(p, msg->change_operator_control.version);
    for (size_t i = 0; i < 25; i++)
      append_byte(p, msg->change_operator_control.passkey[i]);
    break;

  case PAPARAZZI_MESSAGE_CHANGE_OPERATOR_CONTROL_ACK:
    append_byte(p, msg->change_operator_control_ack.gcs_system_id);
    append_byte(p, msg->change_operator_control_ack.control_request);
    append_byte(p, msg->change_operator_control_ack.ack);
    break;

  case PAPARAZZI_MESSAGE_AUTH_KEY:

    for (size_t i = 0; i < 32; i++)
      append_byte(p, msg->auth_key.key[i]);
    break;

  case PAPARAZZI_MESSAGE_LINK_NODE_STATUS:
    append_uint64(p, msg->link_node_status.timestamp);
    append_uint32(p, msg->link_node_status.tx_rate);
    append_uint32(p, msg->link_node_status.rx_rate);
    append_uint32(p, msg->link_node_status.messages_sent);
    append_uint32(p, msg->link_node_status.messages_received);
    append_uint32(p, msg->link_node_status.messages_lost);
    append_uint16(p, msg->link_node_status.rx_parse_err);
    append_uint16(p, msg->link_node_status.tx_overflows);
    append_uint16(p, msg->link_node_status.rx_overflows);
    append_byte(p, msg->link_node_status.tx_buf);
    append_byte(p, msg->link_node_status.rx_buf);
    break;

  case PAPARAZZI_MESSAGE_SET_MODE:
    append_uint32(p, msg->set_mode.custom_mode);
    append_byte(p, msg->set_mode.target_system);
    append_byte(p, msg->set_mode.base_mode);
    break;

  case PAPARAZZI_MESSAGE_PARAM_REQUEST_READ:
    append_int16(p, msg->param_request_read.param_index);
    append_byte(p, msg->param_request_read.target_system);
    append_byte(p, msg->param_request_read.target_component);
    for (size_t i = 0; i < 16; i++)
      append_byte(p, msg->param_request_read.param_id[i]);
    break;

  case PAPARAZZI_MESSAGE_PARAM_REQUEST_LIST:
    append_byte(p, msg->param_request_list.target_system);
    append_byte(p, msg->param_request_list.target_component);
    break;

  case PAPARAZZI_MESSAGE_PARAM_VALUE:
    append_float32(p, msg->param_value.param_value);
    append_uint16(p, msg->param_value.param_count);
    append_uint16(p, msg->param_value.param_index);
    for (size_t i = 0; i < 16; i++)
      append_byte(p, msg->param_value.param_id[i]);
    append_byte(p, msg->param_value.param_type);
    break;

  case PAPARAZZI_MESSAGE_PARAM_SET:
    append_float32(p, msg->param_set.param_value);
    append_byte(p, msg->param_set.target_system);
    append_byte(p, msg->param_set.target_component);
    for (size_t i = 0; i < 16; i++)
      append_byte(p, msg->param_set.param_id[i]);
    append_byte(p, msg->param_set.param_type);
    break;

  case PAPARAZZI_MESSAGE_GPS_RAW_INT:
    append_uint64(p, msg->gps_raw_int.time_usec);
    append_int32(p, msg->gps_raw_int.lat);
    append_int32(p, msg->gps_raw_int.lon);
    append_int32(p, msg->gps_raw_int.alt);
    append_uint16(p, msg->gps_raw_int.eph);
    append_uint16(p, msg->gps_raw_int.epv);
    append_uint16(p, msg->gps_raw_int.vel);
    append_uint16(p, msg->gps_raw_int.cog);
    append_byte(p, msg->gps_raw_int.fix_type);
    append_byte(p, msg->gps_raw_int.satellites_visible);
    break;

  case PAPARAZZI_MESSAGE_GPS_STATUS:
    append_byte(p, msg->gps_status.satellites_visible);
    for (size_t i = 0; i < 20; i++)
      append_byte(p, msg->gps_status.satellite_prn[i]);
    for (size_t i = 0; i < 20; i++)
      append_byte(p, msg->gps_status.satellite_used[i]);
    for (size_t i = 0; i < 20; i++)
      append_byte(p, msg->gps_status.satellite_elevation[i]);
    for (size_t i = 0; i < 20; i++)
      append_byte(p, msg->gps_status.satellite_azimuth[i]);
    for (size_t i = 0; i < 20; i++)
      append_byte(p, msg->gps_status.satellite_snr[i]);
    break;

  case PAPARAZZI_MESSAGE_SCALED_IMU:
    append_uint32(p, msg->scaled_imu.time_boot_ms);
    append_int16(p, msg->scaled_imu.xacc);
    append_int16(p, msg->scaled_imu.yacc);
    append_int16(p, msg->scaled_imu.zacc);
    append_int16(p, msg->scaled_imu.xgyro);
    append_int16(p, msg->scaled_imu.ygyro);
    append_int16(p, msg->scaled_imu.zgyro);
    append_int16(p, msg->scaled_imu.xmag);
    append_int16(p, msg->scaled_imu.ymag);
    append_int16(p, msg->scaled_imu.zmag);
    break;

  case PAPARAZZI_MESSAGE_RAW_IMU:
    append_uint64(p, msg->raw_imu.time_usec);
    append_int16(p, msg->raw_imu.xacc);
    append_int16(p, msg->raw_imu.yacc);
    append_int16(p, msg->raw_imu.zacc);
    append_int16(p, msg->raw_imu.xgyro);
    append_int16(p, msg->raw_imu.ygyro);
    append_int16(p, msg->raw_imu.zgyro);
    append_int16(p, msg->raw_imu.xmag);
    append_int16(p, msg->raw_imu.ymag);
    append_int16(p, msg->raw_imu.zmag);
    break;

  case PAPARAZZI_MESSAGE_RAW_PRESSURE:
    append_uint64(p, msg->raw_pressure.time_usec);
    append_int16(p, msg->raw_pressure.press_abs);
    append_int16(p, msg->raw_pressure.press_diff1);
    append_int16(p, msg->raw_pressure.press_diff2);
    append_int16(p, msg->raw_pressure.temperature);
    break;

  case PAPARAZZI_MESSAGE_SCALED_PRESSURE:
    append_uint32(p, msg->scaled_pressure.time_boot_ms);
    append_float32(p, msg->scaled_pressure.press_abs);
    append_float32(p, msg->scaled_pressure.press_diff);
    append_int16(p, msg->scaled_pressure.temperature);
    break;

  case PAPARAZZI_MESSAGE_ATTITUDE:
    append_uint32(p, msg->attitude.time_boot_ms);
    append_float32(p, msg->attitude.roll);
    append_float32(p, msg->attitude.pitch);
    append_float32(p, msg->attitude.yaw);
    append_float32(p, msg->attitude.rollspeed);
    append_float32(p, msg->attitude.pitchspeed);
    append_float32(p, msg->attitude.yawspeed);
    break;

  case PAPARAZZI_MESSAGE_ATTITUDE_QUATERNION:
    append_uint32(p, msg->attitude_quaternion.time_boot_ms);
    append_float32(p, msg->attitude_quaternion.q1);
    append_float32(p, msg->attitude_quaternion.q2);
    append_float32(p, msg->attitude_quaternion.q3);
    append_float32(p, msg->attitude_quaternion.q4);
    append_float32(p, msg->attitude_quaternion.rollspeed);
    append_float32(p, msg->attitude_quaternion.pitchspeed);
    append_float32(p, msg->attitude_quaternion.yawspeed);
    break;

  case PAPARAZZI_MESSAGE_LOCAL_POSITION_NED:
    append_uint32(p, msg->local_position_ned.time_boot_ms);
    append_float32(p, msg->local_position_ned.x);
    append_float32(p, msg->local_position_ned.y);
    append_float32(p, msg->local_position_ned.z);
    append_float32(p, msg->local_position_ned.vx);
    append_float32(p, msg->local_position_ned.vy);
    append_float32(p, msg->local_position_ned.vz);
    break;

  case PAPARAZZI_MESSAGE_GLOBAL_POSITION_INT:
    append_uint32(p, msg->global_position_int.time_boot_ms);
    append_int32(p, msg->global_position_int.lat);
    append_int32(p, msg->global_position_int.lon);
    append_int32(p, msg->global_position_int.alt);
    append_int32(p, msg->global_position_int.relative_alt);
    append_int16(p, msg->global_position_int.vx);
    append_int16(p, msg->global_position_int.vy);
    append_int16(p, msg->global_position_int.vz);
    append_uint16(p, msg->global_position_int.hdg);
    break;

  case PAPARAZZI_MESSAGE_RC_CHANNELS_SCALED:
    append_uint32(p, msg->rc_channels_scaled.time_boot_ms);
    append_int16(p, msg->rc_channels_scaled.chan1_scaled);
    append_int16(p, msg->rc_channels_scaled.chan2_scaled);
    append_int16(p, msg->rc_channels_scaled.chan3_scaled);
    append_int16(p, msg->rc_channels_scaled.chan4_scaled);
    append_int16(p, msg->rc_channels_scaled.chan5_scaled);
    append_int16(p, msg->rc_channels_scaled.chan6_scaled);
    append_int16(p, msg->rc_channels_scaled.chan7_scaled);
    append_int16(p, msg->rc_channels_scaled.chan8_scaled);
    append_byte(p, msg->rc_channels_scaled.port);
    append_byte(p, msg->rc_channels_scaled.rssi);
    break;

  case PAPARAZZI_MESSAGE_RC_CHANNELS_RAW:
    append_uint32(p, msg->rc_channels_raw.time_boot_ms);
    append_uint16(p, msg->rc_channels_raw.chan1_raw);
    append_uint16(p, msg->rc_channels_raw.chan2_raw);
    append_uint16(p, msg->rc_channels_raw.chan3_raw);
    append_uint16(p, msg->rc_channels_raw.chan4_raw);
    append_uint16(p, msg->rc_channels_raw.chan5_raw);
    append_uint16(p, msg->rc_channels_raw.chan6_raw);
    append_uint16(p, msg->rc_channels_raw.chan7_raw);
    append_uint16(p, msg->rc_channels_raw.chan8_raw);
    append_byte(p, msg->rc_channels_raw.port);
    append_byte(p, msg->rc_channels_raw.rssi);
    break;

  case PAPARAZZI_MESSAGE_SERVO_OUTPUT_RAW:
    append_uint32(p, msg->servo_output_raw.time_usec);
    append_uint16(p, msg->servo_output_raw.servo1_raw);
    append_uint16(p, msg->servo_output_raw.servo2_raw);
    append_uint16(p, msg->servo_output_raw.servo3_raw);
    append_uint16(p, msg->servo_output_raw.servo4_raw);
    append_uint16(p, msg->servo_output_raw.servo5_raw);
    append_uint16(p, msg->servo_output_raw.servo6_raw);
    append_uint16(p, msg->servo_output_raw.servo7_raw);
    append_uint16(p, msg->servo_output_raw.servo8_raw);
    append_byte(p, msg->servo_output_raw.port);
    break;

  case PAPARAZZI_MESSAGE_MISSION_REQUEST_PARTIAL_LIST:
    append_int16(p, msg->mission_request_partial_list.start_index);
    append_int16(p, msg->mission_request_partial_list.end_index);
    append_byte(p, msg->mission_request_partial_list.target_system);
    append_byte(p, msg->mission_request_partial_list.target_component);
    break;

  case PAPARAZZI_MESSAGE_MISSION_WRITE_PARTIAL_LIST:
    append_int16(p, msg->mission_write_partial_list.start_index);
    append_int16(p, msg->mission_write_partial_list.end_index);
    append_byte(p, msg->mission_write_partial_list.target_system);
    append_byte(p, msg->mission_write_partial_list.target_component);
    break;

  case PAPARAZZI_MESSAGE_MISSION_ITEM:
    append_float32(p, msg->mission_item.param1);
    append_float32(p, msg->mission_item.param2);
    append_float32(p, msg->mission_item.param3);
    append_float32(p, msg->mission_item.param4);
    append_float32(p, msg->mission_item.x);
    append_float32(p, msg->mission_item.y);
    append_float32(p, msg->mission_item.z);
    append_uint16(p, msg->mission_item.seq);
    append_uint16(p, msg->mission_item.command);
    append_byte(p, msg->mission_item.target_system);
    append_byte(p, msg->mission_item.target_component);
    append_byte(p, msg->mission_item.frame);
    append_byte(p, msg->mission_item.current);
    append_byte(p, msg->mission_item.autocontinue);
    break;

  case PAPARAZZI_MESSAGE_MISSION_REQUEST:
    append_uint16(p, msg->mission_request.seq);
    append_byte(p, msg->mission_request.target_system);
    append_byte(p, msg->mission_request.target_component);
    break;

  case PAPARAZZI_MESSAGE_MISSION_SET_CURRENT:
    append_uint16(p, msg->mission_set_current.seq);
    append_byte(p, msg->mission_set_current.target_system);
    append_byte(p, msg->mission_set_current.target_component);
    break;

  case PAPARAZZI_MESSAGE_MISSION_CURRENT:
    append_uint16(p, msg->mission_current.seq);
    break;

  case PAPARAZZI_MESSAGE_MISSION_REQUEST_LIST:
    append_byte(p, msg->mission_request_list.target_system);
    append_byte(p, msg->mission_request_list.target_component);
    break;

  case PAPARAZZI_MESSAGE_MISSION_COUNT:
    append_uint16(p, msg->mission_count.count);
    append_byte(p, msg->mission_count.target_system);
    append_byte(p, msg->mission_count.target_component);
    break;

  case PAPARAZZI_MESSAGE_MISSION_CLEAR_ALL:
    append_byte(p, msg->mission_clear_all.target_system);
    append_byte(p, msg->mission_clear_all.target_component);
    break;

  case PAPARAZZI_MESSAGE_MISSION_ITEM_REACHED:
    append_uint16(p, msg->mission_item_reached.seq);
    break;

  case PAPARAZZI_MESSAGE_MISSION_ACK:
    append_byte(p, msg->mission_ack.target_system);
    append_byte(p, msg->mission_ack.target_component);
    append_byte(p, msg->mission_ack.type);
    break;

  case PAPARAZZI_MESSAGE_SET_GPS_GLOBAL_ORIGIN:
    append_int32(p, msg->set_gps_global_origin.latitude);
    append_int32(p, msg->set_gps_global_origin.longitude);
    append_int32(p, msg->set_gps_global_origin.altitude);
    append_byte(p, msg->set_gps_global_origin.target_system);
    break;

  case PAPARAZZI_MESSAGE_GPS_GLOBAL_ORIGIN:
    append_int32(p, msg->gps_global_origin.latitude);
    append_int32(p, msg->gps_global_origin.longitude);
    append_int32(p, msg->gps_global_origin.altitude);
    break;

  case PAPARAZZI_MESSAGE_PARAM_MAP_RC:
    append_float32(p, msg->param_map_rc.param_value0);
    append_float32(p, msg->param_map_rc.scale);
    append_float32(p, msg->param_map_rc.param_value_min);
    append_float32(p, msg->param_map_rc.param_value_max);
    append_int16(p, msg->param_map_rc.param_index);
    append_byte(p, msg->param_map_rc.target_system);
    append_byte(p, msg->param_map_rc.target_component);
    for (size_t i = 0; i < 16; i++)
      append_byte(p, msg->param_map_rc.param_id[i]);
    append_byte(p, msg->param_map_rc.parameter_rc_channel_index);
    break;

  case PAPARAZZI_MESSAGE_MISSION_REQUEST_INT:
    append_uint16(p, msg->mission_request_int.seq);
    append_byte(p, msg->mission_request_int.target_system);
    append_byte(p, msg->mission_request_int.target_component);
    break;

  case PAPARAZZI_MESSAGE_MISSION_CHANGED:
    append_int16(p, msg->mission_changed.start_index);
    append_int16(p, msg->mission_changed.end_index);
    append_byte(p, msg->mission_changed.origin_sysid);
    append_byte(p, msg->mission_changed.origin_compid);
    append_byte(p, msg->mission_changed.mission_type);
    break;

  case PAPARAZZI_MESSAGE_SAFETY_SET_ALLOWED_AREA:
    append_float32(p, msg->safety_set_allowed_area.p1x);
    append_float32(p, msg->safety_set_allowed_area.p1y);
    append_float32(p, msg->safety_set_allowed_area.p1z);
    append_float32(p, msg->safety_set_allowed_area.p2x);
    append_float32(p, msg->safety_set_allowed_area.p2y);
    append_float32(p, msg->safety_set_allowed_area.p2z);
    append_byte(p, msg->safety_set_allowed_area.target_system);
    append_byte(p, msg->safety_set_allowed_area.target_component);
    append_byte(p, msg->safety_set_allowed_area.frame);
    break;

  case PAPARAZZI_MESSAGE_SAFETY_ALLOWED_AREA:
    append_float32(p, msg->safety_allowed_area.p1x);
    append_float32(p, msg->safety_allowed_area.p1y);
    append_float32(p, msg->safety_allowed_area.p1z);
    append_float32(p, msg->safety_allowed_area.p2x);
    append_float32(p, msg->safety_allowed_area.p2y);
    append_float32(p, msg->safety_allowed_area.p2z);
    append_byte(p, msg->safety_allowed_area.frame);
    break;

  case PAPARAZZI_MESSAGE_ATTITUDE_QUATERNION_COV:
    append_uint64(p, msg->attitude_quaternion_cov.time_usec);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->attitude_quaternion_cov.q[i]);
    append_float32(p, msg->attitude_quaternion_cov.rollspeed);
    append_float32(p, msg->attitude_quaternion_cov.pitchspeed);
    append_float32(p, msg->attitude_quaternion_cov.yawspeed);
    for (size_t i = 0; i < 9; i++)
      append_float32(p, msg->attitude_quaternion_cov.covariance[i]);
    break;

  case PAPARAZZI_MESSAGE_NAV_CONTROLLER_OUTPUT:
    append_float32(p, msg->nav_controller_output.nav_roll);
    append_float32(p, msg->nav_controller_output.nav_pitch);
    append_float32(p, msg->nav_controller_output.alt_error);
    append_float32(p, msg->nav_controller_output.aspd_error);
    append_float32(p, msg->nav_controller_output.xtrack_error);
    append_int16(p, msg->nav_controller_output.nav_bearing);
    append_int16(p, msg->nav_controller_output.target_bearing);
    append_uint16(p, msg->nav_controller_output.wp_dist);
    break;

  case PAPARAZZI_MESSAGE_GLOBAL_POSITION_INT_COV:
    append_uint64(p, msg->global_position_int_cov.time_usec);
    append_int32(p, msg->global_position_int_cov.lat);
    append_int32(p, msg->global_position_int_cov.lon);
    append_int32(p, msg->global_position_int_cov.alt);
    append_int32(p, msg->global_position_int_cov.relative_alt);
    append_float32(p, msg->global_position_int_cov.vx);
    append_float32(p, msg->global_position_int_cov.vy);
    append_float32(p, msg->global_position_int_cov.vz);
    for (size_t i = 0; i < 36; i++)
      append_float32(p, msg->global_position_int_cov.covariance[i]);
    append_byte(p, msg->global_position_int_cov.estimator_type);
    break;

  case PAPARAZZI_MESSAGE_LOCAL_POSITION_NED_COV:
    append_uint64(p, msg->local_position_ned_cov.time_usec);
    append_float32(p, msg->local_position_ned_cov.x);
    append_float32(p, msg->local_position_ned_cov.y);
    append_float32(p, msg->local_position_ned_cov.z);
    append_float32(p, msg->local_position_ned_cov.vx);
    append_float32(p, msg->local_position_ned_cov.vy);
    append_float32(p, msg->local_position_ned_cov.vz);
    append_float32(p, msg->local_position_ned_cov.ax);
    append_float32(p, msg->local_position_ned_cov.ay);
    append_float32(p, msg->local_position_ned_cov.az);
    for (size_t i = 0; i < 45; i++)
      append_float32(p, msg->local_position_ned_cov.covariance[i]);
    append_byte(p, msg->local_position_ned_cov.estimator_type);
    break;

  case PAPARAZZI_MESSAGE_RC_CHANNELS:
    append_uint32(p, msg->rc_channels.time_boot_ms);
    append_uint16(p, msg->rc_channels.chan1_raw);
    append_uint16(p, msg->rc_channels.chan2_raw);
    append_uint16(p, msg->rc_channels.chan3_raw);
    append_uint16(p, msg->rc_channels.chan4_raw);
    append_uint16(p, msg->rc_channels.chan5_raw);
    append_uint16(p, msg->rc_channels.chan6_raw);
    append_uint16(p, msg->rc_channels.chan7_raw);
    append_uint16(p, msg->rc_channels.chan8_raw);
    append_uint16(p, msg->rc_channels.chan9_raw);
    append_uint16(p, msg->rc_channels.chan10_raw);
    append_uint16(p, msg->rc_channels.chan11_raw);
    append_uint16(p, msg->rc_channels.chan12_raw);
    append_uint16(p, msg->rc_channels.chan13_raw);
    append_uint16(p, msg->rc_channels.chan14_raw);
    append_uint16(p, msg->rc_channels.chan15_raw);
    append_uint16(p, msg->rc_channels.chan16_raw);
    append_uint16(p, msg->rc_channels.chan17_raw);
    append_uint16(p, msg->rc_channels.chan18_raw);
    append_byte(p, msg->rc_channels.chancount);
    append_byte(p, msg->rc_channels.rssi);
    break;

  case PAPARAZZI_MESSAGE_REQUEST_DATA_STREAM:
    append_uint16(p, msg->request_data_stream.req_message_rate);
    append_byte(p, msg->request_data_stream.target_system);
    append_byte(p, msg->request_data_stream.target_component);
    append_byte(p, msg->request_data_stream.req_stream_id);
    append_byte(p, msg->request_data_stream.start_stop);
    break;

  case PAPARAZZI_MESSAGE_DATA_STREAM:
    append_uint16(p, msg->data_stream.message_rate);
    append_byte(p, msg->data_stream.stream_id);
    append_byte(p, msg->data_stream.on_off);
    break;

  case PAPARAZZI_MESSAGE_MANUAL_CONTROL:
    append_int16(p, msg->manual_control.x);
    append_int16(p, msg->manual_control.y);
    append_int16(p, msg->manual_control.z);
    append_int16(p, msg->manual_control.r);
    append_uint16(p, msg->manual_control.buttons);
    append_byte(p, msg->manual_control.target);
    break;

  case PAPARAZZI_MESSAGE_RC_CHANNELS_OVERRIDE:
    append_uint16(p, msg->rc_channels_override.chan1_raw);
    append_uint16(p, msg->rc_channels_override.chan2_raw);
    append_uint16(p, msg->rc_channels_override.chan3_raw);
    append_uint16(p, msg->rc_channels_override.chan4_raw);
    append_uint16(p, msg->rc_channels_override.chan5_raw);
    append_uint16(p, msg->rc_channels_override.chan6_raw);
    append_uint16(p, msg->rc_channels_override.chan7_raw);
    append_uint16(p, msg->rc_channels_override.chan8_raw);
    append_byte(p, msg->rc_channels_override.target_system);
    append_byte(p, msg->rc_channels_override.target_component);
    break;

  case PAPARAZZI_MESSAGE_MISSION_ITEM_INT:
    append_float32(p, msg->mission_item_int.param1);
    append_float32(p, msg->mission_item_int.param2);
    append_float32(p, msg->mission_item_int.param3);
    append_float32(p, msg->mission_item_int.param4);
    append_int32(p, msg->mission_item_int.x);
    append_int32(p, msg->mission_item_int.y);
    append_float32(p, msg->mission_item_int.z);
    append_uint16(p, msg->mission_item_int.seq);
    append_uint16(p, msg->mission_item_int.command);
    append_byte(p, msg->mission_item_int.target_system);
    append_byte(p, msg->mission_item_int.target_component);
    append_byte(p, msg->mission_item_int.frame);
    append_byte(p, msg->mission_item_int.current);
    append_byte(p, msg->mission_item_int.autocontinue);
    break;

  case PAPARAZZI_MESSAGE_VFR_HUD:
    append_float32(p, msg->vfr_hud.airspeed);
    append_float32(p, msg->vfr_hud.groundspeed);
    append_float32(p, msg->vfr_hud.alt);
    append_float32(p, msg->vfr_hud.climb);
    append_int16(p, msg->vfr_hud.heading);
    append_uint16(p, msg->vfr_hud.throttle);
    break;

  case PAPARAZZI_MESSAGE_COMMAND_INT:
    append_float32(p, msg->command_int.param1);
    append_float32(p, msg->command_int.param2);
    append_float32(p, msg->command_int.param3);
    append_float32(p, msg->command_int.param4);
    append_int32(p, msg->command_int.x);
    append_int32(p, msg->command_int.y);
    append_float32(p, msg->command_int.z);
    append_uint16(p, msg->command_int.command);
    append_byte(p, msg->command_int.target_system);
    append_byte(p, msg->command_int.target_component);
    append_byte(p, msg->command_int.frame);
    append_byte(p, msg->command_int.current);
    append_byte(p, msg->command_int.autocontinue);
    break;

  case PAPARAZZI_MESSAGE_COMMAND_LONG:
    append_float32(p, msg->command_long.param1);
    append_float32(p, msg->command_long.param2);
    append_float32(p, msg->command_long.param3);
    append_float32(p, msg->command_long.param4);
    append_float32(p, msg->command_long.param5);
    append_float32(p, msg->command_long.param6);
    append_float32(p, msg->command_long.param7);
    append_uint16(p, msg->command_long.command);
    append_byte(p, msg->command_long.target_system);
    append_byte(p, msg->command_long.target_component);
    append_byte(p, msg->command_long.confirmation);
    break;

  case PAPARAZZI_MESSAGE_COMMAND_ACK:
    append_uint16(p, msg->command_ack.command);
    append_byte(p, msg->command_ack.result);
    break;

  case PAPARAZZI_MESSAGE_MANUAL_SETPOINT:
    append_uint32(p, msg->manual_setpoint.time_boot_ms);
    append_float32(p, msg->manual_setpoint.roll);
    append_float32(p, msg->manual_setpoint.pitch);
    append_float32(p, msg->manual_setpoint.yaw);
    append_float32(p, msg->manual_setpoint.thrust);
    append_byte(p, msg->manual_setpoint.mode_switch);
    append_byte(p, msg->manual_setpoint.manual_override_switch);
    break;

  case PAPARAZZI_MESSAGE_SET_ATTITUDE_TARGET:
    append_uint32(p, msg->set_attitude_target.time_boot_ms);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->set_attitude_target.q[i]);
    append_float32(p, msg->set_attitude_target.body_roll_rate);
    append_float32(p, msg->set_attitude_target.body_pitch_rate);
    append_float32(p, msg->set_attitude_target.body_yaw_rate);
    append_float32(p, msg->set_attitude_target.thrust);
    append_byte(p, msg->set_attitude_target.target_system);
    append_byte(p, msg->set_attitude_target.target_component);
    append_byte(p, msg->set_attitude_target.type_mask);
    break;

  case PAPARAZZI_MESSAGE_ATTITUDE_TARGET:
    append_uint32(p, msg->attitude_target.time_boot_ms);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->attitude_target.q[i]);
    append_float32(p, msg->attitude_target.body_roll_rate);
    append_float32(p, msg->attitude_target.body_pitch_rate);
    append_float32(p, msg->attitude_target.body_yaw_rate);
    append_float32(p, msg->attitude_target.thrust);
    append_byte(p, msg->attitude_target.type_mask);
    break;

  case PAPARAZZI_MESSAGE_SET_POSITION_TARGET_LOCAL_NED:
    append_uint32(p, msg->set_position_target_local_ned.time_boot_ms);
    append_float32(p, msg->set_position_target_local_ned.x);
    append_float32(p, msg->set_position_target_local_ned.y);
    append_float32(p, msg->set_position_target_local_ned.z);
    append_float32(p, msg->set_position_target_local_ned.vx);
    append_float32(p, msg->set_position_target_local_ned.vy);
    append_float32(p, msg->set_position_target_local_ned.vz);
    append_float32(p, msg->set_position_target_local_ned.afx);
    append_float32(p, msg->set_position_target_local_ned.afy);
    append_float32(p, msg->set_position_target_local_ned.afz);
    append_float32(p, msg->set_position_target_local_ned.yaw);
    append_float32(p, msg->set_position_target_local_ned.yaw_rate);
    append_uint16(p, msg->set_position_target_local_ned.type_mask);
    append_byte(p, msg->set_position_target_local_ned.target_system);
    append_byte(p, msg->set_position_target_local_ned.target_component);
    append_byte(p, msg->set_position_target_local_ned.coordinate_frame);
    break;

  case PAPARAZZI_MESSAGE_POSITION_TARGET_LOCAL_NED:
    append_uint32(p, msg->position_target_local_ned.time_boot_ms);
    append_float32(p, msg->position_target_local_ned.x);
    append_float32(p, msg->position_target_local_ned.y);
    append_float32(p, msg->position_target_local_ned.z);
    append_float32(p, msg->position_target_local_ned.vx);
    append_float32(p, msg->position_target_local_ned.vy);
    append_float32(p, msg->position_target_local_ned.vz);
    append_float32(p, msg->position_target_local_ned.afx);
    append_float32(p, msg->position_target_local_ned.afy);
    append_float32(p, msg->position_target_local_ned.afz);
    append_float32(p, msg->position_target_local_ned.yaw);
    append_float32(p, msg->position_target_local_ned.yaw_rate);
    append_uint16(p, msg->position_target_local_ned.type_mask);
    append_byte(p, msg->position_target_local_ned.coordinate_frame);
    break;

  case PAPARAZZI_MESSAGE_SET_POSITION_TARGET_GLOBAL_INT:
    append_uint32(p, msg->set_position_target_global_int.time_boot_ms);
    append_int32(p, msg->set_position_target_global_int.lat_int);
    append_int32(p, msg->set_position_target_global_int.lon_int);
    append_float32(p, msg->set_position_target_global_int.alt);
    append_float32(p, msg->set_position_target_global_int.vx);
    append_float32(p, msg->set_position_target_global_int.vy);
    append_float32(p, msg->set_position_target_global_int.vz);
    append_float32(p, msg->set_position_target_global_int.afx);
    append_float32(p, msg->set_position_target_global_int.afy);
    append_float32(p, msg->set_position_target_global_int.afz);
    append_float32(p, msg->set_position_target_global_int.yaw);
    append_float32(p, msg->set_position_target_global_int.yaw_rate);
    append_uint16(p, msg->set_position_target_global_int.type_mask);
    append_byte(p, msg->set_position_target_global_int.target_system);
    append_byte(p, msg->set_position_target_global_int.target_component);
    append_byte(p, msg->set_position_target_global_int.coordinate_frame);
    break;

  case PAPARAZZI_MESSAGE_POSITION_TARGET_GLOBAL_INT:
    append_uint32(p, msg->position_target_global_int.time_boot_ms);
    append_int32(p, msg->position_target_global_int.lat_int);
    append_int32(p, msg->position_target_global_int.lon_int);
    append_float32(p, msg->position_target_global_int.alt);
    append_float32(p, msg->position_target_global_int.vx);
    append_float32(p, msg->position_target_global_int.vy);
    append_float32(p, msg->position_target_global_int.vz);
    append_float32(p, msg->position_target_global_int.afx);
    append_float32(p, msg->position_target_global_int.afy);
    append_float32(p, msg->position_target_global_int.afz);
    append_float32(p, msg->position_target_global_int.yaw);
    append_float32(p, msg->position_target_global_int.yaw_rate);
    append_uint16(p, msg->position_target_global_int.type_mask);
    append_byte(p, msg->position_target_global_int.coordinate_frame);
    break;

  case PAPARAZZI_MESSAGE_LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET:
    append_uint32(p, msg->local_position_ned_system_global_offset.time_boot_ms);
    append_float32(p, msg->local_position_ned_system_global_offset.x);
    append_float32(p, msg->local_position_ned_system_global_offset.y);
    append_float32(p, msg->local_position_ned_system_global_offset.z);
    append_float32(p, msg->local_position_ned_system_global_offset.roll);
    append_float32(p, msg->local_position_ned_system_global_offset.pitch);
    append_float32(p, msg->local_position_ned_system_global_offset.yaw);
    break;

  case PAPARAZZI_MESSAGE_HIL_STATE:
    append_uint64(p, msg->hil_state.time_usec);
    append_float32(p, msg->hil_state.roll);
    append_float32(p, msg->hil_state.pitch);
    append_float32(p, msg->hil_state.yaw);
    append_float32(p, msg->hil_state.rollspeed);
    append_float32(p, msg->hil_state.pitchspeed);
    append_float32(p, msg->hil_state.yawspeed);
    append_int32(p, msg->hil_state.lat);
    append_int32(p, msg->hil_state.lon);
    append_int32(p, msg->hil_state.alt);
    append_int16(p, msg->hil_state.vx);
    append_int16(p, msg->hil_state.vy);
    append_int16(p, msg->hil_state.vz);
    append_int16(p, msg->hil_state.xacc);
    append_int16(p, msg->hil_state.yacc);
    append_int16(p, msg->hil_state.zacc);
    break;

  case PAPARAZZI_MESSAGE_HIL_CONTROLS:
    append_uint64(p, msg->hil_controls.time_usec);
    append_float32(p, msg->hil_controls.roll_ailerons);
    append_float32(p, msg->hil_controls.pitch_elevator);
    append_float32(p, msg->hil_controls.yaw_rudder);
    append_float32(p, msg->hil_controls.throttle);
    append_float32(p, msg->hil_controls.aux1);
    append_float32(p, msg->hil_controls.aux2);
    append_float32(p, msg->hil_controls.aux3);
    append_float32(p, msg->hil_controls.aux4);
    append_byte(p, msg->hil_controls.mode);
    append_byte(p, msg->hil_controls.nav_mode);
    break;

  case PAPARAZZI_MESSAGE_HIL_RC_INPUTS_RAW:
    append_uint64(p, msg->hil_rc_inputs_raw.time_usec);
    append_uint16(p, msg->hil_rc_inputs_raw.chan1_raw);
    append_uint16(p, msg->hil_rc_inputs_raw.chan2_raw);
    append_uint16(p, msg->hil_rc_inputs_raw.chan3_raw);
    append_uint16(p, msg->hil_rc_inputs_raw.chan4_raw);
    append_uint16(p, msg->hil_rc_inputs_raw.chan5_raw);
    append_uint16(p, msg->hil_rc_inputs_raw.chan6_raw);
    append_uint16(p, msg->hil_rc_inputs_raw.chan7_raw);
    append_uint16(p, msg->hil_rc_inputs_raw.chan8_raw);
    append_uint16(p, msg->hil_rc_inputs_raw.chan9_raw);
    append_uint16(p, msg->hil_rc_inputs_raw.chan10_raw);
    append_uint16(p, msg->hil_rc_inputs_raw.chan11_raw);
    append_uint16(p, msg->hil_rc_inputs_raw.chan12_raw);
    append_byte(p, msg->hil_rc_inputs_raw.rssi);
    break;

  case PAPARAZZI_MESSAGE_HIL_ACTUATOR_CONTROLS:
    append_uint64(p, msg->hil_actuator_controls.time_usec);
    append_uint64(p, msg->hil_actuator_controls.flags);
    for (size_t i = 0; i < 16; i++)
      append_float32(p, msg->hil_actuator_controls.controls[i]);
    append_byte(p, msg->hil_actuator_controls.mode);
    break;

  case PAPARAZZI_MESSAGE_OPTICAL_FLOW:
    append_uint64(p, msg->optical_flow.time_usec);
    append_float32(p, msg->optical_flow.flow_comp_m_x);
    append_float32(p, msg->optical_flow.flow_comp_m_y);
    append_float32(p, msg->optical_flow.ground_distance);
    append_int16(p, msg->optical_flow.flow_x);
    append_int16(p, msg->optical_flow.flow_y);
    append_byte(p, msg->optical_flow.sensor_id);
    append_byte(p, msg->optical_flow.quality);
    break;

  case PAPARAZZI_MESSAGE_GLOBAL_VISION_POSITION_ESTIMATE:
    append_uint64(p, msg->global_vision_position_estimate.usec);
    append_float32(p, msg->global_vision_position_estimate.x);
    append_float32(p, msg->global_vision_position_estimate.y);
    append_float32(p, msg->global_vision_position_estimate.z);
    append_float32(p, msg->global_vision_position_estimate.roll);
    append_float32(p, msg->global_vision_position_estimate.pitch);
    append_float32(p, msg->global_vision_position_estimate.yaw);
    break;

  case PAPARAZZI_MESSAGE_VISION_POSITION_ESTIMATE:
    append_uint64(p, msg->vision_position_estimate.usec);
    append_float32(p, msg->vision_position_estimate.x);
    append_float32(p, msg->vision_position_estimate.y);
    append_float32(p, msg->vision_position_estimate.z);
    append_float32(p, msg->vision_position_estimate.roll);
    append_float32(p, msg->vision_position_estimate.pitch);
    append_float32(p, msg->vision_position_estimate.yaw);
    break;

  case PAPARAZZI_MESSAGE_VISION_SPEED_ESTIMATE:
    append_uint64(p, msg->vision_speed_estimate.usec);
    append_float32(p, msg->vision_speed_estimate.x);
    append_float32(p, msg->vision_speed_estimate.y);
    append_float32(p, msg->vision_speed_estimate.z);
    break;

  case PAPARAZZI_MESSAGE_VICON_POSITION_ESTIMATE:
    append_uint64(p, msg->vicon_position_estimate.usec);
    append_float32(p, msg->vicon_position_estimate.x);
    append_float32(p, msg->vicon_position_estimate.y);
    append_float32(p, msg->vicon_position_estimate.z);
    append_float32(p, msg->vicon_position_estimate.roll);
    append_float32(p, msg->vicon_position_estimate.pitch);
    append_float32(p, msg->vicon_position_estimate.yaw);
    break;

  case PAPARAZZI_MESSAGE_HIGHRES_IMU:
    append_uint64(p, msg->highres_imu.time_usec);
    append_float32(p, msg->highres_imu.xacc);
    append_float32(p, msg->highres_imu.yacc);
    append_float32(p, msg->highres_imu.zacc);
    append_float32(p, msg->highres_imu.xgyro);
    append_float32(p, msg->highres_imu.ygyro);
    append_float32(p, msg->highres_imu.zgyro);
    append_float32(p, msg->highres_imu.xmag);
    append_float32(p, msg->highres_imu.ymag);
    append_float32(p, msg->highres_imu.zmag);
    append_float32(p, msg->highres_imu.abs_pressure);
    append_float32(p, msg->highres_imu.diff_pressure);
    append_float32(p, msg->highres_imu.pressure_alt);
    append_float32(p, msg->highres_imu.temperature);
    append_uint16(p, msg->highres_imu.fields_updated);
    break;

  case PAPARAZZI_MESSAGE_OPTICAL_FLOW_RAD:
    append_uint64(p, msg->optical_flow_rad.time_usec);
    append_uint32(p, msg->optical_flow_rad.integration_time_us);
    append_float32(p, msg->optical_flow_rad.integrated_x);
    append_float32(p, msg->optical_flow_rad.integrated_y);
    append_float32(p, msg->optical_flow_rad.integrated_xgyro);
    append_float32(p, msg->optical_flow_rad.integrated_ygyro);
    append_float32(p, msg->optical_flow_rad.integrated_zgyro);
    append_uint32(p, msg->optical_flow_rad.time_delta_distance_us);
    append_float32(p, msg->optical_flow_rad.distance);
    append_int16(p, msg->optical_flow_rad.temperature);
    append_byte(p, msg->optical_flow_rad.sensor_id);
    append_byte(p, msg->optical_flow_rad.quality);
    break;

  case PAPARAZZI_MESSAGE_HIL_SENSOR:
    append_uint64(p, msg->hil_sensor.time_usec);
    append_float32(p, msg->hil_sensor.xacc);
    append_float32(p, msg->hil_sensor.yacc);
    append_float32(p, msg->hil_sensor.zacc);
    append_float32(p, msg->hil_sensor.xgyro);
    append_float32(p, msg->hil_sensor.ygyro);
    append_float32(p, msg->hil_sensor.zgyro);
    append_float32(p, msg->hil_sensor.xmag);
    append_float32(p, msg->hil_sensor.ymag);
    append_float32(p, msg->hil_sensor.zmag);
    append_float32(p, msg->hil_sensor.abs_pressure);
    append_float32(p, msg->hil_sensor.diff_pressure);
    append_float32(p, msg->hil_sensor.pressure_alt);
    append_float32(p, msg->hil_sensor.temperature);
    append_uint32(p, msg->hil_sensor.fields_updated);
    break;

  case PAPARAZZI_MESSAGE_SIM_STATE:
    append_float32(p, msg->sim_state.q1);
    append_float32(p, msg->sim_state.q2);
    append_float32(p, msg->sim_state.q3);
    append_float32(p, msg->sim_state.q4);
    append_float32(p, msg->sim_state.roll);
    append_float32(p, msg->sim_state.pitch);
    append_float32(p, msg->sim_state.yaw);
    append_float32(p, msg->sim_state.xacc);
    append_float32(p, msg->sim_state.yacc);
    append_float32(p, msg->sim_state.zacc);
    append_float32(p, msg->sim_state.xgyro);
    append_float32(p, msg->sim_state.ygyro);
    append_float32(p, msg->sim_state.zgyro);
    append_float32(p, msg->sim_state.lat);
    append_float32(p, msg->sim_state.lon);
    append_float32(p, msg->sim_state.alt);
    append_float32(p, msg->sim_state.std_dev_horz);
    append_float32(p, msg->sim_state.std_dev_vert);
    append_float32(p, msg->sim_state.vn);
    append_float32(p, msg->sim_state.ve);
    append_float32(p, msg->sim_state.vd);
    break;

  case PAPARAZZI_MESSAGE_RADIO_STATUS:
    append_uint16(p, msg->radio_status.rxerrors);
    append_uint16(p, msg->radio_status.fixed);
    append_byte(p, msg->radio_status.rssi);
    append_byte(p, msg->radio_status.remrssi);
    append_byte(p, msg->radio_status.txbuf);
    append_byte(p, msg->radio_status.noise);
    append_byte(p, msg->radio_status.remnoise);
    break;

  case PAPARAZZI_MESSAGE_FILE_TRANSFER_PROTOCOL:
    append_byte(p, msg->file_transfer_protocol.target_network);
    append_byte(p, msg->file_transfer_protocol.target_system);
    append_byte(p, msg->file_transfer_protocol.target_component);
    for (size_t i = 0; i < 251; i++)
      append_byte(p, msg->file_transfer_protocol.payload[i]);
    break;

  case PAPARAZZI_MESSAGE_TIMESYNC:
    append_int64(p, msg->timesync.tc1);
    append_int64(p, msg->timesync.ts1);
    break;

  case PAPARAZZI_MESSAGE_CAMERA_TRIGGER:
    append_uint64(p, msg->camera_trigger.time_usec);
    append_uint32(p, msg->camera_trigger.seq);
    break;

  case PAPARAZZI_MESSAGE_HIL_GPS:
    append_uint64(p, msg->hil_gps.time_usec);
    append_int32(p, msg->hil_gps.lat);
    append_int32(p, msg->hil_gps.lon);
    append_int32(p, msg->hil_gps.alt);
    append_uint16(p, msg->hil_gps.eph);
    append_uint16(p, msg->hil_gps.epv);
    append_uint16(p, msg->hil_gps.vel);
    append_int16(p, msg->hil_gps.vn);
    append_int16(p, msg->hil_gps.ve);
    append_int16(p, msg->hil_gps.vd);
    append_uint16(p, msg->hil_gps.cog);
    append_byte(p, msg->hil_gps.fix_type);
    append_byte(p, msg->hil_gps.satellites_visible);
    break;

  case PAPARAZZI_MESSAGE_HIL_OPTICAL_FLOW:
    append_uint64(p, msg->hil_optical_flow.time_usec);
    append_uint32(p, msg->hil_optical_flow.integration_time_us);
    append_float32(p, msg->hil_optical_flow.integrated_x);
    append_float32(p, msg->hil_optical_flow.integrated_y);
    append_float32(p, msg->hil_optical_flow.integrated_xgyro);
    append_float32(p, msg->hil_optical_flow.integrated_ygyro);
    append_float32(p, msg->hil_optical_flow.integrated_zgyro);
    append_uint32(p, msg->hil_optical_flow.time_delta_distance_us);
    append_float32(p, msg->hil_optical_flow.distance);
    append_int16(p, msg->hil_optical_flow.temperature);
    append_byte(p, msg->hil_optical_flow.sensor_id);
    append_byte(p, msg->hil_optical_flow.quality);
    break;

  case PAPARAZZI_MESSAGE_HIL_STATE_QUATERNION:
    append_uint64(p, msg->hil_state_quaternion.time_usec);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->hil_state_quaternion.attitude_quaternion[i]);
    append_float32(p, msg->hil_state_quaternion.rollspeed);
    append_float32(p, msg->hil_state_quaternion.pitchspeed);
    append_float32(p, msg->hil_state_quaternion.yawspeed);
    append_int32(p, msg->hil_state_quaternion.lat);
    append_int32(p, msg->hil_state_quaternion.lon);
    append_int32(p, msg->hil_state_quaternion.alt);
    append_int16(p, msg->hil_state_quaternion.vx);
    append_int16(p, msg->hil_state_quaternion.vy);
    append_int16(p, msg->hil_state_quaternion.vz);
    append_uint16(p, msg->hil_state_quaternion.ind_airspeed);
    append_uint16(p, msg->hil_state_quaternion.true_airspeed);
    append_int16(p, msg->hil_state_quaternion.xacc);
    append_int16(p, msg->hil_state_quaternion.yacc);
    append_int16(p, msg->hil_state_quaternion.zacc);
    break;

  case PAPARAZZI_MESSAGE_SCALED_IMU2:
    append_uint32(p, msg->scaled_imu2.time_boot_ms);
    append_int16(p, msg->scaled_imu2.xacc);
    append_int16(p, msg->scaled_imu2.yacc);
    append_int16(p, msg->scaled_imu2.zacc);
    append_int16(p, msg->scaled_imu2.xgyro);
    append_int16(p, msg->scaled_imu2.ygyro);
    append_int16(p, msg->scaled_imu2.zgyro);
    append_int16(p, msg->scaled_imu2.xmag);
    append_int16(p, msg->scaled_imu2.ymag);
    append_int16(p, msg->scaled_imu2.zmag);
    break;

  case PAPARAZZI_MESSAGE_LOG_REQUEST_LIST:
    append_uint16(p, msg->log_request_list.start);
    append_uint16(p, msg->log_request_list.end);
    append_byte(p, msg->log_request_list.target_system);
    append_byte(p, msg->log_request_list.target_component);
    break;

  case PAPARAZZI_MESSAGE_LOG_ENTRY:
    append_uint32(p, msg->log_entry.time_utc);
    append_uint32(p, msg->log_entry.size);
    append_uint16(p, msg->log_entry.id);
    append_uint16(p, msg->log_entry.num_logs);
    append_uint16(p, msg->log_entry.last_log_num);
    break;

  case PAPARAZZI_MESSAGE_LOG_REQUEST_DATA:
    append_uint32(p, msg->log_request_data.ofs);
    append_uint32(p, msg->log_request_data.count);
    append_uint16(p, msg->log_request_data.id);
    append_byte(p, msg->log_request_data.target_system);
    append_byte(p, msg->log_request_data.target_component);
    break;

  case PAPARAZZI_MESSAGE_LOG_DATA:
    append_uint32(p, msg->log_data.ofs);
    append_uint16(p, msg->log_data.id);
    append_byte(p, msg->log_data.count);
    for (size_t i = 0; i < 90; i++)
      append_byte(p, msg->log_data.data[i]);
    break;

  case PAPARAZZI_MESSAGE_LOG_ERASE:
    append_byte(p, msg->log_erase.target_system);
    append_byte(p, msg->log_erase.target_component);
    break;

  case PAPARAZZI_MESSAGE_LOG_REQUEST_END:
    append_byte(p, msg->log_request_end.target_system);
    append_byte(p, msg->log_request_end.target_component);
    break;

  case PAPARAZZI_MESSAGE_GPS_INJECT_DATA:
    append_byte(p, msg->gps_inject_data.target_system);
    append_byte(p, msg->gps_inject_data.target_component);
    append_byte(p, msg->gps_inject_data.len);
    for (size_t i = 0; i < 110; i++)
      append_byte(p, msg->gps_inject_data.data[i]);
    break;

  case PAPARAZZI_MESSAGE_GPS2_RAW:
    append_uint64(p, msg->gps2_raw.time_usec);
    append_int32(p, msg->gps2_raw.lat);
    append_int32(p, msg->gps2_raw.lon);
    append_int32(p, msg->gps2_raw.alt);
    append_uint32(p, msg->gps2_raw.dgps_age);
    append_uint16(p, msg->gps2_raw.eph);
    append_uint16(p, msg->gps2_raw.epv);
    append_uint16(p, msg->gps2_raw.vel);
    append_uint16(p, msg->gps2_raw.cog);
    append_byte(p, msg->gps2_raw.fix_type);
    append_byte(p, msg->gps2_raw.satellites_visible);
    append_byte(p, msg->gps2_raw.dgps_numch);
    break;

  case PAPARAZZI_MESSAGE_POWER_STATUS:
    append_uint16(p, msg->power_status.Vcc);
    append_uint16(p, msg->power_status.Vservo);
    append_uint16(p, msg->power_status.flags);
    break;

  case PAPARAZZI_MESSAGE_SERIAL_CONTROL:
    append_uint32(p, msg->serial_control.baudrate);
    append_uint16(p, msg->serial_control.timeout);
    append_byte(p, msg->serial_control.device);
    append_byte(p, msg->serial_control.flags);
    append_byte(p, msg->serial_control.count);
    for (size_t i = 0; i < 70; i++)
      append_byte(p, msg->serial_control.data[i]);
    break;

  case PAPARAZZI_MESSAGE_GPS_RTK:
    append_uint32(p, msg->gps_rtk.time_last_baseline_ms);
    append_uint32(p, msg->gps_rtk.tow);
    append_int32(p, msg->gps_rtk.baseline_a_mm);
    append_int32(p, msg->gps_rtk.baseline_b_mm);
    append_int32(p, msg->gps_rtk.baseline_c_mm);
    append_uint32(p, msg->gps_rtk.accuracy);
    append_int32(p, msg->gps_rtk.iar_num_hypotheses);
    append_uint16(p, msg->gps_rtk.wn);
    append_byte(p, msg->gps_rtk.rtk_receiver_id);
    append_byte(p, msg->gps_rtk.rtk_health);
    append_byte(p, msg->gps_rtk.rtk_rate);
    append_byte(p, msg->gps_rtk.nsats);
    append_byte(p, msg->gps_rtk.baseline_coords_type);
    break;

  case PAPARAZZI_MESSAGE_GPS2_RTK:
    append_uint32(p, msg->gps2_rtk.time_last_baseline_ms);
    append_uint32(p, msg->gps2_rtk.tow);
    append_int32(p, msg->gps2_rtk.baseline_a_mm);
    append_int32(p, msg->gps2_rtk.baseline_b_mm);
    append_int32(p, msg->gps2_rtk.baseline_c_mm);
    append_uint32(p, msg->gps2_rtk.accuracy);
    append_int32(p, msg->gps2_rtk.iar_num_hypotheses);
    append_uint16(p, msg->gps2_rtk.wn);
    append_byte(p, msg->gps2_rtk.rtk_receiver_id);
    append_byte(p, msg->gps2_rtk.rtk_health);
    append_byte(p, msg->gps2_rtk.rtk_rate);
    append_byte(p, msg->gps2_rtk.nsats);
    append_byte(p, msg->gps2_rtk.baseline_coords_type);
    break;

  case PAPARAZZI_MESSAGE_SCALED_IMU3:
    append_uint32(p, msg->scaled_imu3.time_boot_ms);
    append_int16(p, msg->scaled_imu3.xacc);
    append_int16(p, msg->scaled_imu3.yacc);
    append_int16(p, msg->scaled_imu3.zacc);
    append_int16(p, msg->scaled_imu3.xgyro);
    append_int16(p, msg->scaled_imu3.ygyro);
    append_int16(p, msg->scaled_imu3.zgyro);
    append_int16(p, msg->scaled_imu3.xmag);
    append_int16(p, msg->scaled_imu3.ymag);
    append_int16(p, msg->scaled_imu3.zmag);
    break;

  case PAPARAZZI_MESSAGE_DATA_TRANSMISSION_HANDSHAKE:
    append_uint32(p, msg->data_transmission_handshake.size);
    append_uint16(p, msg->data_transmission_handshake.width);
    append_uint16(p, msg->data_transmission_handshake.height);
    append_uint16(p, msg->data_transmission_handshake.packets);
    append_byte(p, msg->data_transmission_handshake.type);
    append_byte(p, msg->data_transmission_handshake.payload);
    append_byte(p, msg->data_transmission_handshake.jpg_quality);
    break;

  case PAPARAZZI_MESSAGE_ENCAPSULATED_DATA:
    append_uint16(p, msg->encapsulated_data.seqnr);
    for (size_t i = 0; i < 253; i++)
      append_byte(p, msg->encapsulated_data.data[i]);
    break;

  case PAPARAZZI_MESSAGE_DISTANCE_SENSOR:
    append_uint32(p, msg->distance_sensor.time_boot_ms);
    append_uint16(p, msg->distance_sensor.min_distance);
    append_uint16(p, msg->distance_sensor.max_distance);
    append_uint16(p, msg->distance_sensor.current_distance);
    append_byte(p, msg->distance_sensor.type);
    append_byte(p, msg->distance_sensor.id);
    append_byte(p, msg->distance_sensor.orientation);
    append_byte(p, msg->distance_sensor.covariance);
    break;

  case PAPARAZZI_MESSAGE_TERRAIN_REQUEST:
    append_uint64(p, msg->terrain_request.mask);
    append_int32(p, msg->terrain_request.lat);
    append_int32(p, msg->terrain_request.lon);
    append_uint16(p, msg->terrain_request.grid_spacing);
    break;

  case PAPARAZZI_MESSAGE_TERRAIN_DATA:
    append_int32(p, msg->terrain_data.lat);
    append_int32(p, msg->terrain_data.lon);
    append_uint16(p, msg->terrain_data.grid_spacing);
    for (size_t i = 0; i < 16; i++)
      append_int16(p, msg->terrain_data.data[i]);
    append_byte(p, msg->terrain_data.gridbit);
    break;

  case PAPARAZZI_MESSAGE_TERRAIN_CHECK:
    append_int32(p, msg->terrain_check.lat);
    append_int32(p, msg->terrain_check.lon);
    break;

  case PAPARAZZI_MESSAGE_TERRAIN_REPORT:
    append_int32(p, msg->terrain_report.lat);
    append_int32(p, msg->terrain_report.lon);
    append_float32(p, msg->terrain_report.terrain_height);
    append_float32(p, msg->terrain_report.current_height);
    append_uint16(p, msg->terrain_report.spacing);
    append_uint16(p, msg->terrain_report.pending);
    append_uint16(p, msg->terrain_report.loaded);
    break;

  case PAPARAZZI_MESSAGE_SCALED_PRESSURE2:
    append_uint32(p, msg->scaled_pressure2.time_boot_ms);
    append_float32(p, msg->scaled_pressure2.press_abs);
    append_float32(p, msg->scaled_pressure2.press_diff);
    append_int16(p, msg->scaled_pressure2.temperature);
    break;

  case PAPARAZZI_MESSAGE_ATT_POS_MOCAP:
    append_uint64(p, msg->att_pos_mocap.time_usec);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->att_pos_mocap.q[i]);
    append_float32(p, msg->att_pos_mocap.x);
    append_float32(p, msg->att_pos_mocap.y);
    append_float32(p, msg->att_pos_mocap.z);
    break;

  case PAPARAZZI_MESSAGE_SET_ACTUATOR_CONTROL_TARGET:
    append_uint64(p, msg->set_actuator_control_target.time_usec);
    for (size_t i = 0; i < 8; i++)
      append_float32(p, msg->set_actuator_control_target.controls[i]);
    append_byte(p, msg->set_actuator_control_target.group_mlx);
    append_byte(p, msg->set_actuator_control_target.target_system);
    append_byte(p, msg->set_actuator_control_target.target_component);
    break;

  case PAPARAZZI_MESSAGE_ACTUATOR_CONTROL_TARGET:
    append_uint64(p, msg->actuator_control_target.time_usec);
    for (size_t i = 0; i < 8; i++)
      append_float32(p, msg->actuator_control_target.controls[i]);
    append_byte(p, msg->actuator_control_target.group_mlx);
    break;

  case PAPARAZZI_MESSAGE_ALTITUDE:
    append_uint64(p, msg->altitude.time_usec);
    append_float32(p, msg->altitude.altitude_monotonic);
    append_float32(p, msg->altitude.altitude_amsl);
    append_float32(p, msg->altitude.altitude_local);
    append_float32(p, msg->altitude.altitude_relative);
    append_float32(p, msg->altitude.altitude_terrain);
    append_float32(p, msg->altitude.bottom_clearance);
    break;

  case PAPARAZZI_MESSAGE_RESOURCE_REQUEST:
    append_byte(p, msg->resource_request.request_id);
    append_byte(p, msg->resource_request.uri_type);
    for (size_t i = 0; i < 120; i++)
      append_byte(p, msg->resource_request.uri[i]);
    append_byte(p, msg->resource_request.transfer_type);
    for (size_t i = 0; i < 120; i++)
      append_byte(p, msg->resource_request.storage[i]);
    break;

  case PAPARAZZI_MESSAGE_SCALED_PRESSURE3:
    append_uint32(p, msg->scaled_pressure3.time_boot_ms);
    append_float32(p, msg->scaled_pressure3.press_abs);
    append_float32(p, msg->scaled_pressure3.press_diff);
    append_int16(p, msg->scaled_pressure3.temperature);
    break;

  case PAPARAZZI_MESSAGE_FOLLOW_TARGET:
    append_uint64(p, msg->follow_target.timestamp);
    append_uint64(p, msg->follow_target.custom_state);
    append_int32(p, msg->follow_target.lat);
    append_int32(p, msg->follow_target.lon);
    append_float32(p, msg->follow_target.alt);
    for (size_t i = 0; i < 3; i++)
      append_float32(p, msg->follow_target.vel[i]);
    for (size_t i = 0; i < 3; i++)
      append_float32(p, msg->follow_target.acc[i]);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->follow_target.attitude_q[i]);
    for (size_t i = 0; i < 3; i++)
      append_float32(p, msg->follow_target.rates[i]);
    for (size_t i = 0; i < 3; i++)
      append_float32(p, msg->follow_target.position_cov[i]);
    append_byte(p, msg->follow_target.est_capabilities);
    break;

  case PAPARAZZI_MESSAGE_CONTROL_SYSTEM_STATE:
    append_uint64(p, msg->control_system_state.time_usec);
    append_float32(p, msg->control_system_state.x_acc);
    append_float32(p, msg->control_system_state.y_acc);
    append_float32(p, msg->control_system_state.z_acc);
    append_float32(p, msg->control_system_state.x_vel);
    append_float32(p, msg->control_system_state.y_vel);
    append_float32(p, msg->control_system_state.z_vel);
    append_float32(p, msg->control_system_state.x_pos);
    append_float32(p, msg->control_system_state.y_pos);
    append_float32(p, msg->control_system_state.z_pos);
    append_float32(p, msg->control_system_state.airspeed);
    for (size_t i = 0; i < 3; i++)
      append_float32(p, msg->control_system_state.vel_variance[i]);
    for (size_t i = 0; i < 3; i++)
      append_float32(p, msg->control_system_state.pos_variance[i]);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->control_system_state.q[i]);
    append_float32(p, msg->control_system_state.roll_rate);
    append_float32(p, msg->control_system_state.pitch_rate);
    append_float32(p, msg->control_system_state.yaw_rate);
    break;

  case PAPARAZZI_MESSAGE_BATTERY_STATUS:
    append_int32(p, msg->battery_status.current_consumed);
    append_int32(p, msg->battery_status.energy_consumed);
    append_int16(p, msg->battery_status.temperature);
    for (size_t i = 0; i < 10; i++)
      append_uint16(p, msg->battery_status.voltages[i]);
    append_int16(p, msg->battery_status.current_battery);
    append_byte(p, msg->battery_status.id);
    append_byte(p, msg->battery_status.battery_function);
    append_byte(p, msg->battery_status.type);
    append_int8(p, msg->battery_status.battery_remaining);
    break;

  case PAPARAZZI_MESSAGE_AUTOPILOT_VERSION:
    append_uint64(p, msg->autopilot_version.capabilities);
    append_uint64(p, msg->autopilot_version.uid);
    append_uint32(p, msg->autopilot_version.flight_sw_version);
    append_uint32(p, msg->autopilot_version.middleware_sw_version);
    append_uint32(p, msg->autopilot_version.os_sw_version);
    append_uint32(p, msg->autopilot_version.board_version);
    append_uint16(p, msg->autopilot_version.vendor_id);
    append_uint16(p, msg->autopilot_version.product_id);
    for (size_t i = 0; i < 8; i++)
      append_byte(p, msg->autopilot_version.flight_custom_version[i]);
    for (size_t i = 0; i < 8; i++)
      append_byte(p, msg->autopilot_version.middleware_custom_version[i]);
    for (size_t i = 0; i < 8; i++)
      append_byte(p, msg->autopilot_version.os_custom_version[i]);
    break;

  case PAPARAZZI_MESSAGE_LANDING_TARGET:
    append_uint64(p, msg->landing_target.time_usec);
    append_float32(p, msg->landing_target.angle_x);
    append_float32(p, msg->landing_target.angle_y);
    append_float32(p, msg->landing_target.distance);
    append_float32(p, msg->landing_target.size_x);
    append_float32(p, msg->landing_target.size_y);
    append_byte(p, msg->landing_target.target_num);
    append_byte(p, msg->landing_target.frame);
    break;

  case PAPARAZZI_MESSAGE_SCRIPT_ITEM:
    append_uint16(p, msg->script_item.seq);
    append_byte(p, msg->script_item.target_system);
    append_byte(p, msg->script_item.target_component);
    for (size_t i = 0; i < 50; i++)
      append_byte(p, msg->script_item.name[i]);
    break;

  case PAPARAZZI_MESSAGE_SCRIPT_REQUEST:
    append_uint16(p, msg->script_request.seq);
    append_byte(p, msg->script_request.target_system);
    append_byte(p, msg->script_request.target_component);
    break;

  case PAPARAZZI_MESSAGE_SCRIPT_REQUEST_LIST:
    append_byte(p, msg->script_request_list.target_system);
    append_byte(p, msg->script_request_list.target_component);
    break;

  case PAPARAZZI_MESSAGE_SCRIPT_COUNT:
    append_uint16(p, msg->script_count.count);
    append_byte(p, msg->script_count.target_system);
    append_byte(p, msg->script_count.target_component);
    break;

  case PAPARAZZI_MESSAGE_SCRIPT_CURRENT:
    append_uint16(p, msg->script_current.seq);
    break;

  case PAPARAZZI_MESSAGE_ESTIMATOR_STATUS:
    append_uint64(p, msg->estimator_status.time_usec);
    append_float32(p, msg->estimator_status.vel_ratio);
    append_float32(p, msg->estimator_status.pos_horiz_ratio);
    append_float32(p, msg->estimator_status.pos_vert_ratio);
    append_float32(p, msg->estimator_status.mag_ratio);
    append_float32(p, msg->estimator_status.hagl_ratio);
    append_float32(p, msg->estimator_status.tas_ratio);
    append_float32(p, msg->estimator_status.pos_horiz_accuracy);
    append_float32(p, msg->estimator_status.pos_vert_accuracy);
    append_uint16(p, msg->estimator_status.flags);
    break;

  case PAPARAZZI_MESSAGE_WIND_COV:
    append_uint64(p, msg->wind_cov.time_usec);
    append_float32(p, msg->wind_cov.wind_x);
    append_float32(p, msg->wind_cov.wind_y);
    append_float32(p, msg->wind_cov.wind_z);
    append_float32(p, msg->wind_cov.var_horiz);
    append_float32(p, msg->wind_cov.var_vert);
    append_float32(p, msg->wind_cov.wind_alt);
    append_float32(p, msg->wind_cov.horiz_accuracy);
    append_float32(p, msg->wind_cov.vert_accuracy);
    break;

  case PAPARAZZI_MESSAGE_GPS_INPUT:
    append_uint64(p, msg->gps_input.time_usec);
    append_uint32(p, msg->gps_input.time_week_ms);
    append_int32(p, msg->gps_input.lat);
    append_int32(p, msg->gps_input.lon);
    append_float32(p, msg->gps_input.alt);
    append_float32(p, msg->gps_input.hdop);
    append_float32(p, msg->gps_input.vdop);
    append_float32(p, msg->gps_input.vn);
    append_float32(p, msg->gps_input.ve);
    append_float32(p, msg->gps_input.vd);
    append_float32(p, msg->gps_input.speed_accuracy);
    append_float32(p, msg->gps_input.horiz_accuracy);
    append_float32(p, msg->gps_input.vert_accuracy);
    append_uint16(p, msg->gps_input.ignore_flags);
    append_uint16(p, msg->gps_input.time_week);
    append_byte(p, msg->gps_input.gps_id);
    append_byte(p, msg->gps_input.fix_type);
    append_byte(p, msg->gps_input.satellites_visible);
    break;

  case PAPARAZZI_MESSAGE_GPS_RTCM_DATA:
    append_byte(p, msg->gps_rtcm_data.flags);
    append_byte(p, msg->gps_rtcm_data.len);
    for (size_t i = 0; i < 180; i++)
      append_byte(p, msg->gps_rtcm_data.data[i]);
    break;

  case PAPARAZZI_MESSAGE_HIGH_LATENCY:
    append_uint32(p, msg->high_latency.custom_mode);
    append_int32(p, msg->high_latency.latitude);
    append_int32(p, msg->high_latency.longitude);
    append_int16(p, msg->high_latency.roll);
    append_int16(p, msg->high_latency.pitch);
    append_uint16(p, msg->high_latency.heading);
    append_int16(p, msg->high_latency.heading_sp);
    append_int16(p, msg->high_latency.altitude_amsl);
    append_int16(p, msg->high_latency.altitude_sp);
    append_uint16(p, msg->high_latency.wp_distance);
    append_byte(p, msg->high_latency.base_mode);
    append_byte(p, msg->high_latency.landed_state);
    append_int8(p, msg->high_latency.throttle);
    append_byte(p, msg->high_latency.airspeed);
    append_byte(p, msg->high_latency.airspeed_sp);
    append_byte(p, msg->high_latency.groundspeed);
    append_int8(p, msg->high_latency.climb_rate);
    append_byte(p, msg->high_latency.gps_nsat);
    append_byte(p, msg->high_latency.gps_fix_type);
    append_byte(p, msg->high_latency.battery_remaining);
    append_int8(p, msg->high_latency.temperature);
    append_int8(p, msg->high_latency.temperature_air);
    append_byte(p, msg->high_latency.failsafe);
    append_byte(p, msg->high_latency.wp_num);
    break;

  case PAPARAZZI_MESSAGE_HIGH_LATENCY2:
    append_uint32(p, msg->high_latency2.timestamp);
    append_int32(p, msg->high_latency2.latitude);
    append_int32(p, msg->high_latency2.longitude);
    append_uint16(p, msg->high_latency2.custom_mode);
    append_int16(p, msg->high_latency2.altitude);
    append_int16(p, msg->high_latency2.target_altitude);
    append_uint16(p, msg->high_latency2.target_distance);
    append_uint16(p, msg->high_latency2.wp_num);
    append_uint16(p, msg->high_latency2.failure_flags);
    append_byte(p, msg->high_latency2.type);
    append_byte(p, msg->high_latency2.autopilot);
    append_byte(p, msg->high_latency2.heading);
    append_byte(p, msg->high_latency2.target_heading);
    append_byte(p, msg->high_latency2.throttle);
    append_byte(p, msg->high_latency2.airspeed);
    append_byte(p, msg->high_latency2.airspeed_sp);
    append_byte(p, msg->high_latency2.groundspeed);
    append_byte(p, msg->high_latency2.windspeed);
    append_byte(p, msg->high_latency2.wind_heading);
    append_byte(p, msg->high_latency2.eph);
    append_byte(p, msg->high_latency2.epv);
    append_int8(p, msg->high_latency2.temperature_air);
    append_int8(p, msg->high_latency2.climb_rate);
    append_int8(p, msg->high_latency2.battery);
    append_int8(p, msg->high_latency2.custom0);
    append_int8(p, msg->high_latency2.custom1);
    append_int8(p, msg->high_latency2.custom2);
    break;

  case PAPARAZZI_MESSAGE_VIBRATION:
    append_uint64(p, msg->vibration.time_usec);
    append_float32(p, msg->vibration.vibration_x);
    append_float32(p, msg->vibration.vibration_y);
    append_float32(p, msg->vibration.vibration_z);
    append_uint32(p, msg->vibration.clipping_0);
    append_uint32(p, msg->vibration.clipping_1);
    append_uint32(p, msg->vibration.clipping_2);
    break;

  case PAPARAZZI_MESSAGE_HOME_POSITION:
    append_int32(p, msg->home_position.latitude);
    append_int32(p, msg->home_position.longitude);
    append_int32(p, msg->home_position.altitude);
    append_float32(p, msg->home_position.x);
    append_float32(p, msg->home_position.y);
    append_float32(p, msg->home_position.z);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->home_position.q[i]);
    append_float32(p, msg->home_position.approach_x);
    append_float32(p, msg->home_position.approach_y);
    append_float32(p, msg->home_position.approach_z);
    break;

  case PAPARAZZI_MESSAGE_SET_HOME_POSITION:
    append_int32(p, msg->set_home_position.latitude);
    append_int32(p, msg->set_home_position.longitude);
    append_int32(p, msg->set_home_position.altitude);
    append_float32(p, msg->set_home_position.x);
    append_float32(p, msg->set_home_position.y);
    append_float32(p, msg->set_home_position.z);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->set_home_position.q[i]);
    append_float32(p, msg->set_home_position.approach_x);
    append_float32(p, msg->set_home_position.approach_y);
    append_float32(p, msg->set_home_position.approach_z);
    append_byte(p, msg->set_home_position.target_system);
    break;

  case PAPARAZZI_MESSAGE_MESSAGE_INTERVAL:
    append_int32(p, msg->message_interval.interval_us);
    append_uint16(p, msg->message_interval.message_id);
    break;

  case PAPARAZZI_MESSAGE_EXTENDED_SYS_STATE:
    append_byte(p, msg->extended_sys_state.vtol_state);
    append_byte(p, msg->extended_sys_state.landed_state);
    break;

  case PAPARAZZI_MESSAGE_ADSB_VEHICLE:
    append_uint32(p, msg->adsb_vehicle.ICAO_address);
    append_int32(p, msg->adsb_vehicle.lat);
    append_int32(p, msg->adsb_vehicle.lon);
    append_int32(p, msg->adsb_vehicle.altitude);
    append_uint16(p, msg->adsb_vehicle.heading);
    append_uint16(p, msg->adsb_vehicle.hor_velocity);
    append_int16(p, msg->adsb_vehicle.ver_velocity);
    append_uint16(p, msg->adsb_vehicle.flags);
    append_uint16(p, msg->adsb_vehicle.squawk);
    append_byte(p, msg->adsb_vehicle.altitude_type);
    for (size_t i = 0; i < 9; i++)
      append_byte(p, msg->adsb_vehicle.callsign[i]);
    append_byte(p, msg->adsb_vehicle.emitter_type);
    append_byte(p, msg->adsb_vehicle.tslc);
    break;

  case PAPARAZZI_MESSAGE_COLLISION:
    append_uint32(p, msg->collision.id);
    append_float32(p, msg->collision.time_to_minimum_delta);
    append_float32(p, msg->collision.altitude_minimum_delta);
    append_float32(p, msg->collision.horizontal_minimum_delta);
    append_byte(p, msg->collision.src);
    append_byte(p, msg->collision.action);
    append_byte(p, msg->collision.threat_level);
    break;

  case PAPARAZZI_MESSAGE_V2_EXTENSION:
    append_uint16(p, msg->v2_extension.message_type);
    append_byte(p, msg->v2_extension.target_network);
    append_byte(p, msg->v2_extension.target_system);
    append_byte(p, msg->v2_extension.target_component);
    for (size_t i = 0; i < 249; i++)
      append_byte(p, msg->v2_extension.payload[i]);
    break;

  case PAPARAZZI_MESSAGE_MEMORY_VECT:
    append_uint16(p, msg->memory_vect.address);
    append_byte(p, msg->memory_vect.ver);
    append_byte(p, msg->memory_vect.type);
    for (size_t i = 0; i < 32; i++)
      append_int8(p, msg->memory_vect.value[i]);
    break;

  case PAPARAZZI_MESSAGE_DEBUG_VECT:
    append_uint64(p, msg->debug_vect.time_usec);
    append_float32(p, msg->debug_vect.x);
    append_float32(p, msg->debug_vect.y);
    append_float32(p, msg->debug_vect.z);
    for (size_t i = 0; i < 10; i++)
      append_byte(p, msg->debug_vect.name[i]);
    break;

  case PAPARAZZI_MESSAGE_NAMED_VALUE_FLOAT:
    append_uint32(p, msg->named_value_float.time_boot_ms);
    append_float32(p, msg->named_value_float.value);
    for (size_t i = 0; i < 10; i++)
      append_byte(p, msg->named_value_float.name[i]);
    break;

  case PAPARAZZI_MESSAGE_NAMED_VALUE_INT:
    append_uint32(p, msg->named_value_int.time_boot_ms);
    append_int32(p, msg->named_value_int.value);
    for (size_t i = 0; i < 10; i++)
      append_byte(p, msg->named_value_int.name[i]);
    break;

  case PAPARAZZI_MESSAGE_STATUSTEXT:
    append_byte(p, msg->statustext.severity);
    for (size_t i = 0; i < 50; i++)
      append_byte(p, msg->statustext.text[i]);
    break;

  case PAPARAZZI_MESSAGE_DEBUG:
    append_uint32(p, msg->debug.time_boot_ms);
    append_float32(p, msg->debug.value);
    append_byte(p, msg->debug.ind);
    break;

  case PAPARAZZI_MESSAGE_SETUP_SIGNING:
    append_uint64(p, msg->setup_signing.initial_timestamp);
    append_byte(p, msg->setup_signing.target_system);
    append_byte(p, msg->setup_signing.target_component);
    for (size_t i = 0; i < 32; i++)
      append_byte(p, msg->setup_signing.secret_key[i]);
    break;

  case PAPARAZZI_MESSAGE_BUTTON_CHANGE:
    append_uint32(p, msg->button_change.time_boot_ms);
    append_uint32(p, msg->button_change.last_change_ms);
    append_byte(p, msg->button_change.state);
    break;

  case PAPARAZZI_MESSAGE_PLAY_TUNE:
    append_byte(p, msg->play_tune.target_system);
    append_byte(p, msg->play_tune.target_component);
    for (size_t i = 0; i < 30; i++)
      append_byte(p, msg->play_tune.tune[i]);
    break;

  case PAPARAZZI_MESSAGE_CAMERA_INFORMATION:
    append_uint32(p, msg->camera_information.time_boot_ms);
    append_uint32(p, msg->camera_information.firmware_version);
    append_float32(p, msg->camera_information.focal_length);
    append_float32(p, msg->camera_information.sensor_size_h);
    append_float32(p, msg->camera_information.sensor_size_v);
    append_uint32(p, msg->camera_information.flags);
    append_uint16(p, msg->camera_information.resolution_h);
    append_uint16(p, msg->camera_information.resolution_v);
    append_uint16(p, msg->camera_information.cam_definition_version);
    for (size_t i = 0; i < 32; i++)
      append_byte(p, msg->camera_information.vendor_name[i]);
    for (size_t i = 0; i < 32; i++)
      append_byte(p, msg->camera_information.model_name[i]);
    append_byte(p, msg->camera_information.lens_id);
    for (size_t i = 0; i < 140; i++)
      append_byte(p, msg->camera_information.cam_definition_uri[i]);
    break;

  case PAPARAZZI_MESSAGE_CAMERA_SETTINGS:
    append_uint32(p, msg->camera_settings.time_boot_ms);
    append_byte(p, msg->camera_settings.mode_id);
    break;

  case PAPARAZZI_MESSAGE_STORAGE_INFORMATION:
    append_uint32(p, msg->storage_information.time_boot_ms);
    append_float32(p, msg->storage_information.total_capacity);
    append_float32(p, msg->storage_information.used_capacity);
    append_float32(p, msg->storage_information.available_capacity);
    append_float32(p, msg->storage_information.read_speed);
    append_float32(p, msg->storage_information.write_speed);
    append_byte(p, msg->storage_information.storage_id);
    append_byte(p, msg->storage_information.storage_count);
    append_byte(p, msg->storage_information.status);
    break;

  case PAPARAZZI_MESSAGE_CAMERA_CAPTURE_STATUS:
    append_uint32(p, msg->camera_capture_status.time_boot_ms);
    append_float32(p, msg->camera_capture_status.image_interval);
    append_uint32(p, msg->camera_capture_status.recording_time_ms);
    append_float32(p, msg->camera_capture_status.available_capacity);
    append_byte(p, msg->camera_capture_status.image_status);
    append_byte(p, msg->camera_capture_status.video_status);
    break;

  case PAPARAZZI_MESSAGE_CAMERA_IMAGE_CAPTURED:
    append_uint64(p, msg->camera_image_captured.time_utc);
    append_uint32(p, msg->camera_image_captured.time_boot_ms);
    append_int32(p, msg->camera_image_captured.lat);
    append_int32(p, msg->camera_image_captured.lon);
    append_int32(p, msg->camera_image_captured.alt);
    append_int32(p, msg->camera_image_captured.relative_alt);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->camera_image_captured.q[i]);
    append_int32(p, msg->camera_image_captured.image_index);
    append_byte(p, msg->camera_image_captured.camera_id);
    append_int8(p, msg->camera_image_captured.capture_result);
    for (size_t i = 0; i < 205; i++)
      append_byte(p, msg->camera_image_captured.file_url[i]);
    break;

  case PAPARAZZI_MESSAGE_FLIGHT_INFORMATION:
    append_uint64(p, msg->flight_information.arming_time_utc);
    append_uint64(p, msg->flight_information.takeoff_time_utc);
    append_uint64(p, msg->flight_information.flight_uuid);
    append_uint32(p, msg->flight_information.time_boot_ms);
    break;

  case PAPARAZZI_MESSAGE_MOUNT_ORIENTATION:
    append_uint32(p, msg->mount_orientation.time_boot_ms);
    append_float32(p, msg->mount_orientation.roll);
    append_float32(p, msg->mount_orientation.pitch);
    append_float32(p, msg->mount_orientation.yaw);
    break;

  case PAPARAZZI_MESSAGE_LOGGING_DATA:
    append_uint16(p, msg->logging_data.sequence);
    append_byte(p, msg->logging_data.target_system);
    append_byte(p, msg->logging_data.target_component);
    append_byte(p, msg->logging_data.length);
    append_byte(p, msg->logging_data.first_message_offset);
    for (size_t i = 0; i < 249; i++)
      append_byte(p, msg->logging_data.data[i]);
    break;

  case PAPARAZZI_MESSAGE_LOGGING_DATA_ACKED:
    append_uint16(p, msg->logging_data_acked.sequence);
    append_byte(p, msg->logging_data_acked.target_system);
    append_byte(p, msg->logging_data_acked.target_component);
    append_byte(p, msg->logging_data_acked.length);
    append_byte(p, msg->logging_data_acked.first_message_offset);
    for (size_t i = 0; i < 249; i++)
      append_byte(p, msg->logging_data_acked.data[i]);
    break;

  case PAPARAZZI_MESSAGE_LOGGING_ACK:
    append_uint16(p, msg->logging_ack.sequence);
    append_byte(p, msg->logging_ack.target_system);
    append_byte(p, msg->logging_ack.target_component);
    break;

  case PAPARAZZI_MESSAGE_VIDEO_STREAM_INFORMATION:
    append_float32(p, msg->video_stream_information.framerate);
    append_uint32(p, msg->video_stream_information.bitrate);
    append_uint16(p, msg->video_stream_information.flags);
    append_uint16(p, msg->video_stream_information.resolution_h);
    append_uint16(p, msg->video_stream_information.resolution_v);
    append_uint16(p, msg->video_stream_information.rotation);
    append_uint16(p, msg->video_stream_information.hfov);
    append_byte(p, msg->video_stream_information.stream_id);
    append_byte(p, msg->video_stream_information.count);
    append_byte(p, msg->video_stream_information.type);
    for (size_t i = 0; i < 32; i++)
      append_byte(p, msg->video_stream_information.name[i]);
    for (size_t i = 0; i < 160; i++)
      append_byte(p, msg->video_stream_information.uri[i]);
    break;

  case PAPARAZZI_MESSAGE_VIDEO_STREAM_STATUS:
    append_float32(p, msg->video_stream_status.framerate);
    append_uint32(p, msg->video_stream_status.bitrate);
    append_uint16(p, msg->video_stream_status.flags);
    append_uint16(p, msg->video_stream_status.resolution_h);
    append_uint16(p, msg->video_stream_status.resolution_v);
    append_uint16(p, msg->video_stream_status.rotation);
    append_uint16(p, msg->video_stream_status.hfov);
    append_byte(p, msg->video_stream_status.stream_id);
    break;

  case PAPARAZZI_MESSAGE_WIFI_CONFIG_AP:

    for (size_t i = 0; i < 32; i++)
      append_byte(p, msg->wifi_config_ap.ssid[i]);
    for (size_t i = 0; i < 64; i++)
      append_byte(p, msg->wifi_config_ap.password[i]);
    break;

  case PAPARAZZI_MESSAGE_PROTOCOL_VERSION:
    append_uint16(p, msg->protocol_version.version);
    append_uint16(p, msg->protocol_version.min_version);
    append_uint16(p, msg->protocol_version.max_version);
    for (size_t i = 0; i < 8; i++)
      append_byte(p, msg->protocol_version.spec_version_hash[i]);
    for (size_t i = 0; i < 8; i++)
      append_byte(p, msg->protocol_version.library_version_hash[i]);
    break;

  case PAPARAZZI_MESSAGE_UAVCAN_NODE_STATUS:
    append_uint64(p, msg->uavcan_node_status.time_usec);
    append_uint32(p, msg->uavcan_node_status.uptime_sec);
    append_uint16(p, msg->uavcan_node_status.vendor_specific_status_code);
    append_byte(p, msg->uavcan_node_status.health);
    append_byte(p, msg->uavcan_node_status.mode);
    append_byte(p, msg->uavcan_node_status.sub_mode);
    break;

  case PAPARAZZI_MESSAGE_UAVCAN_NODE_INFO:
    append_uint64(p, msg->uavcan_node_info.time_usec);
    append_uint32(p, msg->uavcan_node_info.uptime_sec);
    append_uint32(p, msg->uavcan_node_info.sw_vcs_commit);
    for (size_t i = 0; i < 80; i++)
      append_byte(p, msg->uavcan_node_info.name[i]);
    append_byte(p, msg->uavcan_node_info.hw_version_major);
    append_byte(p, msg->uavcan_node_info.hw_version_minor);
    for (size_t i = 0; i < 16; i++)
      append_byte(p, msg->uavcan_node_info.hw_unique_id[i]);
    append_byte(p, msg->uavcan_node_info.sw_version_major);
    append_byte(p, msg->uavcan_node_info.sw_version_minor);
    break;

  case PAPARAZZI_MESSAGE_PARAM_EXT_REQUEST_READ:
    append_int16(p, msg->param_ext_request_read.param_index);
    append_byte(p, msg->param_ext_request_read.target_system);
    append_byte(p, msg->param_ext_request_read.target_component);
    for (size_t i = 0; i < 16; i++)
      append_byte(p, msg->param_ext_request_read.param_id[i]);
    break;

  case PAPARAZZI_MESSAGE_PARAM_EXT_REQUEST_LIST:
    append_byte(p, msg->param_ext_request_list.target_system);
    append_byte(p, msg->param_ext_request_list.target_component);
    break;

  case PAPARAZZI_MESSAGE_PARAM_EXT_VALUE:
    append_uint16(p, msg->param_ext_value.param_count);
    append_uint16(p, msg->param_ext_value.param_index);
    for (size_t i = 0; i < 16; i++)
      append_byte(p, msg->param_ext_value.param_id[i]);
    for (size_t i = 0; i < 128; i++)
      append_byte(p, msg->param_ext_value.param_value[i]);
    append_byte(p, msg->param_ext_value.param_type);
    break;

  case PAPARAZZI_MESSAGE_PARAM_EXT_SET:
    append_byte(p, msg->param_ext_set.target_system);
    append_byte(p, msg->param_ext_set.target_component);
    for (size_t i = 0; i < 16; i++)
      append_byte(p, msg->param_ext_set.param_id[i]);
    for (size_t i = 0; i < 128; i++)
      append_byte(p, msg->param_ext_set.param_value[i]);
    append_byte(p, msg->param_ext_set.param_type);
    break;

  case PAPARAZZI_MESSAGE_PARAM_EXT_ACK:

    for (size_t i = 0; i < 16; i++)
      append_byte(p, msg->param_ext_ack.param_id[i]);
    for (size_t i = 0; i < 128; i++)
      append_byte(p, msg->param_ext_ack.param_value[i]);
    append_byte(p, msg->param_ext_ack.param_type);
    append_byte(p, msg->param_ext_ack.param_result);
    break;

  case PAPARAZZI_MESSAGE_OBSTACLE_DISTANCE:
    append_uint64(p, msg->obstacle_distance.time_usec);
    for (size_t i = 0; i < 72; i++)
      append_uint16(p, msg->obstacle_distance.distances[i]);
    append_uint16(p, msg->obstacle_distance.min_distance);
    append_uint16(p, msg->obstacle_distance.max_distance);
    append_byte(p, msg->obstacle_distance.sensor_type);
    append_byte(p, msg->obstacle_distance.increment);
    break;

  case PAPARAZZI_MESSAGE_ODOMETRY:
    append_uint64(p, msg->odometry.time_usec);
    append_float32(p, msg->odometry.x);
    append_float32(p, msg->odometry.y);
    append_float32(p, msg->odometry.z);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->odometry.q[i]);
    append_float32(p, msg->odometry.vx);
    append_float32(p, msg->odometry.vy);
    append_float32(p, msg->odometry.vz);
    append_float32(p, msg->odometry.rollspeed);
    append_float32(p, msg->odometry.pitchspeed);
    append_float32(p, msg->odometry.yawspeed);
    for (size_t i = 0; i < 21; i++)
      append_float32(p, msg->odometry.pose_covariance[i]);
    for (size_t i = 0; i < 21; i++)
      append_float32(p, msg->odometry.velocity_covariance[i]);
    append_byte(p, msg->odometry.frame_id);
    append_byte(p, msg->odometry.child_frame_id);
    break;

  case PAPARAZZI_MESSAGE_TRAJECTORY_REPRESENTATION_WAYPOINTS:
    append_uint64(p, msg->trajectory_representation_waypoints.time_usec);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_waypoints.pos_x[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_waypoints.pos_y[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_waypoints.pos_z[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_waypoints.vel_x[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_waypoints.vel_y[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_waypoints.vel_z[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_waypoints.acc_x[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_waypoints.acc_y[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_waypoints.acc_z[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_waypoints.pos_yaw[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_waypoints.vel_yaw[i]);
    append_byte(p, msg->trajectory_representation_waypoints.valid_points);
    break;

  case PAPARAZZI_MESSAGE_TRAJECTORY_REPRESENTATION_BEZIER:
    append_uint64(p, msg->trajectory_representation_bezier.time_usec);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_bezier.pos_x[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_bezier.pos_y[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_bezier.pos_z[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_bezier.delta[i]);
    for (size_t i = 0; i < 5; i++)
      append_float32(p, msg->trajectory_representation_bezier.pos_yaw[i]);
    append_byte(p, msg->trajectory_representation_bezier.valid_points);
    break;

  case PAPARAZZI_MESSAGE_CELLULAR_STATUS:
    append_uint32(p, msg->cellular_status.cid);
    append_uint16(p, msg->cellular_status.status);
    append_uint16(p, msg->cellular_status.mcc);
    append_uint16(p, msg->cellular_status.mnc);
    append_uint16(p, msg->cellular_status.lac);
    append_byte(p, msg->cellular_status.type);
    append_byte(p, msg->cellular_status.quality);
    break;

  case PAPARAZZI_MESSAGE_ISBD_LINK_STATUS:
    append_uint64(p, msg->isbd_link_status.timestamp);
    append_uint64(p, msg->isbd_link_status.last_heartbeat);
    append_uint16(p, msg->isbd_link_status.failed_sessions);
    append_uint16(p, msg->isbd_link_status.successful_sessions);
    append_byte(p, msg->isbd_link_status.signal_quality);
    append_byte(p, msg->isbd_link_status.ring_pending);
    append_byte(p, msg->isbd_link_status.tx_session_pending);
    append_byte(p, msg->isbd_link_status.rx_session_pending);
    break;

  case PAPARAZZI_MESSAGE_UTM_GLOBAL_POSITION:
    append_uint64(p, msg->utm_global_position.time);
    append_int32(p, msg->utm_global_position.lat);
    append_int32(p, msg->utm_global_position.lon);
    append_int32(p, msg->utm_global_position.alt);
    append_int32(p, msg->utm_global_position.relative_alt);
    append_int32(p, msg->utm_global_position.next_lat);
    append_int32(p, msg->utm_global_position.next_lon);
    append_int32(p, msg->utm_global_position.next_alt);
    append_int16(p, msg->utm_global_position.vx);
    append_int16(p, msg->utm_global_position.vy);
    append_int16(p, msg->utm_global_position.vz);
    append_uint16(p, msg->utm_global_position.h_acc);
    append_uint16(p, msg->utm_global_position.v_acc);
    append_uint16(p, msg->utm_global_position.vel_acc);
    append_uint16(p, msg->utm_global_position.update_rate);
    for (size_t i = 0; i < 18; i++)
      append_byte(p, msg->utm_global_position.uas_id[i]);
    append_byte(p, msg->utm_global_position.flight_state);
    append_byte(p, msg->utm_global_position.flags);
    break;

  case PAPARAZZI_MESSAGE_DEBUG_FLOAT_ARRAY:
    append_uint64(p, msg->debug_float_array.time_usec);
    append_uint16(p, msg->debug_float_array.array_id);
    for (size_t i = 0; i < 10; i++)
      append_byte(p, msg->debug_float_array.name[i]);
    break;

  case PAPARAZZI_MESSAGE_ORBIT_EXECUTION_STATUS:
    append_uint64(p, msg->orbit_execution_status.time_usec);
    append_float32(p, msg->orbit_execution_status.radius);
    append_int32(p, msg->orbit_execution_status.x);
    append_int32(p, msg->orbit_execution_status.y);
    append_float32(p, msg->orbit_execution_status.z);
    append_byte(p, msg->orbit_execution_status.frame);
    break;

  case PAPARAZZI_MESSAGE_STATUSTEXT_LONG:
    append_byte(p, msg->statustext_long.severity);
    for (size_t i = 0; i < 254; i++)
      append_byte(p, msg->statustext_long.text[i]);
    break;

  case PAPARAZZI_MESSAGE_SMART_BATTERY_INFO:
    append_int32(p, msg->smart_battery_info.capacity_full_specification);
    append_int32(p, msg->smart_battery_info.capacity_full);
    append_int32(p, msg->smart_battery_info.serial_number);
    append_uint16(p, msg->smart_battery_info.cycle_count);
    append_uint16(p, msg->smart_battery_info.weight);
    append_uint16(p, msg->smart_battery_info.discharge_minimum_voltage);
    append_uint16(p, msg->smart_battery_info.charging_minimum_voltage);
    append_uint16(p, msg->smart_battery_info.resting_minimum_voltage);
    append_byte(p, msg->smart_battery_info.id);
    for (size_t i = 0; i < 50; i++)
      append_byte(p, msg->smart_battery_info.device_name[i]);
    break;

  case PAPARAZZI_MESSAGE_SMART_BATTERY_STATUS:
    append_int32(p, msg->smart_battery_status.fault_bitmask);
    append_int32(p, msg->smart_battery_status.time_remaining);
    append_uint16(p, msg->smart_battery_status.id);
    append_int16(p, msg->smart_battery_status.capacity_remaining);
    append_int16(p, msg->smart_battery_status.current);
    append_int16(p, msg->smart_battery_status.temperature);
    append_uint16(p, msg->smart_battery_status.cell_offset);
    for (size_t i = 0; i < 16; i++)
      append_uint16(p, msg->smart_battery_status.voltages[i]);
    break;

  case PAPARAZZI_MESSAGE_ACTUATOR_OUTPUT_STATUS:
    append_uint64(p, msg->actuator_output_status.time_usec);
    append_uint32(p, msg->actuator_output_status.active);
    for (size_t i = 0; i < 32; i++)
      append_float32(p, msg->actuator_output_status.actuator[i]);
    break;

  case PAPARAZZI_MESSAGE_TIME_ESTIMATE_TO_TARGET:
    append_int32(p, msg->time_estimate_to_target.safe_return);
    append_int32(p, msg->time_estimate_to_target.land);
    append_int32(p, msg->time_estimate_to_target.mission_next_item);
    append_int32(p, msg->time_estimate_to_target.mission_end);
    append_int32(p, msg->time_estimate_to_target.commanded_action);
    break;

  case PAPARAZZI_MESSAGE_WHEEL_DISTANCE:
    append_uint64(p, msg->wheel_distance.time_usec);
    for (size_t i = 0; i < 16; i++)
      append_float64(p, msg->wheel_distance.distance[i]);
    append_byte(p, msg->wheel_distance.count);
    break;
  };
}

static void append_payload_ext(uint8_t **p, struct paparazzi_message *msg) {
  switch (msg->msg_id) {

  case PAPARAZZI_MESSAGE_GPS_RAW_INT:
    append_int32(p, msg->gps_raw_int.alt_ellipsoid);
    append_uint32(p, msg->gps_raw_int.h_acc);
    append_uint32(p, msg->gps_raw_int.v_acc);
    append_uint32(p, msg->gps_raw_int.vel_acc);
    append_uint32(p, msg->gps_raw_int.hdg_acc);
    break;

  case PAPARAZZI_MESSAGE_SERVO_OUTPUT_RAW:
    append_uint16(p, msg->servo_output_raw.servo9_raw);
    append_uint16(p, msg->servo_output_raw.servo10_raw);
    append_uint16(p, msg->servo_output_raw.servo11_raw);
    append_uint16(p, msg->servo_output_raw.servo12_raw);
    append_uint16(p, msg->servo_output_raw.servo13_raw);
    append_uint16(p, msg->servo_output_raw.servo14_raw);
    append_uint16(p, msg->servo_output_raw.servo15_raw);
    append_uint16(p, msg->servo_output_raw.servo16_raw);
    break;

  case PAPARAZZI_MESSAGE_MISSION_REQUEST_PARTIAL_LIST:
    append_byte(p, msg->mission_request_partial_list.mission_type);
    break;

  case PAPARAZZI_MESSAGE_MISSION_WRITE_PARTIAL_LIST:
    append_byte(p, msg->mission_write_partial_list.mission_type);
    break;

  case PAPARAZZI_MESSAGE_MISSION_ITEM:
    append_byte(p, msg->mission_item.mission_type);
    break;

  case PAPARAZZI_MESSAGE_MISSION_REQUEST:
    append_byte(p, msg->mission_request.mission_type);
    break;

  case PAPARAZZI_MESSAGE_MISSION_REQUEST_LIST:
    append_byte(p, msg->mission_request_list.mission_type);
    break;

  case PAPARAZZI_MESSAGE_MISSION_COUNT:
    append_byte(p, msg->mission_count.mission_type);
    break;

  case PAPARAZZI_MESSAGE_MISSION_CLEAR_ALL:
    append_byte(p, msg->mission_clear_all.mission_type);
    break;

  case PAPARAZZI_MESSAGE_MISSION_ACK:
    append_byte(p, msg->mission_ack.mission_type);
    break;

  case PAPARAZZI_MESSAGE_SET_GPS_GLOBAL_ORIGIN:
    append_uint64(p, msg->set_gps_global_origin.time_usec);
    break;

  case PAPARAZZI_MESSAGE_GPS_GLOBAL_ORIGIN:
    append_uint64(p, msg->gps_global_origin.time_usec);
    break;

  case PAPARAZZI_MESSAGE_MISSION_REQUEST_INT:
    append_byte(p, msg->mission_request_int.mission_type);
    break;

  case PAPARAZZI_MESSAGE_RC_CHANNELS_OVERRIDE:
    append_uint16(p, msg->rc_channels_override.chan9_raw);
    append_uint16(p, msg->rc_channels_override.chan10_raw);
    append_uint16(p, msg->rc_channels_override.chan11_raw);
    append_uint16(p, msg->rc_channels_override.chan12_raw);
    append_uint16(p, msg->rc_channels_override.chan13_raw);
    append_uint16(p, msg->rc_channels_override.chan14_raw);
    append_uint16(p, msg->rc_channels_override.chan15_raw);
    append_uint16(p, msg->rc_channels_override.chan16_raw);
    append_uint16(p, msg->rc_channels_override.chan17_raw);
    append_uint16(p, msg->rc_channels_override.chan18_raw);
    break;

  case PAPARAZZI_MESSAGE_MISSION_ITEM_INT:
    append_byte(p, msg->mission_item_int.mission_type);
    break;

  case PAPARAZZI_MESSAGE_COMMAND_ACK:
    append_int32(p, msg->command_ack.result_param2);
    append_byte(p, msg->command_ack.progress);
    append_byte(p, msg->command_ack.target_system);
    append_byte(p, msg->command_ack.target_component);
    break;

  case PAPARAZZI_MESSAGE_OPTICAL_FLOW:
    append_float32(p, msg->optical_flow.flow_rate_x);
    append_float32(p, msg->optical_flow.flow_rate_y);
    break;

  case PAPARAZZI_MESSAGE_GLOBAL_VISION_POSITION_ESTIMATE:
    for (size_t i = 0; i < 21; i++)
      append_float32(p, msg->global_vision_position_estimate.covariance[i]);
    append_byte(p, msg->global_vision_position_estimate.reset_counter);
    break;

  case PAPARAZZI_MESSAGE_VISION_POSITION_ESTIMATE:
    for (size_t i = 0; i < 21; i++)
      append_float32(p, msg->vision_position_estimate.covariance[i]);
    append_byte(p, msg->vision_position_estimate.reset_counter);
    break;

  case PAPARAZZI_MESSAGE_VISION_SPEED_ESTIMATE:
    for (size_t i = 0; i < 9; i++)
      append_float32(p, msg->vision_speed_estimate.covariance[i]);
    append_byte(p, msg->vision_speed_estimate.reset_counter);
    break;

  case PAPARAZZI_MESSAGE_VICON_POSITION_ESTIMATE:
    for (size_t i = 0; i < 21; i++)
      append_float32(p, msg->vicon_position_estimate.covariance[i]);
    break;

  case PAPARAZZI_MESSAGE_DISTANCE_SENSOR:
    append_float32(p, msg->distance_sensor.horizontal_fov);
    append_float32(p, msg->distance_sensor.vertical_fov);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->distance_sensor.quaternion[i]);
    break;

  case PAPARAZZI_MESSAGE_ATT_POS_MOCAP:
    for (size_t i = 0; i < 21; i++)
      append_float32(p, msg->att_pos_mocap.covariance[i]);
    break;

  case PAPARAZZI_MESSAGE_BATTERY_STATUS:
    append_int32(p, msg->battery_status.time_remaining);
    append_byte(p, msg->battery_status.charge_state);
    break;

  case PAPARAZZI_MESSAGE_AUTOPILOT_VERSION:
    for (size_t i = 0; i < 18; i++)
      append_byte(p, msg->autopilot_version.uid2[i]);
    break;

  case PAPARAZZI_MESSAGE_LANDING_TARGET:
    append_float32(p, msg->landing_target.x);
    append_float32(p, msg->landing_target.y);
    append_float32(p, msg->landing_target.z);
    for (size_t i = 0; i < 4; i++)
      append_float32(p, msg->landing_target.q[i]);
    append_byte(p, msg->landing_target.type);
    append_byte(p, msg->landing_target.position_valid);
    break;

  case PAPARAZZI_MESSAGE_HOME_POSITION:
    append_uint64(p, msg->home_position.time_usec);
    break;

  case PAPARAZZI_MESSAGE_SET_HOME_POSITION:
    append_uint64(p, msg->set_home_position.time_usec);
    break;

  case PAPARAZZI_MESSAGE_PLAY_TUNE:
    for (size_t i = 0; i < 200; i++)
      append_byte(p, msg->play_tune.tune2[i]);
    break;

  case PAPARAZZI_MESSAGE_CAMERA_SETTINGS:
    append_float32(p, msg->camera_settings.zoomLevel);
    append_float32(p, msg->camera_settings.focusLevel);
    break;

  case PAPARAZZI_MESSAGE_MOUNT_ORIENTATION:
    append_float32(p, msg->mount_orientation.yaw_absolute);
    break;

  case PAPARAZZI_MESSAGE_OBSTACLE_DISTANCE:
    append_float32(p, msg->obstacle_distance.increment_f);
    append_float32(p, msg->obstacle_distance.angle_offset);
    break;

  case PAPARAZZI_MESSAGE_ODOMETRY:
    append_byte(p, msg->odometry.reset_counter);
    break;

  case PAPARAZZI_MESSAGE_DEBUG_FLOAT_ARRAY:
    for (size_t i = 0; i < 58; i++)
      append_float32(p, msg->debug_float_array.data[i]);
    break;

  default:; // nix
  };
}

size_t paparazzi_message_serialize_v1(struct paparazzi_message *msg,
                                      uint8_t *buf, size_t size) {

  if (msg->msg_id > 255)
    return 0;

  // it's faster to alloc and copy at end than to test buf[size] bound at every
  // byte
  uint8_t tmp[264];
  uint8_t *p = tmp;

  *p++ = 0xFE; // V1 STX
  *p++ = 0;    // placeholder for len
  *p++ = msg->seq_nr;
  *p++ = msg->sys_id;
  *p++ = msg->comp_id;
  *p++ = msg->msg_id;

  append_payload_base(&p, msg);

  tmp[1] = p - tmp - 6; // set len

  uint16_t crc = 0xffff;
  for (uint8_t *pp = tmp; pp < p; ++pp) {
    crc = x25(crc, *pp);
  }
  crc = x25(crc, paparazzi_crcextra(msg->msg_id));
  *p++ = crc; // overwrite crc_extra with the lower byte
  *p++ = crc >> 8;

  size_t len = p - tmp;
  assert(len < sizeof tmp);
  if (len < size) {
    memmove(buf, tmp, len);
    ++msg->seq_nr;
    msg->len = len;
    msg->crc =
        crc; // may be useful for testing idempotency of serialize/deserialize
  }
  return len;
}

size_t paparazzi_message_serialize_v2(struct paparazzi_message *msg,
                                      uint8_t *buf, size_t size) {
  // it's faster to alloc and copy at end than to test buf[size] bound at every
  // byte
  uint8_t tmp[280];
  uint8_t *p = tmp;

  *p++ = 0xFD;                     // V2 STX
  *p++ = 0;                        // placeholder for len
  *p++ = (msg->signature) ? 1 : 0; // incompat flag (0x1 means signed)
  *p++ = 0;                        // compat flags
  *p++ = msg->seq_nr;
  *p++ = msg->sys_id;
  *p++ = msg->comp_id;
  *p++ = msg->msg_id;
  *p++ = msg->msg_id >> 8;
  *p++ = msg->msg_id >> 16; // 10 bytes

  append_payload_base(&p, msg);
  append_payload_ext(&p, msg);

  // trim trailing zeroes, a v2 only feature
  while (*--p == 0)
    if (p <= tmp + 10)
      break;
  // now p points to the last non-zero element of tmp;
  ++p;

  tmp[1] = p - tmp - 10; // fill in len

  uint16_t crc = 0xffff;
  for (uint8_t *pp = tmp; pp < p; ++pp) {
    crc = x25(crc, *pp);
  }
  crc = x25(crc, paparazzi_crcextra(msg->msg_id));

  *p++ = crc;
  *p++ = crc >> 8;

  // zero is never a valid signature. if your hash turns out to zero you've
  // mined a bitcoin.
  if (msg->signature) {
    *p++ = msg->link_id;
    append_uint16(&p, msg->timestamp);
    append_uint32(&p, msg->timestamp >> 16);
    append_uint16(&p, msg->signature);
    append_uint32(&p, msg->signature >> 16);
  }

  size_t len = p - tmp;
  assert(len < sizeof tmp);
  if (len < size) {
    memmove(buf, tmp, len);
    ++msg->seq_nr;
    msg->len = len;
    msg->crc =
        crc; // may be useful for testing idempotency of serialize/deserialize
  }
  return len;
}
