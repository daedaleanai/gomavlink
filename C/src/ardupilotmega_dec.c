// Generated enums and structures for Mavlink dialect ardupilotmega #2 version 3
// Generated by gomavlink, DO NOT EDIT.

#include <assert.h>
#include <string.h>

#include "ardupilotmega.h"

// defined in ardupilotmega_crc.h
uint8_t ardupilotmega_crcextra(enum ARDUPILOTMEGA_MESSAGE mid);

inline static uint8_t read_byte(const uint8_t **p) { return *(*p)++; }
inline static int8_t read_int8(const uint8_t **p) { return *(*p)++; }
inline static int16_t read_int16(const uint8_t **p) {
  int16_t r = *(*p)++;
  r |= *(*p)++ << 8;
  return r;
}
inline static uint16_t read_uint16(const uint8_t **p) {
  uint16_t r = *(*p)++;
  r |= *(*p)++ << 8;
  return r;
}
inline static int32_t read_int32(const uint8_t **p) {
  int32_t r = *(*p)++;
  r |= *(*p)++ << 8;
  r |= *(*p)++ << 16;
  r |= *(*p)++ << 24;
  return r;
}
inline static uint32_t read_uint32(const uint8_t **p) {
  uint32_t r = *(*p)++;
  r |= *(*p)++ << 8;
  r |= *(*p)++ << 16;
  r |= *(*p)++ << 24;
  return r;
}
inline static int64_t read_int64(const uint8_t **p) {
  int64_t r = read_uint32(p);
  r |= ((int64_t)read_int32(p)) << 32;
  return r;
}
inline static uint64_t read_uint64(const uint8_t **p) {
  uint64_t r = read_uint32(p);
  r |= ((uint64_t)read_uint32(p)) << 32;
  return r;
}

inline static float read_float32(const uint8_t **p) {
  uint32_t v = read_uint32(p);
  return *(float *)&v;
}
inline static double read_float64(const uint8_t **p) {
  uint64_t v = read_uint64(p);
  return *(double *)&v;
}

inline static uint16_t x25(uint16_t crc, uint8_t v) {
  v ^= crc;
  v ^= v << 4;
  return (crc >> 8) ^ (v << 8) ^ (v << 3) ^
         (v >> 4); // (uint8_t << int) is promoted to int (!!)
}

static void read_payload_base(const uint8_t **p,
                              struct ardupilotmega_message *msg) {
  switch (msg->msg_id) {

  case ARDUPILOTMEGA_MESSAGE_HEARTBEAT:
    msg->heartbeat.custom_mode = read_uint32(p);
    msg->heartbeat.type = read_byte(p);
    msg->heartbeat.autopilot = read_byte(p);
    msg->heartbeat.base_mode = read_byte(p);
    msg->heartbeat.system_status = read_byte(p);
    msg->heartbeat.mavlink_version = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SYS_STATUS:
    msg->sys_status.onboard_control_sensors_present = read_uint32(p);
    msg->sys_status.onboard_control_sensors_enabled = read_uint32(p);
    msg->sys_status.onboard_control_sensors_health = read_uint32(p);
    msg->sys_status.load = read_uint16(p);
    msg->sys_status.voltage_battery = read_uint16(p);
    msg->sys_status.current_battery = read_int16(p);
    msg->sys_status.drop_rate_comm = read_uint16(p);
    msg->sys_status.errors_comm = read_uint16(p);
    msg->sys_status.errors_count1 = read_uint16(p);
    msg->sys_status.errors_count2 = read_uint16(p);
    msg->sys_status.errors_count3 = read_uint16(p);
    msg->sys_status.errors_count4 = read_uint16(p);
    msg->sys_status.battery_remaining = read_int8(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SYSTEM_TIME:
    msg->system_time.time_unix_usec = read_uint64(p);
    msg->system_time.time_boot_ms = read_uint32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PING:
    msg->ping.time_usec = read_uint64(p);
    msg->ping.seq = read_uint32(p);
    msg->ping.target_system = read_byte(p);
    msg->ping.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CHANGE_OPERATOR_CONTROL:
    msg->change_operator_control.target_system = read_byte(p);
    msg->change_operator_control.control_request = read_byte(p);
    msg->change_operator_control.version = read_byte(p);
    for (size_t i = 0; i < 25; i++)
      msg->change_operator_control.passkey[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CHANGE_OPERATOR_CONTROL_ACK:
    msg->change_operator_control_ack.gcs_system_id = read_byte(p);
    msg->change_operator_control_ack.control_request = read_byte(p);
    msg->change_operator_control_ack.ack = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_AUTH_KEY:

    for (size_t i = 0; i < 32; i++)
      msg->auth_key.key[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LINK_NODE_STATUS:
    msg->link_node_status.timestamp = read_uint64(p);
    msg->link_node_status.tx_rate = read_uint32(p);
    msg->link_node_status.rx_rate = read_uint32(p);
    msg->link_node_status.messages_sent = read_uint32(p);
    msg->link_node_status.messages_received = read_uint32(p);
    msg->link_node_status.messages_lost = read_uint32(p);
    msg->link_node_status.rx_parse_err = read_uint16(p);
    msg->link_node_status.tx_overflows = read_uint16(p);
    msg->link_node_status.rx_overflows = read_uint16(p);
    msg->link_node_status.tx_buf = read_byte(p);
    msg->link_node_status.rx_buf = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SET_MODE:
    msg->set_mode.custom_mode = read_uint32(p);
    msg->set_mode.target_system = read_byte(p);
    msg->set_mode.base_mode = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PARAM_REQUEST_READ:
    msg->param_request_read.param_index = read_int16(p);
    msg->param_request_read.target_system = read_byte(p);
    msg->param_request_read.target_component = read_byte(p);
    for (size_t i = 0; i < 16; i++)
      msg->param_request_read.param_id[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PARAM_REQUEST_LIST:
    msg->param_request_list.target_system = read_byte(p);
    msg->param_request_list.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PARAM_VALUE:
    msg->param_value.param_value = read_float32(p);
    msg->param_value.param_count = read_uint16(p);
    msg->param_value.param_index = read_uint16(p);
    for (size_t i = 0; i < 16; i++)
      msg->param_value.param_id[i] = read_byte(p);
    msg->param_value.param_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PARAM_SET:
    msg->param_set.param_value = read_float32(p);
    msg->param_set.target_system = read_byte(p);
    msg->param_set.target_component = read_byte(p);
    for (size_t i = 0; i < 16; i++)
      msg->param_set.param_id[i] = read_byte(p);
    msg->param_set.param_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GPS_RAW_INT:
    msg->gps_raw_int.time_usec = read_uint64(p);
    msg->gps_raw_int.lat = read_int32(p);
    msg->gps_raw_int.lon = read_int32(p);
    msg->gps_raw_int.alt = read_int32(p);
    msg->gps_raw_int.eph = read_uint16(p);
    msg->gps_raw_int.epv = read_uint16(p);
    msg->gps_raw_int.vel = read_uint16(p);
    msg->gps_raw_int.cog = read_uint16(p);
    msg->gps_raw_int.fix_type = read_byte(p);
    msg->gps_raw_int.satellites_visible = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GPS_STATUS:
    msg->gps_status.satellites_visible = read_byte(p);
    for (size_t i = 0; i < 20; i++)
      msg->gps_status.satellite_prn[i] = read_byte(p);
    for (size_t i = 0; i < 20; i++)
      msg->gps_status.satellite_used[i] = read_byte(p);
    for (size_t i = 0; i < 20; i++)
      msg->gps_status.satellite_elevation[i] = read_byte(p);
    for (size_t i = 0; i < 20; i++)
      msg->gps_status.satellite_azimuth[i] = read_byte(p);
    for (size_t i = 0; i < 20; i++)
      msg->gps_status.satellite_snr[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SCALED_IMU:
    msg->scaled_imu.time_boot_ms = read_uint32(p);
    msg->scaled_imu.xacc = read_int16(p);
    msg->scaled_imu.yacc = read_int16(p);
    msg->scaled_imu.zacc = read_int16(p);
    msg->scaled_imu.xgyro = read_int16(p);
    msg->scaled_imu.ygyro = read_int16(p);
    msg->scaled_imu.zgyro = read_int16(p);
    msg->scaled_imu.xmag = read_int16(p);
    msg->scaled_imu.ymag = read_int16(p);
    msg->scaled_imu.zmag = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RAW_IMU:
    msg->raw_imu.time_usec = read_uint64(p);
    msg->raw_imu.xacc = read_int16(p);
    msg->raw_imu.yacc = read_int16(p);
    msg->raw_imu.zacc = read_int16(p);
    msg->raw_imu.xgyro = read_int16(p);
    msg->raw_imu.ygyro = read_int16(p);
    msg->raw_imu.zgyro = read_int16(p);
    msg->raw_imu.xmag = read_int16(p);
    msg->raw_imu.ymag = read_int16(p);
    msg->raw_imu.zmag = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RAW_PRESSURE:
    msg->raw_pressure.time_usec = read_uint64(p);
    msg->raw_pressure.press_abs = read_int16(p);
    msg->raw_pressure.press_diff1 = read_int16(p);
    msg->raw_pressure.press_diff2 = read_int16(p);
    msg->raw_pressure.temperature = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SCALED_PRESSURE:
    msg->scaled_pressure.time_boot_ms = read_uint32(p);
    msg->scaled_pressure.press_abs = read_float32(p);
    msg->scaled_pressure.press_diff = read_float32(p);
    msg->scaled_pressure.temperature = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ATTITUDE:
    msg->attitude.time_boot_ms = read_uint32(p);
    msg->attitude.roll = read_float32(p);
    msg->attitude.pitch = read_float32(p);
    msg->attitude.yaw = read_float32(p);
    msg->attitude.rollspeed = read_float32(p);
    msg->attitude.pitchspeed = read_float32(p);
    msg->attitude.yawspeed = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ATTITUDE_QUATERNION:
    msg->attitude_quaternion.time_boot_ms = read_uint32(p);
    msg->attitude_quaternion.q1 = read_float32(p);
    msg->attitude_quaternion.q2 = read_float32(p);
    msg->attitude_quaternion.q3 = read_float32(p);
    msg->attitude_quaternion.q4 = read_float32(p);
    msg->attitude_quaternion.rollspeed = read_float32(p);
    msg->attitude_quaternion.pitchspeed = read_float32(p);
    msg->attitude_quaternion.yawspeed = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOCAL_POSITION_NED:
    msg->local_position_ned.time_boot_ms = read_uint32(p);
    msg->local_position_ned.x = read_float32(p);
    msg->local_position_ned.y = read_float32(p);
    msg->local_position_ned.z = read_float32(p);
    msg->local_position_ned.vx = read_float32(p);
    msg->local_position_ned.vy = read_float32(p);
    msg->local_position_ned.vz = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GLOBAL_POSITION_INT:
    msg->global_position_int.time_boot_ms = read_uint32(p);
    msg->global_position_int.lat = read_int32(p);
    msg->global_position_int.lon = read_int32(p);
    msg->global_position_int.alt = read_int32(p);
    msg->global_position_int.relative_alt = read_int32(p);
    msg->global_position_int.vx = read_int16(p);
    msg->global_position_int.vy = read_int16(p);
    msg->global_position_int.vz = read_int16(p);
    msg->global_position_int.hdg = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RC_CHANNELS_SCALED:
    msg->rc_channels_scaled.time_boot_ms = read_uint32(p);
    msg->rc_channels_scaled.chan1_scaled = read_int16(p);
    msg->rc_channels_scaled.chan2_scaled = read_int16(p);
    msg->rc_channels_scaled.chan3_scaled = read_int16(p);
    msg->rc_channels_scaled.chan4_scaled = read_int16(p);
    msg->rc_channels_scaled.chan5_scaled = read_int16(p);
    msg->rc_channels_scaled.chan6_scaled = read_int16(p);
    msg->rc_channels_scaled.chan7_scaled = read_int16(p);
    msg->rc_channels_scaled.chan8_scaled = read_int16(p);
    msg->rc_channels_scaled.port = read_byte(p);
    msg->rc_channels_scaled.rssi = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RC_CHANNELS_RAW:
    msg->rc_channels_raw.time_boot_ms = read_uint32(p);
    msg->rc_channels_raw.chan1_raw = read_uint16(p);
    msg->rc_channels_raw.chan2_raw = read_uint16(p);
    msg->rc_channels_raw.chan3_raw = read_uint16(p);
    msg->rc_channels_raw.chan4_raw = read_uint16(p);
    msg->rc_channels_raw.chan5_raw = read_uint16(p);
    msg->rc_channels_raw.chan6_raw = read_uint16(p);
    msg->rc_channels_raw.chan7_raw = read_uint16(p);
    msg->rc_channels_raw.chan8_raw = read_uint16(p);
    msg->rc_channels_raw.port = read_byte(p);
    msg->rc_channels_raw.rssi = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SERVO_OUTPUT_RAW:
    msg->servo_output_raw.time_usec = read_uint32(p);
    msg->servo_output_raw.servo1_raw = read_uint16(p);
    msg->servo_output_raw.servo2_raw = read_uint16(p);
    msg->servo_output_raw.servo3_raw = read_uint16(p);
    msg->servo_output_raw.servo4_raw = read_uint16(p);
    msg->servo_output_raw.servo5_raw = read_uint16(p);
    msg->servo_output_raw.servo6_raw = read_uint16(p);
    msg->servo_output_raw.servo7_raw = read_uint16(p);
    msg->servo_output_raw.servo8_raw = read_uint16(p);
    msg->servo_output_raw.port = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_REQUEST_PARTIAL_LIST:
    msg->mission_request_partial_list.start_index = read_int16(p);
    msg->mission_request_partial_list.end_index = read_int16(p);
    msg->mission_request_partial_list.target_system = read_byte(p);
    msg->mission_request_partial_list.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_WRITE_PARTIAL_LIST:
    msg->mission_write_partial_list.start_index = read_int16(p);
    msg->mission_write_partial_list.end_index = read_int16(p);
    msg->mission_write_partial_list.target_system = read_byte(p);
    msg->mission_write_partial_list.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_ITEM:
    msg->mission_item.param1 = read_float32(p);
    msg->mission_item.param2 = read_float32(p);
    msg->mission_item.param3 = read_float32(p);
    msg->mission_item.param4 = read_float32(p);
    msg->mission_item.x = read_float32(p);
    msg->mission_item.y = read_float32(p);
    msg->mission_item.z = read_float32(p);
    msg->mission_item.seq = read_uint16(p);
    msg->mission_item.command = read_uint16(p);
    msg->mission_item.target_system = read_byte(p);
    msg->mission_item.target_component = read_byte(p);
    msg->mission_item.frame = read_byte(p);
    msg->mission_item.current = read_byte(p);
    msg->mission_item.autocontinue = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_REQUEST:
    msg->mission_request.seq = read_uint16(p);
    msg->mission_request.target_system = read_byte(p);
    msg->mission_request.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_SET_CURRENT:
    msg->mission_set_current.seq = read_uint16(p);
    msg->mission_set_current.target_system = read_byte(p);
    msg->mission_set_current.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_CURRENT:
    msg->mission_current.seq = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_REQUEST_LIST:
    msg->mission_request_list.target_system = read_byte(p);
    msg->mission_request_list.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_COUNT:
    msg->mission_count.count = read_uint16(p);
    msg->mission_count.target_system = read_byte(p);
    msg->mission_count.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_CLEAR_ALL:
    msg->mission_clear_all.target_system = read_byte(p);
    msg->mission_clear_all.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_ITEM_REACHED:
    msg->mission_item_reached.seq = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_ACK:
    msg->mission_ack.target_system = read_byte(p);
    msg->mission_ack.target_component = read_byte(p);
    msg->mission_ack.type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SET_GPS_GLOBAL_ORIGIN:
    msg->set_gps_global_origin.latitude = read_int32(p);
    msg->set_gps_global_origin.longitude = read_int32(p);
    msg->set_gps_global_origin.altitude = read_int32(p);
    msg->set_gps_global_origin.target_system = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GPS_GLOBAL_ORIGIN:
    msg->gps_global_origin.latitude = read_int32(p);
    msg->gps_global_origin.longitude = read_int32(p);
    msg->gps_global_origin.altitude = read_int32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PARAM_MAP_RC:
    msg->param_map_rc.param_value0 = read_float32(p);
    msg->param_map_rc.scale = read_float32(p);
    msg->param_map_rc.param_value_min = read_float32(p);
    msg->param_map_rc.param_value_max = read_float32(p);
    msg->param_map_rc.param_index = read_int16(p);
    msg->param_map_rc.target_system = read_byte(p);
    msg->param_map_rc.target_component = read_byte(p);
    for (size_t i = 0; i < 16; i++)
      msg->param_map_rc.param_id[i] = read_byte(p);
    msg->param_map_rc.parameter_rc_channel_index = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_REQUEST_INT:
    msg->mission_request_int.seq = read_uint16(p);
    msg->mission_request_int.target_system = read_byte(p);
    msg->mission_request_int.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_CHANGED:
    msg->mission_changed.start_index = read_int16(p);
    msg->mission_changed.end_index = read_int16(p);
    msg->mission_changed.origin_sysid = read_byte(p);
    msg->mission_changed.origin_compid = read_byte(p);
    msg->mission_changed.mission_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SAFETY_SET_ALLOWED_AREA:
    msg->safety_set_allowed_area.p1x = read_float32(p);
    msg->safety_set_allowed_area.p1y = read_float32(p);
    msg->safety_set_allowed_area.p1z = read_float32(p);
    msg->safety_set_allowed_area.p2x = read_float32(p);
    msg->safety_set_allowed_area.p2y = read_float32(p);
    msg->safety_set_allowed_area.p2z = read_float32(p);
    msg->safety_set_allowed_area.target_system = read_byte(p);
    msg->safety_set_allowed_area.target_component = read_byte(p);
    msg->safety_set_allowed_area.frame = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SAFETY_ALLOWED_AREA:
    msg->safety_allowed_area.p1x = read_float32(p);
    msg->safety_allowed_area.p1y = read_float32(p);
    msg->safety_allowed_area.p1z = read_float32(p);
    msg->safety_allowed_area.p2x = read_float32(p);
    msg->safety_allowed_area.p2y = read_float32(p);
    msg->safety_allowed_area.p2z = read_float32(p);
    msg->safety_allowed_area.frame = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ATTITUDE_QUATERNION_COV:
    msg->attitude_quaternion_cov.time_usec = read_uint64(p);
    for (size_t i = 0; i < 4; i++)
      msg->attitude_quaternion_cov.q[i] = read_float32(p);
    msg->attitude_quaternion_cov.rollspeed = read_float32(p);
    msg->attitude_quaternion_cov.pitchspeed = read_float32(p);
    msg->attitude_quaternion_cov.yawspeed = read_float32(p);
    for (size_t i = 0; i < 9; i++)
      msg->attitude_quaternion_cov.covariance[i] = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_NAV_CONTROLLER_OUTPUT:
    msg->nav_controller_output.nav_roll = read_float32(p);
    msg->nav_controller_output.nav_pitch = read_float32(p);
    msg->nav_controller_output.alt_error = read_float32(p);
    msg->nav_controller_output.aspd_error = read_float32(p);
    msg->nav_controller_output.xtrack_error = read_float32(p);
    msg->nav_controller_output.nav_bearing = read_int16(p);
    msg->nav_controller_output.target_bearing = read_int16(p);
    msg->nav_controller_output.wp_dist = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GLOBAL_POSITION_INT_COV:
    msg->global_position_int_cov.time_usec = read_uint64(p);
    msg->global_position_int_cov.lat = read_int32(p);
    msg->global_position_int_cov.lon = read_int32(p);
    msg->global_position_int_cov.alt = read_int32(p);
    msg->global_position_int_cov.relative_alt = read_int32(p);
    msg->global_position_int_cov.vx = read_float32(p);
    msg->global_position_int_cov.vy = read_float32(p);
    msg->global_position_int_cov.vz = read_float32(p);
    for (size_t i = 0; i < 36; i++)
      msg->global_position_int_cov.covariance[i] = read_float32(p);
    msg->global_position_int_cov.estimator_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOCAL_POSITION_NED_COV:
    msg->local_position_ned_cov.time_usec = read_uint64(p);
    msg->local_position_ned_cov.x = read_float32(p);
    msg->local_position_ned_cov.y = read_float32(p);
    msg->local_position_ned_cov.z = read_float32(p);
    msg->local_position_ned_cov.vx = read_float32(p);
    msg->local_position_ned_cov.vy = read_float32(p);
    msg->local_position_ned_cov.vz = read_float32(p);
    msg->local_position_ned_cov.ax = read_float32(p);
    msg->local_position_ned_cov.ay = read_float32(p);
    msg->local_position_ned_cov.az = read_float32(p);
    for (size_t i = 0; i < 45; i++)
      msg->local_position_ned_cov.covariance[i] = read_float32(p);
    msg->local_position_ned_cov.estimator_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RC_CHANNELS:
    msg->rc_channels.time_boot_ms = read_uint32(p);
    msg->rc_channels.chan1_raw = read_uint16(p);
    msg->rc_channels.chan2_raw = read_uint16(p);
    msg->rc_channels.chan3_raw = read_uint16(p);
    msg->rc_channels.chan4_raw = read_uint16(p);
    msg->rc_channels.chan5_raw = read_uint16(p);
    msg->rc_channels.chan6_raw = read_uint16(p);
    msg->rc_channels.chan7_raw = read_uint16(p);
    msg->rc_channels.chan8_raw = read_uint16(p);
    msg->rc_channels.chan9_raw = read_uint16(p);
    msg->rc_channels.chan10_raw = read_uint16(p);
    msg->rc_channels.chan11_raw = read_uint16(p);
    msg->rc_channels.chan12_raw = read_uint16(p);
    msg->rc_channels.chan13_raw = read_uint16(p);
    msg->rc_channels.chan14_raw = read_uint16(p);
    msg->rc_channels.chan15_raw = read_uint16(p);
    msg->rc_channels.chan16_raw = read_uint16(p);
    msg->rc_channels.chan17_raw = read_uint16(p);
    msg->rc_channels.chan18_raw = read_uint16(p);
    msg->rc_channels.chancount = read_byte(p);
    msg->rc_channels.rssi = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_REQUEST_DATA_STREAM:
    msg->request_data_stream.req_message_rate = read_uint16(p);
    msg->request_data_stream.target_system = read_byte(p);
    msg->request_data_stream.target_component = read_byte(p);
    msg->request_data_stream.req_stream_id = read_byte(p);
    msg->request_data_stream.start_stop = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DATA_STREAM:
    msg->data_stream.message_rate = read_uint16(p);
    msg->data_stream.stream_id = read_byte(p);
    msg->data_stream.on_off = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MANUAL_CONTROL:
    msg->manual_control.x = read_int16(p);
    msg->manual_control.y = read_int16(p);
    msg->manual_control.z = read_int16(p);
    msg->manual_control.r = read_int16(p);
    msg->manual_control.buttons = read_uint16(p);
    msg->manual_control.target = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RC_CHANNELS_OVERRIDE:
    msg->rc_channels_override.chan1_raw = read_uint16(p);
    msg->rc_channels_override.chan2_raw = read_uint16(p);
    msg->rc_channels_override.chan3_raw = read_uint16(p);
    msg->rc_channels_override.chan4_raw = read_uint16(p);
    msg->rc_channels_override.chan5_raw = read_uint16(p);
    msg->rc_channels_override.chan6_raw = read_uint16(p);
    msg->rc_channels_override.chan7_raw = read_uint16(p);
    msg->rc_channels_override.chan8_raw = read_uint16(p);
    msg->rc_channels_override.target_system = read_byte(p);
    msg->rc_channels_override.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_ITEM_INT:
    msg->mission_item_int.param1 = read_float32(p);
    msg->mission_item_int.param2 = read_float32(p);
    msg->mission_item_int.param3 = read_float32(p);
    msg->mission_item_int.param4 = read_float32(p);
    msg->mission_item_int.x = read_int32(p);
    msg->mission_item_int.y = read_int32(p);
    msg->mission_item_int.z = read_float32(p);
    msg->mission_item_int.seq = read_uint16(p);
    msg->mission_item_int.command = read_uint16(p);
    msg->mission_item_int.target_system = read_byte(p);
    msg->mission_item_int.target_component = read_byte(p);
    msg->mission_item_int.frame = read_byte(p);
    msg->mission_item_int.current = read_byte(p);
    msg->mission_item_int.autocontinue = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_VFR_HUD:
    msg->vfr_hud.airspeed = read_float32(p);
    msg->vfr_hud.groundspeed = read_float32(p);
    msg->vfr_hud.alt = read_float32(p);
    msg->vfr_hud.climb = read_float32(p);
    msg->vfr_hud.heading = read_int16(p);
    msg->vfr_hud.throttle = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_COMMAND_INT:
    msg->command_int.param1 = read_float32(p);
    msg->command_int.param2 = read_float32(p);
    msg->command_int.param3 = read_float32(p);
    msg->command_int.param4 = read_float32(p);
    msg->command_int.x = read_int32(p);
    msg->command_int.y = read_int32(p);
    msg->command_int.z = read_float32(p);
    msg->command_int.command = read_uint16(p);
    msg->command_int.target_system = read_byte(p);
    msg->command_int.target_component = read_byte(p);
    msg->command_int.frame = read_byte(p);
    msg->command_int.current = read_byte(p);
    msg->command_int.autocontinue = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_COMMAND_LONG:
    msg->command_long.param1 = read_float32(p);
    msg->command_long.param2 = read_float32(p);
    msg->command_long.param3 = read_float32(p);
    msg->command_long.param4 = read_float32(p);
    msg->command_long.param5 = read_float32(p);
    msg->command_long.param6 = read_float32(p);
    msg->command_long.param7 = read_float32(p);
    msg->command_long.command = read_uint16(p);
    msg->command_long.target_system = read_byte(p);
    msg->command_long.target_component = read_byte(p);
    msg->command_long.confirmation = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_COMMAND_ACK:
    msg->command_ack.command = read_uint16(p);
    msg->command_ack.result = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MANUAL_SETPOINT:
    msg->manual_setpoint.time_boot_ms = read_uint32(p);
    msg->manual_setpoint.roll = read_float32(p);
    msg->manual_setpoint.pitch = read_float32(p);
    msg->manual_setpoint.yaw = read_float32(p);
    msg->manual_setpoint.thrust = read_float32(p);
    msg->manual_setpoint.mode_switch = read_byte(p);
    msg->manual_setpoint.manual_override_switch = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SET_ATTITUDE_TARGET:
    msg->set_attitude_target.time_boot_ms = read_uint32(p);
    for (size_t i = 0; i < 4; i++)
      msg->set_attitude_target.q[i] = read_float32(p);
    msg->set_attitude_target.body_roll_rate = read_float32(p);
    msg->set_attitude_target.body_pitch_rate = read_float32(p);
    msg->set_attitude_target.body_yaw_rate = read_float32(p);
    msg->set_attitude_target.thrust = read_float32(p);
    msg->set_attitude_target.target_system = read_byte(p);
    msg->set_attitude_target.target_component = read_byte(p);
    msg->set_attitude_target.type_mask = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ATTITUDE_TARGET:
    msg->attitude_target.time_boot_ms = read_uint32(p);
    for (size_t i = 0; i < 4; i++)
      msg->attitude_target.q[i] = read_float32(p);
    msg->attitude_target.body_roll_rate = read_float32(p);
    msg->attitude_target.body_pitch_rate = read_float32(p);
    msg->attitude_target.body_yaw_rate = read_float32(p);
    msg->attitude_target.thrust = read_float32(p);
    msg->attitude_target.type_mask = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SET_POSITION_TARGET_LOCAL_NED:
    msg->set_position_target_local_ned.time_boot_ms = read_uint32(p);
    msg->set_position_target_local_ned.x = read_float32(p);
    msg->set_position_target_local_ned.y = read_float32(p);
    msg->set_position_target_local_ned.z = read_float32(p);
    msg->set_position_target_local_ned.vx = read_float32(p);
    msg->set_position_target_local_ned.vy = read_float32(p);
    msg->set_position_target_local_ned.vz = read_float32(p);
    msg->set_position_target_local_ned.afx = read_float32(p);
    msg->set_position_target_local_ned.afy = read_float32(p);
    msg->set_position_target_local_ned.afz = read_float32(p);
    msg->set_position_target_local_ned.yaw = read_float32(p);
    msg->set_position_target_local_ned.yaw_rate = read_float32(p);
    msg->set_position_target_local_ned.type_mask = read_uint16(p);
    msg->set_position_target_local_ned.target_system = read_byte(p);
    msg->set_position_target_local_ned.target_component = read_byte(p);
    msg->set_position_target_local_ned.coordinate_frame = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_POSITION_TARGET_LOCAL_NED:
    msg->position_target_local_ned.time_boot_ms = read_uint32(p);
    msg->position_target_local_ned.x = read_float32(p);
    msg->position_target_local_ned.y = read_float32(p);
    msg->position_target_local_ned.z = read_float32(p);
    msg->position_target_local_ned.vx = read_float32(p);
    msg->position_target_local_ned.vy = read_float32(p);
    msg->position_target_local_ned.vz = read_float32(p);
    msg->position_target_local_ned.afx = read_float32(p);
    msg->position_target_local_ned.afy = read_float32(p);
    msg->position_target_local_ned.afz = read_float32(p);
    msg->position_target_local_ned.yaw = read_float32(p);
    msg->position_target_local_ned.yaw_rate = read_float32(p);
    msg->position_target_local_ned.type_mask = read_uint16(p);
    msg->position_target_local_ned.coordinate_frame = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SET_POSITION_TARGET_GLOBAL_INT:
    msg->set_position_target_global_int.time_boot_ms = read_uint32(p);
    msg->set_position_target_global_int.lat_int = read_int32(p);
    msg->set_position_target_global_int.lon_int = read_int32(p);
    msg->set_position_target_global_int.alt = read_float32(p);
    msg->set_position_target_global_int.vx = read_float32(p);
    msg->set_position_target_global_int.vy = read_float32(p);
    msg->set_position_target_global_int.vz = read_float32(p);
    msg->set_position_target_global_int.afx = read_float32(p);
    msg->set_position_target_global_int.afy = read_float32(p);
    msg->set_position_target_global_int.afz = read_float32(p);
    msg->set_position_target_global_int.yaw = read_float32(p);
    msg->set_position_target_global_int.yaw_rate = read_float32(p);
    msg->set_position_target_global_int.type_mask = read_uint16(p);
    msg->set_position_target_global_int.target_system = read_byte(p);
    msg->set_position_target_global_int.target_component = read_byte(p);
    msg->set_position_target_global_int.coordinate_frame = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_POSITION_TARGET_GLOBAL_INT:
    msg->position_target_global_int.time_boot_ms = read_uint32(p);
    msg->position_target_global_int.lat_int = read_int32(p);
    msg->position_target_global_int.lon_int = read_int32(p);
    msg->position_target_global_int.alt = read_float32(p);
    msg->position_target_global_int.vx = read_float32(p);
    msg->position_target_global_int.vy = read_float32(p);
    msg->position_target_global_int.vz = read_float32(p);
    msg->position_target_global_int.afx = read_float32(p);
    msg->position_target_global_int.afy = read_float32(p);
    msg->position_target_global_int.afz = read_float32(p);
    msg->position_target_global_int.yaw = read_float32(p);
    msg->position_target_global_int.yaw_rate = read_float32(p);
    msg->position_target_global_int.type_mask = read_uint16(p);
    msg->position_target_global_int.coordinate_frame = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOCAL_POSITION_NED_SYSTEM_GLOBAL_OFFSET:
    msg->local_position_ned_system_global_offset.time_boot_ms = read_uint32(p);
    msg->local_position_ned_system_global_offset.x = read_float32(p);
    msg->local_position_ned_system_global_offset.y = read_float32(p);
    msg->local_position_ned_system_global_offset.z = read_float32(p);
    msg->local_position_ned_system_global_offset.roll = read_float32(p);
    msg->local_position_ned_system_global_offset.pitch = read_float32(p);
    msg->local_position_ned_system_global_offset.yaw = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HIL_STATE:
    msg->hil_state.time_usec = read_uint64(p);
    msg->hil_state.roll = read_float32(p);
    msg->hil_state.pitch = read_float32(p);
    msg->hil_state.yaw = read_float32(p);
    msg->hil_state.rollspeed = read_float32(p);
    msg->hil_state.pitchspeed = read_float32(p);
    msg->hil_state.yawspeed = read_float32(p);
    msg->hil_state.lat = read_int32(p);
    msg->hil_state.lon = read_int32(p);
    msg->hil_state.alt = read_int32(p);
    msg->hil_state.vx = read_int16(p);
    msg->hil_state.vy = read_int16(p);
    msg->hil_state.vz = read_int16(p);
    msg->hil_state.xacc = read_int16(p);
    msg->hil_state.yacc = read_int16(p);
    msg->hil_state.zacc = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HIL_CONTROLS:
    msg->hil_controls.time_usec = read_uint64(p);
    msg->hil_controls.roll_ailerons = read_float32(p);
    msg->hil_controls.pitch_elevator = read_float32(p);
    msg->hil_controls.yaw_rudder = read_float32(p);
    msg->hil_controls.throttle = read_float32(p);
    msg->hil_controls.aux1 = read_float32(p);
    msg->hil_controls.aux2 = read_float32(p);
    msg->hil_controls.aux3 = read_float32(p);
    msg->hil_controls.aux4 = read_float32(p);
    msg->hil_controls.mode = read_byte(p);
    msg->hil_controls.nav_mode = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HIL_RC_INPUTS_RAW:
    msg->hil_rc_inputs_raw.time_usec = read_uint64(p);
    msg->hil_rc_inputs_raw.chan1_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.chan2_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.chan3_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.chan4_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.chan5_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.chan6_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.chan7_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.chan8_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.chan9_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.chan10_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.chan11_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.chan12_raw = read_uint16(p);
    msg->hil_rc_inputs_raw.rssi = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HIL_ACTUATOR_CONTROLS:
    msg->hil_actuator_controls.time_usec = read_uint64(p);
    msg->hil_actuator_controls.flags = read_uint64(p);
    for (size_t i = 0; i < 16; i++)
      msg->hil_actuator_controls.controls[i] = read_float32(p);
    msg->hil_actuator_controls.mode = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_OPTICAL_FLOW:
    msg->optical_flow.time_usec = read_uint64(p);
    msg->optical_flow.flow_comp_m_x = read_float32(p);
    msg->optical_flow.flow_comp_m_y = read_float32(p);
    msg->optical_flow.ground_distance = read_float32(p);
    msg->optical_flow.flow_x = read_int16(p);
    msg->optical_flow.flow_y = read_int16(p);
    msg->optical_flow.sensor_id = read_byte(p);
    msg->optical_flow.quality = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GLOBAL_VISION_POSITION_ESTIMATE:
    msg->global_vision_position_estimate.usec = read_uint64(p);
    msg->global_vision_position_estimate.x = read_float32(p);
    msg->global_vision_position_estimate.y = read_float32(p);
    msg->global_vision_position_estimate.z = read_float32(p);
    msg->global_vision_position_estimate.roll = read_float32(p);
    msg->global_vision_position_estimate.pitch = read_float32(p);
    msg->global_vision_position_estimate.yaw = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_VISION_POSITION_ESTIMATE:
    msg->vision_position_estimate.usec = read_uint64(p);
    msg->vision_position_estimate.x = read_float32(p);
    msg->vision_position_estimate.y = read_float32(p);
    msg->vision_position_estimate.z = read_float32(p);
    msg->vision_position_estimate.roll = read_float32(p);
    msg->vision_position_estimate.pitch = read_float32(p);
    msg->vision_position_estimate.yaw = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_VISION_SPEED_ESTIMATE:
    msg->vision_speed_estimate.usec = read_uint64(p);
    msg->vision_speed_estimate.x = read_float32(p);
    msg->vision_speed_estimate.y = read_float32(p);
    msg->vision_speed_estimate.z = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_VICON_POSITION_ESTIMATE:
    msg->vicon_position_estimate.usec = read_uint64(p);
    msg->vicon_position_estimate.x = read_float32(p);
    msg->vicon_position_estimate.y = read_float32(p);
    msg->vicon_position_estimate.z = read_float32(p);
    msg->vicon_position_estimate.roll = read_float32(p);
    msg->vicon_position_estimate.pitch = read_float32(p);
    msg->vicon_position_estimate.yaw = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HIGHRES_IMU:
    msg->highres_imu.time_usec = read_uint64(p);
    msg->highres_imu.xacc = read_float32(p);
    msg->highres_imu.yacc = read_float32(p);
    msg->highres_imu.zacc = read_float32(p);
    msg->highres_imu.xgyro = read_float32(p);
    msg->highres_imu.ygyro = read_float32(p);
    msg->highres_imu.zgyro = read_float32(p);
    msg->highres_imu.xmag = read_float32(p);
    msg->highres_imu.ymag = read_float32(p);
    msg->highres_imu.zmag = read_float32(p);
    msg->highres_imu.abs_pressure = read_float32(p);
    msg->highres_imu.diff_pressure = read_float32(p);
    msg->highres_imu.pressure_alt = read_float32(p);
    msg->highres_imu.temperature = read_float32(p);
    msg->highres_imu.fields_updated = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_OPTICAL_FLOW_RAD:
    msg->optical_flow_rad.time_usec = read_uint64(p);
    msg->optical_flow_rad.integration_time_us = read_uint32(p);
    msg->optical_flow_rad.integrated_x = read_float32(p);
    msg->optical_flow_rad.integrated_y = read_float32(p);
    msg->optical_flow_rad.integrated_xgyro = read_float32(p);
    msg->optical_flow_rad.integrated_ygyro = read_float32(p);
    msg->optical_flow_rad.integrated_zgyro = read_float32(p);
    msg->optical_flow_rad.time_delta_distance_us = read_uint32(p);
    msg->optical_flow_rad.distance = read_float32(p);
    msg->optical_flow_rad.temperature = read_int16(p);
    msg->optical_flow_rad.sensor_id = read_byte(p);
    msg->optical_flow_rad.quality = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HIL_SENSOR:
    msg->hil_sensor.time_usec = read_uint64(p);
    msg->hil_sensor.xacc = read_float32(p);
    msg->hil_sensor.yacc = read_float32(p);
    msg->hil_sensor.zacc = read_float32(p);
    msg->hil_sensor.xgyro = read_float32(p);
    msg->hil_sensor.ygyro = read_float32(p);
    msg->hil_sensor.zgyro = read_float32(p);
    msg->hil_sensor.xmag = read_float32(p);
    msg->hil_sensor.ymag = read_float32(p);
    msg->hil_sensor.zmag = read_float32(p);
    msg->hil_sensor.abs_pressure = read_float32(p);
    msg->hil_sensor.diff_pressure = read_float32(p);
    msg->hil_sensor.pressure_alt = read_float32(p);
    msg->hil_sensor.temperature = read_float32(p);
    msg->hil_sensor.fields_updated = read_uint32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SIM_STATE:
    msg->sim_state.q1 = read_float32(p);
    msg->sim_state.q2 = read_float32(p);
    msg->sim_state.q3 = read_float32(p);
    msg->sim_state.q4 = read_float32(p);
    msg->sim_state.roll = read_float32(p);
    msg->sim_state.pitch = read_float32(p);
    msg->sim_state.yaw = read_float32(p);
    msg->sim_state.xacc = read_float32(p);
    msg->sim_state.yacc = read_float32(p);
    msg->sim_state.zacc = read_float32(p);
    msg->sim_state.xgyro = read_float32(p);
    msg->sim_state.ygyro = read_float32(p);
    msg->sim_state.zgyro = read_float32(p);
    msg->sim_state.lat = read_float32(p);
    msg->sim_state.lon = read_float32(p);
    msg->sim_state.alt = read_float32(p);
    msg->sim_state.std_dev_horz = read_float32(p);
    msg->sim_state.std_dev_vert = read_float32(p);
    msg->sim_state.vn = read_float32(p);
    msg->sim_state.ve = read_float32(p);
    msg->sim_state.vd = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RADIO_STATUS:
    msg->radio_status.rxerrors = read_uint16(p);
    msg->radio_status.fixed = read_uint16(p);
    msg->radio_status.rssi = read_byte(p);
    msg->radio_status.remrssi = read_byte(p);
    msg->radio_status.txbuf = read_byte(p);
    msg->radio_status.noise = read_byte(p);
    msg->radio_status.remnoise = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_FILE_TRANSFER_PROTOCOL:
    msg->file_transfer_protocol.target_network = read_byte(p);
    msg->file_transfer_protocol.target_system = read_byte(p);
    msg->file_transfer_protocol.target_component = read_byte(p);
    for (size_t i = 0; i < 251; i++)
      msg->file_transfer_protocol.payload[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_TIMESYNC:
    msg->timesync.tc1 = read_int64(p);
    msg->timesync.ts1 = read_int64(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CAMERA_TRIGGER:
    msg->camera_trigger.time_usec = read_uint64(p);
    msg->camera_trigger.seq = read_uint32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HIL_GPS:
    msg->hil_gps.time_usec = read_uint64(p);
    msg->hil_gps.lat = read_int32(p);
    msg->hil_gps.lon = read_int32(p);
    msg->hil_gps.alt = read_int32(p);
    msg->hil_gps.eph = read_uint16(p);
    msg->hil_gps.epv = read_uint16(p);
    msg->hil_gps.vel = read_uint16(p);
    msg->hil_gps.vn = read_int16(p);
    msg->hil_gps.ve = read_int16(p);
    msg->hil_gps.vd = read_int16(p);
    msg->hil_gps.cog = read_uint16(p);
    msg->hil_gps.fix_type = read_byte(p);
    msg->hil_gps.satellites_visible = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HIL_OPTICAL_FLOW:
    msg->hil_optical_flow.time_usec = read_uint64(p);
    msg->hil_optical_flow.integration_time_us = read_uint32(p);
    msg->hil_optical_flow.integrated_x = read_float32(p);
    msg->hil_optical_flow.integrated_y = read_float32(p);
    msg->hil_optical_flow.integrated_xgyro = read_float32(p);
    msg->hil_optical_flow.integrated_ygyro = read_float32(p);
    msg->hil_optical_flow.integrated_zgyro = read_float32(p);
    msg->hil_optical_flow.time_delta_distance_us = read_uint32(p);
    msg->hil_optical_flow.distance = read_float32(p);
    msg->hil_optical_flow.temperature = read_int16(p);
    msg->hil_optical_flow.sensor_id = read_byte(p);
    msg->hil_optical_flow.quality = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HIL_STATE_QUATERNION:
    msg->hil_state_quaternion.time_usec = read_uint64(p);
    for (size_t i = 0; i < 4; i++)
      msg->hil_state_quaternion.attitude_quaternion[i] = read_float32(p);
    msg->hil_state_quaternion.rollspeed = read_float32(p);
    msg->hil_state_quaternion.pitchspeed = read_float32(p);
    msg->hil_state_quaternion.yawspeed = read_float32(p);
    msg->hil_state_quaternion.lat = read_int32(p);
    msg->hil_state_quaternion.lon = read_int32(p);
    msg->hil_state_quaternion.alt = read_int32(p);
    msg->hil_state_quaternion.vx = read_int16(p);
    msg->hil_state_quaternion.vy = read_int16(p);
    msg->hil_state_quaternion.vz = read_int16(p);
    msg->hil_state_quaternion.ind_airspeed = read_uint16(p);
    msg->hil_state_quaternion.true_airspeed = read_uint16(p);
    msg->hil_state_quaternion.xacc = read_int16(p);
    msg->hil_state_quaternion.yacc = read_int16(p);
    msg->hil_state_quaternion.zacc = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SCALED_IMU2:
    msg->scaled_imu2.time_boot_ms = read_uint32(p);
    msg->scaled_imu2.xacc = read_int16(p);
    msg->scaled_imu2.yacc = read_int16(p);
    msg->scaled_imu2.zacc = read_int16(p);
    msg->scaled_imu2.xgyro = read_int16(p);
    msg->scaled_imu2.ygyro = read_int16(p);
    msg->scaled_imu2.zgyro = read_int16(p);
    msg->scaled_imu2.xmag = read_int16(p);
    msg->scaled_imu2.ymag = read_int16(p);
    msg->scaled_imu2.zmag = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOG_REQUEST_LIST:
    msg->log_request_list.start = read_uint16(p);
    msg->log_request_list.end = read_uint16(p);
    msg->log_request_list.target_system = read_byte(p);
    msg->log_request_list.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOG_ENTRY:
    msg->log_entry.time_utc = read_uint32(p);
    msg->log_entry.size = read_uint32(p);
    msg->log_entry.id = read_uint16(p);
    msg->log_entry.num_logs = read_uint16(p);
    msg->log_entry.last_log_num = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOG_REQUEST_DATA:
    msg->log_request_data.ofs = read_uint32(p);
    msg->log_request_data.count = read_uint32(p);
    msg->log_request_data.id = read_uint16(p);
    msg->log_request_data.target_system = read_byte(p);
    msg->log_request_data.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOG_DATA:
    msg->log_data.ofs = read_uint32(p);
    msg->log_data.id = read_uint16(p);
    msg->log_data.count = read_byte(p);
    for (size_t i = 0; i < 90; i++)
      msg->log_data.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOG_ERASE:
    msg->log_erase.target_system = read_byte(p);
    msg->log_erase.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOG_REQUEST_END:
    msg->log_request_end.target_system = read_byte(p);
    msg->log_request_end.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GPS_INJECT_DATA:
    msg->gps_inject_data.target_system = read_byte(p);
    msg->gps_inject_data.target_component = read_byte(p);
    msg->gps_inject_data.len = read_byte(p);
    for (size_t i = 0; i < 110; i++)
      msg->gps_inject_data.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GPS2_RAW:
    msg->gps2_raw.time_usec = read_uint64(p);
    msg->gps2_raw.lat = read_int32(p);
    msg->gps2_raw.lon = read_int32(p);
    msg->gps2_raw.alt = read_int32(p);
    msg->gps2_raw.dgps_age = read_uint32(p);
    msg->gps2_raw.eph = read_uint16(p);
    msg->gps2_raw.epv = read_uint16(p);
    msg->gps2_raw.vel = read_uint16(p);
    msg->gps2_raw.cog = read_uint16(p);
    msg->gps2_raw.fix_type = read_byte(p);
    msg->gps2_raw.satellites_visible = read_byte(p);
    msg->gps2_raw.dgps_numch = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_POWER_STATUS:
    msg->power_status.Vcc = read_uint16(p);
    msg->power_status.Vservo = read_uint16(p);
    msg->power_status.flags = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SERIAL_CONTROL:
    msg->serial_control.baudrate = read_uint32(p);
    msg->serial_control.timeout = read_uint16(p);
    msg->serial_control.device = read_byte(p);
    msg->serial_control.flags = read_byte(p);
    msg->serial_control.count = read_byte(p);
    for (size_t i = 0; i < 70; i++)
      msg->serial_control.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GPS_RTK:
    msg->gps_rtk.time_last_baseline_ms = read_uint32(p);
    msg->gps_rtk.tow = read_uint32(p);
    msg->gps_rtk.baseline_a_mm = read_int32(p);
    msg->gps_rtk.baseline_b_mm = read_int32(p);
    msg->gps_rtk.baseline_c_mm = read_int32(p);
    msg->gps_rtk.accuracy = read_uint32(p);
    msg->gps_rtk.iar_num_hypotheses = read_int32(p);
    msg->gps_rtk.wn = read_uint16(p);
    msg->gps_rtk.rtk_receiver_id = read_byte(p);
    msg->gps_rtk.rtk_health = read_byte(p);
    msg->gps_rtk.rtk_rate = read_byte(p);
    msg->gps_rtk.nsats = read_byte(p);
    msg->gps_rtk.baseline_coords_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GPS2_RTK:
    msg->gps2_rtk.time_last_baseline_ms = read_uint32(p);
    msg->gps2_rtk.tow = read_uint32(p);
    msg->gps2_rtk.baseline_a_mm = read_int32(p);
    msg->gps2_rtk.baseline_b_mm = read_int32(p);
    msg->gps2_rtk.baseline_c_mm = read_int32(p);
    msg->gps2_rtk.accuracy = read_uint32(p);
    msg->gps2_rtk.iar_num_hypotheses = read_int32(p);
    msg->gps2_rtk.wn = read_uint16(p);
    msg->gps2_rtk.rtk_receiver_id = read_byte(p);
    msg->gps2_rtk.rtk_health = read_byte(p);
    msg->gps2_rtk.rtk_rate = read_byte(p);
    msg->gps2_rtk.nsats = read_byte(p);
    msg->gps2_rtk.baseline_coords_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SCALED_IMU3:
    msg->scaled_imu3.time_boot_ms = read_uint32(p);
    msg->scaled_imu3.xacc = read_int16(p);
    msg->scaled_imu3.yacc = read_int16(p);
    msg->scaled_imu3.zacc = read_int16(p);
    msg->scaled_imu3.xgyro = read_int16(p);
    msg->scaled_imu3.ygyro = read_int16(p);
    msg->scaled_imu3.zgyro = read_int16(p);
    msg->scaled_imu3.xmag = read_int16(p);
    msg->scaled_imu3.ymag = read_int16(p);
    msg->scaled_imu3.zmag = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DATA_TRANSMISSION_HANDSHAKE:
    msg->data_transmission_handshake.size = read_uint32(p);
    msg->data_transmission_handshake.width = read_uint16(p);
    msg->data_transmission_handshake.height = read_uint16(p);
    msg->data_transmission_handshake.packets = read_uint16(p);
    msg->data_transmission_handshake.type = read_byte(p);
    msg->data_transmission_handshake.payload = read_byte(p);
    msg->data_transmission_handshake.jpg_quality = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ENCAPSULATED_DATA:
    msg->encapsulated_data.seqnr = read_uint16(p);
    for (size_t i = 0; i < 253; i++)
      msg->encapsulated_data.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DISTANCE_SENSOR:
    msg->distance_sensor.time_boot_ms = read_uint32(p);
    msg->distance_sensor.min_distance = read_uint16(p);
    msg->distance_sensor.max_distance = read_uint16(p);
    msg->distance_sensor.current_distance = read_uint16(p);
    msg->distance_sensor.type = read_byte(p);
    msg->distance_sensor.id = read_byte(p);
    msg->distance_sensor.orientation = read_byte(p);
    msg->distance_sensor.covariance = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_TERRAIN_REQUEST:
    msg->terrain_request.mask = read_uint64(p);
    msg->terrain_request.lat = read_int32(p);
    msg->terrain_request.lon = read_int32(p);
    msg->terrain_request.grid_spacing = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_TERRAIN_DATA:
    msg->terrain_data.lat = read_int32(p);
    msg->terrain_data.lon = read_int32(p);
    msg->terrain_data.grid_spacing = read_uint16(p);
    for (size_t i = 0; i < 16; i++)
      msg->terrain_data.data[i] = read_int16(p);
    msg->terrain_data.gridbit = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_TERRAIN_CHECK:
    msg->terrain_check.lat = read_int32(p);
    msg->terrain_check.lon = read_int32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_TERRAIN_REPORT:
    msg->terrain_report.lat = read_int32(p);
    msg->terrain_report.lon = read_int32(p);
    msg->terrain_report.terrain_height = read_float32(p);
    msg->terrain_report.current_height = read_float32(p);
    msg->terrain_report.spacing = read_uint16(p);
    msg->terrain_report.pending = read_uint16(p);
    msg->terrain_report.loaded = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SCALED_PRESSURE2:
    msg->scaled_pressure2.time_boot_ms = read_uint32(p);
    msg->scaled_pressure2.press_abs = read_float32(p);
    msg->scaled_pressure2.press_diff = read_float32(p);
    msg->scaled_pressure2.temperature = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ATT_POS_MOCAP:
    msg->att_pos_mocap.time_usec = read_uint64(p);
    for (size_t i = 0; i < 4; i++)
      msg->att_pos_mocap.q[i] = read_float32(p);
    msg->att_pos_mocap.x = read_float32(p);
    msg->att_pos_mocap.y = read_float32(p);
    msg->att_pos_mocap.z = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SET_ACTUATOR_CONTROL_TARGET:
    msg->set_actuator_control_target.time_usec = read_uint64(p);
    for (size_t i = 0; i < 8; i++)
      msg->set_actuator_control_target.controls[i] = read_float32(p);
    msg->set_actuator_control_target.group_mlx = read_byte(p);
    msg->set_actuator_control_target.target_system = read_byte(p);
    msg->set_actuator_control_target.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ACTUATOR_CONTROL_TARGET:
    msg->actuator_control_target.time_usec = read_uint64(p);
    for (size_t i = 0; i < 8; i++)
      msg->actuator_control_target.controls[i] = read_float32(p);
    msg->actuator_control_target.group_mlx = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ALTITUDE:
    msg->altitude.time_usec = read_uint64(p);
    msg->altitude.altitude_monotonic = read_float32(p);
    msg->altitude.altitude_amsl = read_float32(p);
    msg->altitude.altitude_local = read_float32(p);
    msg->altitude.altitude_relative = read_float32(p);
    msg->altitude.altitude_terrain = read_float32(p);
    msg->altitude.bottom_clearance = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RESOURCE_REQUEST:
    msg->resource_request.request_id = read_byte(p);
    msg->resource_request.uri_type = read_byte(p);
    for (size_t i = 0; i < 120; i++)
      msg->resource_request.uri[i] = read_byte(p);
    msg->resource_request.transfer_type = read_byte(p);
    for (size_t i = 0; i < 120; i++)
      msg->resource_request.storage[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SCALED_PRESSURE3:
    msg->scaled_pressure3.time_boot_ms = read_uint32(p);
    msg->scaled_pressure3.press_abs = read_float32(p);
    msg->scaled_pressure3.press_diff = read_float32(p);
    msg->scaled_pressure3.temperature = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_FOLLOW_TARGET:
    msg->follow_target.timestamp = read_uint64(p);
    msg->follow_target.custom_state = read_uint64(p);
    msg->follow_target.lat = read_int32(p);
    msg->follow_target.lon = read_int32(p);
    msg->follow_target.alt = read_float32(p);
    for (size_t i = 0; i < 3; i++)
      msg->follow_target.vel[i] = read_float32(p);
    for (size_t i = 0; i < 3; i++)
      msg->follow_target.acc[i] = read_float32(p);
    for (size_t i = 0; i < 4; i++)
      msg->follow_target.attitude_q[i] = read_float32(p);
    for (size_t i = 0; i < 3; i++)
      msg->follow_target.rates[i] = read_float32(p);
    for (size_t i = 0; i < 3; i++)
      msg->follow_target.position_cov[i] = read_float32(p);
    msg->follow_target.est_capabilities = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CONTROL_SYSTEM_STATE:
    msg->control_system_state.time_usec = read_uint64(p);
    msg->control_system_state.x_acc = read_float32(p);
    msg->control_system_state.y_acc = read_float32(p);
    msg->control_system_state.z_acc = read_float32(p);
    msg->control_system_state.x_vel = read_float32(p);
    msg->control_system_state.y_vel = read_float32(p);
    msg->control_system_state.z_vel = read_float32(p);
    msg->control_system_state.x_pos = read_float32(p);
    msg->control_system_state.y_pos = read_float32(p);
    msg->control_system_state.z_pos = read_float32(p);
    msg->control_system_state.airspeed = read_float32(p);
    for (size_t i = 0; i < 3; i++)
      msg->control_system_state.vel_variance[i] = read_float32(p);
    for (size_t i = 0; i < 3; i++)
      msg->control_system_state.pos_variance[i] = read_float32(p);
    for (size_t i = 0; i < 4; i++)
      msg->control_system_state.q[i] = read_float32(p);
    msg->control_system_state.roll_rate = read_float32(p);
    msg->control_system_state.pitch_rate = read_float32(p);
    msg->control_system_state.yaw_rate = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_BATTERY_STATUS:
    msg->battery_status.current_consumed = read_int32(p);
    msg->battery_status.energy_consumed = read_int32(p);
    msg->battery_status.temperature = read_int16(p);
    for (size_t i = 0; i < 10; i++)
      msg->battery_status.voltages[i] = read_uint16(p);
    msg->battery_status.current_battery = read_int16(p);
    msg->battery_status.id = read_byte(p);
    msg->battery_status.battery_function = read_byte(p);
    msg->battery_status.type = read_byte(p);
    msg->battery_status.battery_remaining = read_int8(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_AUTOPILOT_VERSION:
    msg->autopilot_version.capabilities = read_uint64(p);
    msg->autopilot_version.uid = read_uint64(p);
    msg->autopilot_version.flight_sw_version = read_uint32(p);
    msg->autopilot_version.middleware_sw_version = read_uint32(p);
    msg->autopilot_version.os_sw_version = read_uint32(p);
    msg->autopilot_version.board_version = read_uint32(p);
    msg->autopilot_version.vendor_id = read_uint16(p);
    msg->autopilot_version.product_id = read_uint16(p);
    for (size_t i = 0; i < 8; i++)
      msg->autopilot_version.flight_custom_version[i] = read_byte(p);
    for (size_t i = 0; i < 8; i++)
      msg->autopilot_version.middleware_custom_version[i] = read_byte(p);
    for (size_t i = 0; i < 8; i++)
      msg->autopilot_version.os_custom_version[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LANDING_TARGET:
    msg->landing_target.time_usec = read_uint64(p);
    msg->landing_target.angle_x = read_float32(p);
    msg->landing_target.angle_y = read_float32(p);
    msg->landing_target.distance = read_float32(p);
    msg->landing_target.size_x = read_float32(p);
    msg->landing_target.size_y = read_float32(p);
    msg->landing_target.target_num = read_byte(p);
    msg->landing_target.frame = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SENSOR_OFFSETS:
    msg->sensor_offsets.mag_declination = read_float32(p);
    msg->sensor_offsets.raw_press = read_int32(p);
    msg->sensor_offsets.raw_temp = read_int32(p);
    msg->sensor_offsets.gyro_cal_x = read_float32(p);
    msg->sensor_offsets.gyro_cal_y = read_float32(p);
    msg->sensor_offsets.gyro_cal_z = read_float32(p);
    msg->sensor_offsets.accel_cal_x = read_float32(p);
    msg->sensor_offsets.accel_cal_y = read_float32(p);
    msg->sensor_offsets.accel_cal_z = read_float32(p);
    msg->sensor_offsets.mag_ofs_x = read_int16(p);
    msg->sensor_offsets.mag_ofs_y = read_int16(p);
    msg->sensor_offsets.mag_ofs_z = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SET_MAG_OFFSETS:
    msg->set_mag_offsets.mag_ofs_x = read_int16(p);
    msg->set_mag_offsets.mag_ofs_y = read_int16(p);
    msg->set_mag_offsets.mag_ofs_z = read_int16(p);
    msg->set_mag_offsets.target_system = read_byte(p);
    msg->set_mag_offsets.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MEMINFO:
    msg->meminfo.brkval = read_uint16(p);
    msg->meminfo.freemem = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_AP_ADC:
    msg->ap_adc.adc1 = read_uint16(p);
    msg->ap_adc.adc2 = read_uint16(p);
    msg->ap_adc.adc3 = read_uint16(p);
    msg->ap_adc.adc4 = read_uint16(p);
    msg->ap_adc.adc5 = read_uint16(p);
    msg->ap_adc.adc6 = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DIGICAM_CONFIGURE:
    msg->digicam_configure.extra_value = read_float32(p);
    msg->digicam_configure.shutter_speed = read_uint16(p);
    msg->digicam_configure.target_system = read_byte(p);
    msg->digicam_configure.target_component = read_byte(p);
    msg->digicam_configure.mode = read_byte(p);
    msg->digicam_configure.aperture = read_byte(p);
    msg->digicam_configure.iso = read_byte(p);
    msg->digicam_configure.exposure_type = read_byte(p);
    msg->digicam_configure.command_id = read_byte(p);
    msg->digicam_configure.engine_cut_off = read_byte(p);
    msg->digicam_configure.extra_param = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DIGICAM_CONTROL:
    msg->digicam_control.extra_value = read_float32(p);
    msg->digicam_control.target_system = read_byte(p);
    msg->digicam_control.target_component = read_byte(p);
    msg->digicam_control.session = read_byte(p);
    msg->digicam_control.zoom_pos = read_byte(p);
    msg->digicam_control.zoom_step = read_int8(p);
    msg->digicam_control.focus_lock = read_byte(p);
    msg->digicam_control.shot = read_byte(p);
    msg->digicam_control.command_id = read_byte(p);
    msg->digicam_control.extra_param = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MOUNT_CONFIGURE:
    msg->mount_configure.target_system = read_byte(p);
    msg->mount_configure.target_component = read_byte(p);
    msg->mount_configure.mount_mode = read_byte(p);
    msg->mount_configure.stab_roll = read_byte(p);
    msg->mount_configure.stab_pitch = read_byte(p);
    msg->mount_configure.stab_yaw = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MOUNT_CONTROL:
    msg->mount_control.input_a = read_int32(p);
    msg->mount_control.input_b = read_int32(p);
    msg->mount_control.input_c = read_int32(p);
    msg->mount_control.target_system = read_byte(p);
    msg->mount_control.target_component = read_byte(p);
    msg->mount_control.save_position = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MOUNT_STATUS:
    msg->mount_status.pointing_a = read_int32(p);
    msg->mount_status.pointing_b = read_int32(p);
    msg->mount_status.pointing_c = read_int32(p);
    msg->mount_status.target_system = read_byte(p);
    msg->mount_status.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_FENCE_POINT:
    msg->fence_point.lat = read_float32(p);
    msg->fence_point.lng = read_float32(p);
    msg->fence_point.target_system = read_byte(p);
    msg->fence_point.target_component = read_byte(p);
    msg->fence_point.idx = read_byte(p);
    msg->fence_point.count = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_FENCE_FETCH_POINT:
    msg->fence_fetch_point.target_system = read_byte(p);
    msg->fence_fetch_point.target_component = read_byte(p);
    msg->fence_fetch_point.idx = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_FENCE_STATUS:
    msg->fence_status.breach_time = read_uint32(p);
    msg->fence_status.breach_count = read_uint16(p);
    msg->fence_status.breach_status = read_byte(p);
    msg->fence_status.breach_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_AHRS:
    msg->ahrs.omegaIx = read_float32(p);
    msg->ahrs.omegaIy = read_float32(p);
    msg->ahrs.omegaIz = read_float32(p);
    msg->ahrs.accel_weight = read_float32(p);
    msg->ahrs.renorm_val = read_float32(p);
    msg->ahrs.error_rp = read_float32(p);
    msg->ahrs.error_yaw = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SIMSTATE:
    msg->simstate.roll = read_float32(p);
    msg->simstate.pitch = read_float32(p);
    msg->simstate.yaw = read_float32(p);
    msg->simstate.xacc = read_float32(p);
    msg->simstate.yacc = read_float32(p);
    msg->simstate.zacc = read_float32(p);
    msg->simstate.xgyro = read_float32(p);
    msg->simstate.ygyro = read_float32(p);
    msg->simstate.zgyro = read_float32(p);
    msg->simstate.lat = read_int32(p);
    msg->simstate.lng = read_int32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HWSTATUS:
    msg->hwstatus.Vcc = read_uint16(p);
    msg->hwstatus.I2Cerr = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RADIO:
    msg->radio.rxerrors = read_uint16(p);
    msg->radio.fixed = read_uint16(p);
    msg->radio.rssi = read_byte(p);
    msg->radio.remrssi = read_byte(p);
    msg->radio.txbuf = read_byte(p);
    msg->radio.noise = read_byte(p);
    msg->radio.remnoise = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LIMITS_STATUS:
    msg->limits_status.last_trigger = read_uint32(p);
    msg->limits_status.last_action = read_uint32(p);
    msg->limits_status.last_recovery = read_uint32(p);
    msg->limits_status.last_clear = read_uint32(p);
    msg->limits_status.breach_count = read_uint16(p);
    msg->limits_status.limits_state = read_byte(p);
    msg->limits_status.mods_enabled = read_byte(p);
    msg->limits_status.mods_required = read_byte(p);
    msg->limits_status.mods_triggered = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_WIND:
    msg->wind.direction = read_float32(p);
    msg->wind.speed = read_float32(p);
    msg->wind.speed_z = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DATA16:
    msg->data16.type = read_byte(p);
    msg->data16.len = read_byte(p);
    for (size_t i = 0; i < 16; i++)
      msg->data16.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DATA32:
    msg->data32.type = read_byte(p);
    msg->data32.len = read_byte(p);
    for (size_t i = 0; i < 32; i++)
      msg->data32.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DATA64:
    msg->data64.type = read_byte(p);
    msg->data64.len = read_byte(p);
    for (size_t i = 0; i < 64; i++)
      msg->data64.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DATA96:
    msg->data96.type = read_byte(p);
    msg->data96.len = read_byte(p);
    for (size_t i = 0; i < 96; i++)
      msg->data96.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RANGEFINDER:
    msg->rangefinder.distance = read_float32(p);
    msg->rangefinder.voltage = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_AIRSPEED_AUTOCAL:
    msg->airspeed_autocal.vx = read_float32(p);
    msg->airspeed_autocal.vy = read_float32(p);
    msg->airspeed_autocal.vz = read_float32(p);
    msg->airspeed_autocal.diff_pressure = read_float32(p);
    msg->airspeed_autocal.EAS2TAS = read_float32(p);
    msg->airspeed_autocal.ratio = read_float32(p);
    msg->airspeed_autocal.state_x = read_float32(p);
    msg->airspeed_autocal.state_y = read_float32(p);
    msg->airspeed_autocal.state_z = read_float32(p);
    msg->airspeed_autocal.Pax = read_float32(p);
    msg->airspeed_autocal.Pby = read_float32(p);
    msg->airspeed_autocal.Pcz = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RALLY_POINT:
    msg->rally_point.lat = read_int32(p);
    msg->rally_point.lng = read_int32(p);
    msg->rally_point.alt = read_int16(p);
    msg->rally_point.break_alt = read_int16(p);
    msg->rally_point.land_dir = read_uint16(p);
    msg->rally_point.target_system = read_byte(p);
    msg->rally_point.target_component = read_byte(p);
    msg->rally_point.idx = read_byte(p);
    msg->rally_point.count = read_byte(p);
    msg->rally_point.flags = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RALLY_FETCH_POINT:
    msg->rally_fetch_point.target_system = read_byte(p);
    msg->rally_fetch_point.target_component = read_byte(p);
    msg->rally_fetch_point.idx = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_COMPASSMOT_STATUS:
    msg->compassmot_status.current = read_float32(p);
    msg->compassmot_status.CompensationX = read_float32(p);
    msg->compassmot_status.CompensationY = read_float32(p);
    msg->compassmot_status.CompensationZ = read_float32(p);
    msg->compassmot_status.throttle = read_uint16(p);
    msg->compassmot_status.interference = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_AHRS2:
    msg->ahrs2.roll = read_float32(p);
    msg->ahrs2.pitch = read_float32(p);
    msg->ahrs2.yaw = read_float32(p);
    msg->ahrs2.altitude = read_float32(p);
    msg->ahrs2.lat = read_int32(p);
    msg->ahrs2.lng = read_int32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CAMERA_STATUS:
    msg->camera_status.time_usec = read_uint64(p);
    msg->camera_status.p1 = read_float32(p);
    msg->camera_status.p2 = read_float32(p);
    msg->camera_status.p3 = read_float32(p);
    msg->camera_status.p4 = read_float32(p);
    msg->camera_status.img_idx = read_uint16(p);
    msg->camera_status.target_system = read_byte(p);
    msg->camera_status.cam_idx = read_byte(p);
    msg->camera_status.event_id = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CAMERA_FEEDBACK:
    msg->camera_feedback.time_usec = read_uint64(p);
    msg->camera_feedback.lat = read_int32(p);
    msg->camera_feedback.lng = read_int32(p);
    msg->camera_feedback.alt_msl = read_float32(p);
    msg->camera_feedback.alt_rel = read_float32(p);
    msg->camera_feedback.roll = read_float32(p);
    msg->camera_feedback.pitch = read_float32(p);
    msg->camera_feedback.yaw = read_float32(p);
    msg->camera_feedback.foc_len = read_float32(p);
    msg->camera_feedback.img_idx = read_uint16(p);
    msg->camera_feedback.target_system = read_byte(p);
    msg->camera_feedback.cam_idx = read_byte(p);
    msg->camera_feedback.flags = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_BATTERY2:
    msg->battery2.voltage = read_uint16(p);
    msg->battery2.current_battery = read_int16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_AHRS3:
    msg->ahrs3.roll = read_float32(p);
    msg->ahrs3.pitch = read_float32(p);
    msg->ahrs3.yaw = read_float32(p);
    msg->ahrs3.altitude = read_float32(p);
    msg->ahrs3.lat = read_int32(p);
    msg->ahrs3.lng = read_int32(p);
    msg->ahrs3.v1 = read_float32(p);
    msg->ahrs3.v2 = read_float32(p);
    msg->ahrs3.v3 = read_float32(p);
    msg->ahrs3.v4 = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_AUTOPILOT_VERSION_REQUEST:
    msg->autopilot_version_request.target_system = read_byte(p);
    msg->autopilot_version_request.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_REMOTE_LOG_DATA_BLOCK:
    msg->remote_log_data_block.seqno = read_uint32(p);
    msg->remote_log_data_block.target_system = read_byte(p);
    msg->remote_log_data_block.target_component = read_byte(p);
    for (size_t i = 0; i < 200; i++)
      msg->remote_log_data_block.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_REMOTE_LOG_BLOCK_STATUS:
    msg->remote_log_block_status.seqno = read_uint32(p);
    msg->remote_log_block_status.target_system = read_byte(p);
    msg->remote_log_block_status.target_component = read_byte(p);
    msg->remote_log_block_status.status = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LED_CONTROL:
    msg->led_control.target_system = read_byte(p);
    msg->led_control.target_component = read_byte(p);
    msg->led_control.instance = read_byte(p);
    msg->led_control.pattern = read_byte(p);
    msg->led_control.custom_len = read_byte(p);
    for (size_t i = 0; i < 24; i++)
      msg->led_control.custom_bytes[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MAG_CAL_PROGRESS:
    msg->mag_cal_progress.direction_x = read_float32(p);
    msg->mag_cal_progress.direction_y = read_float32(p);
    msg->mag_cal_progress.direction_z = read_float32(p);
    msg->mag_cal_progress.compass_id = read_byte(p);
    msg->mag_cal_progress.cal_mask = read_byte(p);
    msg->mag_cal_progress.cal_status = read_byte(p);
    msg->mag_cal_progress.attempt = read_byte(p);
    msg->mag_cal_progress.completion_pct = read_byte(p);
    for (size_t i = 0; i < 10; i++)
      msg->mag_cal_progress.completion_mask[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MAG_CAL_REPORT:
    msg->mag_cal_report.fitness = read_float32(p);
    msg->mag_cal_report.ofs_x = read_float32(p);
    msg->mag_cal_report.ofs_y = read_float32(p);
    msg->mag_cal_report.ofs_z = read_float32(p);
    msg->mag_cal_report.diag_x = read_float32(p);
    msg->mag_cal_report.diag_y = read_float32(p);
    msg->mag_cal_report.diag_z = read_float32(p);
    msg->mag_cal_report.offdiag_x = read_float32(p);
    msg->mag_cal_report.offdiag_y = read_float32(p);
    msg->mag_cal_report.offdiag_z = read_float32(p);
    msg->mag_cal_report.compass_id = read_byte(p);
    msg->mag_cal_report.cal_mask = read_byte(p);
    msg->mag_cal_report.cal_status = read_byte(p);
    msg->mag_cal_report.autosaved = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_EKF_STATUS_REPORT:
    msg->ekf_status_report.velocity_variance = read_float32(p);
    msg->ekf_status_report.pos_horiz_variance = read_float32(p);
    msg->ekf_status_report.pos_vert_variance = read_float32(p);
    msg->ekf_status_report.compass_variance = read_float32(p);
    msg->ekf_status_report.terrain_alt_variance = read_float32(p);
    msg->ekf_status_report.flags = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PID_TUNING:
    msg->pid_tuning.desired = read_float32(p);
    msg->pid_tuning.achieved = read_float32(p);
    msg->pid_tuning.FF = read_float32(p);
    msg->pid_tuning.P = read_float32(p);
    msg->pid_tuning.I = read_float32(p);
    msg->pid_tuning.D = read_float32(p);
    msg->pid_tuning.axis = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DEEPSTALL:
    msg->deepstall.landing_lat = read_int32(p);
    msg->deepstall.landing_lon = read_int32(p);
    msg->deepstall.path_lat = read_int32(p);
    msg->deepstall.path_lon = read_int32(p);
    msg->deepstall.arc_entry_lat = read_int32(p);
    msg->deepstall.arc_entry_lon = read_int32(p);
    msg->deepstall.altitude = read_float32(p);
    msg->deepstall.expected_travel_distance = read_float32(p);
    msg->deepstall.cross_track_error = read_float32(p);
    msg->deepstall.stage = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GIMBAL_REPORT:
    msg->gimbal_report.delta_time = read_float32(p);
    msg->gimbal_report.delta_angle_x = read_float32(p);
    msg->gimbal_report.delta_angle_y = read_float32(p);
    msg->gimbal_report.delta_angle_z = read_float32(p);
    msg->gimbal_report.delta_velocity_x = read_float32(p);
    msg->gimbal_report.delta_velocity_y = read_float32(p);
    msg->gimbal_report.delta_velocity_z = read_float32(p);
    msg->gimbal_report.joint_roll = read_float32(p);
    msg->gimbal_report.joint_el = read_float32(p);
    msg->gimbal_report.joint_az = read_float32(p);
    msg->gimbal_report.target_system = read_byte(p);
    msg->gimbal_report.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GIMBAL_CONTROL:
    msg->gimbal_control.demanded_rate_x = read_float32(p);
    msg->gimbal_control.demanded_rate_y = read_float32(p);
    msg->gimbal_control.demanded_rate_z = read_float32(p);
    msg->gimbal_control.target_system = read_byte(p);
    msg->gimbal_control.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GIMBAL_TORQUE_CMD_REPORT:
    msg->gimbal_torque_cmd_report.rl_torque_cmd = read_int16(p);
    msg->gimbal_torque_cmd_report.el_torque_cmd = read_int16(p);
    msg->gimbal_torque_cmd_report.az_torque_cmd = read_int16(p);
    msg->gimbal_torque_cmd_report.target_system = read_byte(p);
    msg->gimbal_torque_cmd_report.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GOPRO_HEARTBEAT:
    msg->gopro_heartbeat.status = read_byte(p);
    msg->gopro_heartbeat.capture_mode = read_byte(p);
    msg->gopro_heartbeat.flags = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GOPRO_GET_REQUEST:
    msg->gopro_get_request.target_system = read_byte(p);
    msg->gopro_get_request.target_component = read_byte(p);
    msg->gopro_get_request.cmd_id = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GOPRO_GET_RESPONSE:
    msg->gopro_get_response.cmd_id = read_byte(p);
    msg->gopro_get_response.status = read_byte(p);
    for (size_t i = 0; i < 4; i++)
      msg->gopro_get_response.value[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GOPRO_SET_REQUEST:
    msg->gopro_set_request.target_system = read_byte(p);
    msg->gopro_set_request.target_component = read_byte(p);
    msg->gopro_set_request.cmd_id = read_byte(p);
    for (size_t i = 0; i < 4; i++)
      msg->gopro_set_request.value[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GOPRO_SET_RESPONSE:
    msg->gopro_set_response.cmd_id = read_byte(p);
    msg->gopro_set_response.status = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RPM:
    msg->rpm.rpm1 = read_float32(p);
    msg->rpm.rpm2 = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ESTIMATOR_STATUS:
    msg->estimator_status.time_usec = read_uint64(p);
    msg->estimator_status.vel_ratio = read_float32(p);
    msg->estimator_status.pos_horiz_ratio = read_float32(p);
    msg->estimator_status.pos_vert_ratio = read_float32(p);
    msg->estimator_status.mag_ratio = read_float32(p);
    msg->estimator_status.hagl_ratio = read_float32(p);
    msg->estimator_status.tas_ratio = read_float32(p);
    msg->estimator_status.pos_horiz_accuracy = read_float32(p);
    msg->estimator_status.pos_vert_accuracy = read_float32(p);
    msg->estimator_status.flags = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_WIND_COV:
    msg->wind_cov.time_usec = read_uint64(p);
    msg->wind_cov.wind_x = read_float32(p);
    msg->wind_cov.wind_y = read_float32(p);
    msg->wind_cov.wind_z = read_float32(p);
    msg->wind_cov.var_horiz = read_float32(p);
    msg->wind_cov.var_vert = read_float32(p);
    msg->wind_cov.wind_alt = read_float32(p);
    msg->wind_cov.horiz_accuracy = read_float32(p);
    msg->wind_cov.vert_accuracy = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GPS_INPUT:
    msg->gps_input.time_usec = read_uint64(p);
    msg->gps_input.time_week_ms = read_uint32(p);
    msg->gps_input.lat = read_int32(p);
    msg->gps_input.lon = read_int32(p);
    msg->gps_input.alt = read_float32(p);
    msg->gps_input.hdop = read_float32(p);
    msg->gps_input.vdop = read_float32(p);
    msg->gps_input.vn = read_float32(p);
    msg->gps_input.ve = read_float32(p);
    msg->gps_input.vd = read_float32(p);
    msg->gps_input.speed_accuracy = read_float32(p);
    msg->gps_input.horiz_accuracy = read_float32(p);
    msg->gps_input.vert_accuracy = read_float32(p);
    msg->gps_input.ignore_flags = read_uint16(p);
    msg->gps_input.time_week = read_uint16(p);
    msg->gps_input.gps_id = read_byte(p);
    msg->gps_input.fix_type = read_byte(p);
    msg->gps_input.satellites_visible = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GPS_RTCM_DATA:
    msg->gps_rtcm_data.flags = read_byte(p);
    msg->gps_rtcm_data.len = read_byte(p);
    for (size_t i = 0; i < 180; i++)
      msg->gps_rtcm_data.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HIGH_LATENCY:
    msg->high_latency.custom_mode = read_uint32(p);
    msg->high_latency.latitude = read_int32(p);
    msg->high_latency.longitude = read_int32(p);
    msg->high_latency.roll = read_int16(p);
    msg->high_latency.pitch = read_int16(p);
    msg->high_latency.heading = read_uint16(p);
    msg->high_latency.heading_sp = read_int16(p);
    msg->high_latency.altitude_amsl = read_int16(p);
    msg->high_latency.altitude_sp = read_int16(p);
    msg->high_latency.wp_distance = read_uint16(p);
    msg->high_latency.base_mode = read_byte(p);
    msg->high_latency.landed_state = read_byte(p);
    msg->high_latency.throttle = read_int8(p);
    msg->high_latency.airspeed = read_byte(p);
    msg->high_latency.airspeed_sp = read_byte(p);
    msg->high_latency.groundspeed = read_byte(p);
    msg->high_latency.climb_rate = read_int8(p);
    msg->high_latency.gps_nsat = read_byte(p);
    msg->high_latency.gps_fix_type = read_byte(p);
    msg->high_latency.battery_remaining = read_byte(p);
    msg->high_latency.temperature = read_int8(p);
    msg->high_latency.temperature_air = read_int8(p);
    msg->high_latency.failsafe = read_byte(p);
    msg->high_latency.wp_num = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HIGH_LATENCY2:
    msg->high_latency2.timestamp = read_uint32(p);
    msg->high_latency2.latitude = read_int32(p);
    msg->high_latency2.longitude = read_int32(p);
    msg->high_latency2.custom_mode = read_uint16(p);
    msg->high_latency2.altitude = read_int16(p);
    msg->high_latency2.target_altitude = read_int16(p);
    msg->high_latency2.target_distance = read_uint16(p);
    msg->high_latency2.wp_num = read_uint16(p);
    msg->high_latency2.failure_flags = read_uint16(p);
    msg->high_latency2.type = read_byte(p);
    msg->high_latency2.autopilot = read_byte(p);
    msg->high_latency2.heading = read_byte(p);
    msg->high_latency2.target_heading = read_byte(p);
    msg->high_latency2.throttle = read_byte(p);
    msg->high_latency2.airspeed = read_byte(p);
    msg->high_latency2.airspeed_sp = read_byte(p);
    msg->high_latency2.groundspeed = read_byte(p);
    msg->high_latency2.windspeed = read_byte(p);
    msg->high_latency2.wind_heading = read_byte(p);
    msg->high_latency2.eph = read_byte(p);
    msg->high_latency2.epv = read_byte(p);
    msg->high_latency2.temperature_air = read_int8(p);
    msg->high_latency2.climb_rate = read_int8(p);
    msg->high_latency2.battery = read_int8(p);
    msg->high_latency2.custom0 = read_int8(p);
    msg->high_latency2.custom1 = read_int8(p);
    msg->high_latency2.custom2 = read_int8(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_VIBRATION:
    msg->vibration.time_usec = read_uint64(p);
    msg->vibration.vibration_x = read_float32(p);
    msg->vibration.vibration_y = read_float32(p);
    msg->vibration.vibration_z = read_float32(p);
    msg->vibration.clipping_0 = read_uint32(p);
    msg->vibration.clipping_1 = read_uint32(p);
    msg->vibration.clipping_2 = read_uint32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HOME_POSITION:
    msg->home_position.latitude = read_int32(p);
    msg->home_position.longitude = read_int32(p);
    msg->home_position.altitude = read_int32(p);
    msg->home_position.x = read_float32(p);
    msg->home_position.y = read_float32(p);
    msg->home_position.z = read_float32(p);
    for (size_t i = 0; i < 4; i++)
      msg->home_position.q[i] = read_float32(p);
    msg->home_position.approach_x = read_float32(p);
    msg->home_position.approach_y = read_float32(p);
    msg->home_position.approach_z = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SET_HOME_POSITION:
    msg->set_home_position.latitude = read_int32(p);
    msg->set_home_position.longitude = read_int32(p);
    msg->set_home_position.altitude = read_int32(p);
    msg->set_home_position.x = read_float32(p);
    msg->set_home_position.y = read_float32(p);
    msg->set_home_position.z = read_float32(p);
    for (size_t i = 0; i < 4; i++)
      msg->set_home_position.q[i] = read_float32(p);
    msg->set_home_position.approach_x = read_float32(p);
    msg->set_home_position.approach_y = read_float32(p);
    msg->set_home_position.approach_z = read_float32(p);
    msg->set_home_position.target_system = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MESSAGE_INTERVAL:
    msg->message_interval.interval_us = read_int32(p);
    msg->message_interval.message_id = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_EXTENDED_SYS_STATE:
    msg->extended_sys_state.vtol_state = read_byte(p);
    msg->extended_sys_state.landed_state = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ADSB_VEHICLE:
    msg->adsb_vehicle.ICAO_address = read_uint32(p);
    msg->adsb_vehicle.lat = read_int32(p);
    msg->adsb_vehicle.lon = read_int32(p);
    msg->adsb_vehicle.altitude = read_int32(p);
    msg->adsb_vehicle.heading = read_uint16(p);
    msg->adsb_vehicle.hor_velocity = read_uint16(p);
    msg->adsb_vehicle.ver_velocity = read_int16(p);
    msg->adsb_vehicle.flags = read_uint16(p);
    msg->adsb_vehicle.squawk = read_uint16(p);
    msg->adsb_vehicle.altitude_type = read_byte(p);
    for (size_t i = 0; i < 9; i++)
      msg->adsb_vehicle.callsign[i] = read_byte(p);
    msg->adsb_vehicle.emitter_type = read_byte(p);
    msg->adsb_vehicle.tslc = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_COLLISION:
    msg->collision.id = read_uint32(p);
    msg->collision.time_to_minimum_delta = read_float32(p);
    msg->collision.altitude_minimum_delta = read_float32(p);
    msg->collision.horizontal_minimum_delta = read_float32(p);
    msg->collision.src = read_byte(p);
    msg->collision.action = read_byte(p);
    msg->collision.threat_level = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_V2_EXTENSION:
    msg->v2_extension.message_type = read_uint16(p);
    msg->v2_extension.target_network = read_byte(p);
    msg->v2_extension.target_system = read_byte(p);
    msg->v2_extension.target_component = read_byte(p);
    for (size_t i = 0; i < 249; i++)
      msg->v2_extension.payload[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MEMORY_VECT:
    msg->memory_vect.address = read_uint16(p);
    msg->memory_vect.ver = read_byte(p);
    msg->memory_vect.type = read_byte(p);
    for (size_t i = 0; i < 32; i++)
      msg->memory_vect.value[i] = read_int8(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DEBUG_VECT:
    msg->debug_vect.time_usec = read_uint64(p);
    msg->debug_vect.x = read_float32(p);
    msg->debug_vect.y = read_float32(p);
    msg->debug_vect.z = read_float32(p);
    for (size_t i = 0; i < 10; i++)
      msg->debug_vect.name[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_NAMED_VALUE_FLOAT:
    msg->named_value_float.time_boot_ms = read_uint32(p);
    msg->named_value_float.value = read_float32(p);
    for (size_t i = 0; i < 10; i++)
      msg->named_value_float.name[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_NAMED_VALUE_INT:
    msg->named_value_int.time_boot_ms = read_uint32(p);
    msg->named_value_int.value = read_int32(p);
    for (size_t i = 0; i < 10; i++)
      msg->named_value_int.name[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_STATUSTEXT:
    msg->statustext.severity = read_byte(p);
    for (size_t i = 0; i < 50; i++)
      msg->statustext.text[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DEBUG:
    msg->debug.time_boot_ms = read_uint32(p);
    msg->debug.value = read_float32(p);
    msg->debug.ind = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SETUP_SIGNING:
    msg->setup_signing.initial_timestamp = read_uint64(p);
    msg->setup_signing.target_system = read_byte(p);
    msg->setup_signing.target_component = read_byte(p);
    for (size_t i = 0; i < 32; i++)
      msg->setup_signing.secret_key[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_BUTTON_CHANGE:
    msg->button_change.time_boot_ms = read_uint32(p);
    msg->button_change.last_change_ms = read_uint32(p);
    msg->button_change.state = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PLAY_TUNE:
    msg->play_tune.target_system = read_byte(p);
    msg->play_tune.target_component = read_byte(p);
    for (size_t i = 0; i < 30; i++)
      msg->play_tune.tune[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CAMERA_INFORMATION:
    msg->camera_information.time_boot_ms = read_uint32(p);
    msg->camera_information.firmware_version = read_uint32(p);
    msg->camera_information.focal_length = read_float32(p);
    msg->camera_information.sensor_size_h = read_float32(p);
    msg->camera_information.sensor_size_v = read_float32(p);
    msg->camera_information.flags = read_uint32(p);
    msg->camera_information.resolution_h = read_uint16(p);
    msg->camera_information.resolution_v = read_uint16(p);
    msg->camera_information.cam_definition_version = read_uint16(p);
    for (size_t i = 0; i < 32; i++)
      msg->camera_information.vendor_name[i] = read_byte(p);
    for (size_t i = 0; i < 32; i++)
      msg->camera_information.model_name[i] = read_byte(p);
    msg->camera_information.lens_id = read_byte(p);
    for (size_t i = 0; i < 140; i++)
      msg->camera_information.cam_definition_uri[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CAMERA_SETTINGS:
    msg->camera_settings.time_boot_ms = read_uint32(p);
    msg->camera_settings.mode_id = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_STORAGE_INFORMATION:
    msg->storage_information.time_boot_ms = read_uint32(p);
    msg->storage_information.total_capacity = read_float32(p);
    msg->storage_information.used_capacity = read_float32(p);
    msg->storage_information.available_capacity = read_float32(p);
    msg->storage_information.read_speed = read_float32(p);
    msg->storage_information.write_speed = read_float32(p);
    msg->storage_information.storage_id = read_byte(p);
    msg->storage_information.storage_count = read_byte(p);
    msg->storage_information.status = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CAMERA_CAPTURE_STATUS:
    msg->camera_capture_status.time_boot_ms = read_uint32(p);
    msg->camera_capture_status.image_interval = read_float32(p);
    msg->camera_capture_status.recording_time_ms = read_uint32(p);
    msg->camera_capture_status.available_capacity = read_float32(p);
    msg->camera_capture_status.image_status = read_byte(p);
    msg->camera_capture_status.video_status = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CAMERA_IMAGE_CAPTURED:
    msg->camera_image_captured.time_utc = read_uint64(p);
    msg->camera_image_captured.time_boot_ms = read_uint32(p);
    msg->camera_image_captured.lat = read_int32(p);
    msg->camera_image_captured.lon = read_int32(p);
    msg->camera_image_captured.alt = read_int32(p);
    msg->camera_image_captured.relative_alt = read_int32(p);
    for (size_t i = 0; i < 4; i++)
      msg->camera_image_captured.q[i] = read_float32(p);
    msg->camera_image_captured.image_index = read_int32(p);
    msg->camera_image_captured.camera_id = read_byte(p);
    msg->camera_image_captured.capture_result = read_int8(p);
    for (size_t i = 0; i < 205; i++)
      msg->camera_image_captured.file_url[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_FLIGHT_INFORMATION:
    msg->flight_information.arming_time_utc = read_uint64(p);
    msg->flight_information.takeoff_time_utc = read_uint64(p);
    msg->flight_information.flight_uuid = read_uint64(p);
    msg->flight_information.time_boot_ms = read_uint32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MOUNT_ORIENTATION:
    msg->mount_orientation.time_boot_ms = read_uint32(p);
    msg->mount_orientation.roll = read_float32(p);
    msg->mount_orientation.pitch = read_float32(p);
    msg->mount_orientation.yaw = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOGGING_DATA:
    msg->logging_data.sequence = read_uint16(p);
    msg->logging_data.target_system = read_byte(p);
    msg->logging_data.target_component = read_byte(p);
    msg->logging_data.length = read_byte(p);
    msg->logging_data.first_message_offset = read_byte(p);
    for (size_t i = 0; i < 249; i++)
      msg->logging_data.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOGGING_DATA_ACKED:
    msg->logging_data_acked.sequence = read_uint16(p);
    msg->logging_data_acked.target_system = read_byte(p);
    msg->logging_data_acked.target_component = read_byte(p);
    msg->logging_data_acked.length = read_byte(p);
    msg->logging_data_acked.first_message_offset = read_byte(p);
    for (size_t i = 0; i < 249; i++)
      msg->logging_data_acked.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LOGGING_ACK:
    msg->logging_ack.sequence = read_uint16(p);
    msg->logging_ack.target_system = read_byte(p);
    msg->logging_ack.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_VIDEO_STREAM_INFORMATION:
    msg->video_stream_information.framerate = read_float32(p);
    msg->video_stream_information.bitrate = read_uint32(p);
    msg->video_stream_information.flags = read_uint16(p);
    msg->video_stream_information.resolution_h = read_uint16(p);
    msg->video_stream_information.resolution_v = read_uint16(p);
    msg->video_stream_information.rotation = read_uint16(p);
    msg->video_stream_information.hfov = read_uint16(p);
    msg->video_stream_information.stream_id = read_byte(p);
    msg->video_stream_information.count = read_byte(p);
    msg->video_stream_information.type = read_byte(p);
    for (size_t i = 0; i < 32; i++)
      msg->video_stream_information.name[i] = read_byte(p);
    for (size_t i = 0; i < 160; i++)
      msg->video_stream_information.uri[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_VIDEO_STREAM_STATUS:
    msg->video_stream_status.framerate = read_float32(p);
    msg->video_stream_status.bitrate = read_uint32(p);
    msg->video_stream_status.flags = read_uint16(p);
    msg->video_stream_status.resolution_h = read_uint16(p);
    msg->video_stream_status.resolution_v = read_uint16(p);
    msg->video_stream_status.rotation = read_uint16(p);
    msg->video_stream_status.hfov = read_uint16(p);
    msg->video_stream_status.stream_id = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_WIFI_CONFIG_AP:

    for (size_t i = 0; i < 32; i++)
      msg->wifi_config_ap.ssid[i] = read_byte(p);
    for (size_t i = 0; i < 64; i++)
      msg->wifi_config_ap.password[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PROTOCOL_VERSION:
    msg->protocol_version.version = read_uint16(p);
    msg->protocol_version.min_version = read_uint16(p);
    msg->protocol_version.max_version = read_uint16(p);
    for (size_t i = 0; i < 8; i++)
      msg->protocol_version.spec_version_hash[i] = read_byte(p);
    for (size_t i = 0; i < 8; i++)
      msg->protocol_version.library_version_hash[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_UAVCAN_NODE_STATUS:
    msg->uavcan_node_status.time_usec = read_uint64(p);
    msg->uavcan_node_status.uptime_sec = read_uint32(p);
    msg->uavcan_node_status.vendor_specific_status_code = read_uint16(p);
    msg->uavcan_node_status.health = read_byte(p);
    msg->uavcan_node_status.mode = read_byte(p);
    msg->uavcan_node_status.sub_mode = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_UAVCAN_NODE_INFO:
    msg->uavcan_node_info.time_usec = read_uint64(p);
    msg->uavcan_node_info.uptime_sec = read_uint32(p);
    msg->uavcan_node_info.sw_vcs_commit = read_uint32(p);
    for (size_t i = 0; i < 80; i++)
      msg->uavcan_node_info.name[i] = read_byte(p);
    msg->uavcan_node_info.hw_version_major = read_byte(p);
    msg->uavcan_node_info.hw_version_minor = read_byte(p);
    for (size_t i = 0; i < 16; i++)
      msg->uavcan_node_info.hw_unique_id[i] = read_byte(p);
    msg->uavcan_node_info.sw_version_major = read_byte(p);
    msg->uavcan_node_info.sw_version_minor = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PARAM_EXT_REQUEST_READ:
    msg->param_ext_request_read.param_index = read_int16(p);
    msg->param_ext_request_read.target_system = read_byte(p);
    msg->param_ext_request_read.target_component = read_byte(p);
    for (size_t i = 0; i < 16; i++)
      msg->param_ext_request_read.param_id[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PARAM_EXT_REQUEST_LIST:
    msg->param_ext_request_list.target_system = read_byte(p);
    msg->param_ext_request_list.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PARAM_EXT_VALUE:
    msg->param_ext_value.param_count = read_uint16(p);
    msg->param_ext_value.param_index = read_uint16(p);
    for (size_t i = 0; i < 16; i++)
      msg->param_ext_value.param_id[i] = read_byte(p);
    for (size_t i = 0; i < 128; i++)
      msg->param_ext_value.param_value[i] = read_byte(p);
    msg->param_ext_value.param_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PARAM_EXT_SET:
    msg->param_ext_set.target_system = read_byte(p);
    msg->param_ext_set.target_component = read_byte(p);
    for (size_t i = 0; i < 16; i++)
      msg->param_ext_set.param_id[i] = read_byte(p);
    for (size_t i = 0; i < 128; i++)
      msg->param_ext_set.param_value[i] = read_byte(p);
    msg->param_ext_set.param_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PARAM_EXT_ACK:

    for (size_t i = 0; i < 16; i++)
      msg->param_ext_ack.param_id[i] = read_byte(p);
    for (size_t i = 0; i < 128; i++)
      msg->param_ext_ack.param_value[i] = read_byte(p);
    msg->param_ext_ack.param_type = read_byte(p);
    msg->param_ext_ack.param_result = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_OBSTACLE_DISTANCE:
    msg->obstacle_distance.time_usec = read_uint64(p);
    for (size_t i = 0; i < 72; i++)
      msg->obstacle_distance.distances[i] = read_uint16(p);
    msg->obstacle_distance.min_distance = read_uint16(p);
    msg->obstacle_distance.max_distance = read_uint16(p);
    msg->obstacle_distance.sensor_type = read_byte(p);
    msg->obstacle_distance.increment = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ODOMETRY:
    msg->odometry.time_usec = read_uint64(p);
    msg->odometry.x = read_float32(p);
    msg->odometry.y = read_float32(p);
    msg->odometry.z = read_float32(p);
    for (size_t i = 0; i < 4; i++)
      msg->odometry.q[i] = read_float32(p);
    msg->odometry.vx = read_float32(p);
    msg->odometry.vy = read_float32(p);
    msg->odometry.vz = read_float32(p);
    msg->odometry.rollspeed = read_float32(p);
    msg->odometry.pitchspeed = read_float32(p);
    msg->odometry.yawspeed = read_float32(p);
    for (size_t i = 0; i < 21; i++)
      msg->odometry.pose_covariance[i] = read_float32(p);
    for (size_t i = 0; i < 21; i++)
      msg->odometry.velocity_covariance[i] = read_float32(p);
    msg->odometry.frame_id = read_byte(p);
    msg->odometry.child_frame_id = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_TRAJECTORY_REPRESENTATION_WAYPOINTS:
    msg->trajectory_representation_waypoints.time_usec = read_uint64(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_waypoints.pos_x[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_waypoints.pos_y[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_waypoints.pos_z[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_waypoints.vel_x[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_waypoints.vel_y[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_waypoints.vel_z[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_waypoints.acc_x[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_waypoints.acc_y[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_waypoints.acc_z[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_waypoints.pos_yaw[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_waypoints.vel_yaw[i] = read_float32(p);
    msg->trajectory_representation_waypoints.valid_points = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_TRAJECTORY_REPRESENTATION_BEZIER:
    msg->trajectory_representation_bezier.time_usec = read_uint64(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_bezier.pos_x[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_bezier.pos_y[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_bezier.pos_z[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_bezier.delta[i] = read_float32(p);
    for (size_t i = 0; i < 5; i++)
      msg->trajectory_representation_bezier.pos_yaw[i] = read_float32(p);
    msg->trajectory_representation_bezier.valid_points = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CELLULAR_STATUS:
    msg->cellular_status.cid = read_uint32(p);
    msg->cellular_status.status = read_uint16(p);
    msg->cellular_status.mcc = read_uint16(p);
    msg->cellular_status.mnc = read_uint16(p);
    msg->cellular_status.lac = read_uint16(p);
    msg->cellular_status.type = read_byte(p);
    msg->cellular_status.quality = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ISBD_LINK_STATUS:
    msg->isbd_link_status.timestamp = read_uint64(p);
    msg->isbd_link_status.last_heartbeat = read_uint64(p);
    msg->isbd_link_status.failed_sessions = read_uint16(p);
    msg->isbd_link_status.successful_sessions = read_uint16(p);
    msg->isbd_link_status.signal_quality = read_byte(p);
    msg->isbd_link_status.ring_pending = read_byte(p);
    msg->isbd_link_status.tx_session_pending = read_byte(p);
    msg->isbd_link_status.rx_session_pending = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_UTM_GLOBAL_POSITION:
    msg->utm_global_position.time = read_uint64(p);
    msg->utm_global_position.lat = read_int32(p);
    msg->utm_global_position.lon = read_int32(p);
    msg->utm_global_position.alt = read_int32(p);
    msg->utm_global_position.relative_alt = read_int32(p);
    msg->utm_global_position.next_lat = read_int32(p);
    msg->utm_global_position.next_lon = read_int32(p);
    msg->utm_global_position.next_alt = read_int32(p);
    msg->utm_global_position.vx = read_int16(p);
    msg->utm_global_position.vy = read_int16(p);
    msg->utm_global_position.vz = read_int16(p);
    msg->utm_global_position.h_acc = read_uint16(p);
    msg->utm_global_position.v_acc = read_uint16(p);
    msg->utm_global_position.vel_acc = read_uint16(p);
    msg->utm_global_position.update_rate = read_uint16(p);
    for (size_t i = 0; i < 18; i++)
      msg->utm_global_position.uas_id[i] = read_byte(p);
    msg->utm_global_position.flight_state = read_byte(p);
    msg->utm_global_position.flags = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DEBUG_FLOAT_ARRAY:
    msg->debug_float_array.time_usec = read_uint64(p);
    msg->debug_float_array.array_id = read_uint16(p);
    for (size_t i = 0; i < 10; i++)
      msg->debug_float_array.name[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ORBIT_EXECUTION_STATUS:
    msg->orbit_execution_status.time_usec = read_uint64(p);
    msg->orbit_execution_status.radius = read_float32(p);
    msg->orbit_execution_status.x = read_int32(p);
    msg->orbit_execution_status.y = read_int32(p);
    msg->orbit_execution_status.z = read_float32(p);
    msg->orbit_execution_status.frame = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_STATUSTEXT_LONG:
    msg->statustext_long.severity = read_byte(p);
    for (size_t i = 0; i < 254; i++)
      msg->statustext_long.text[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SMART_BATTERY_INFO:
    msg->smart_battery_info.capacity_full_specification = read_int32(p);
    msg->smart_battery_info.capacity_full = read_int32(p);
    msg->smart_battery_info.serial_number = read_int32(p);
    msg->smart_battery_info.cycle_count = read_uint16(p);
    msg->smart_battery_info.weight = read_uint16(p);
    msg->smart_battery_info.discharge_minimum_voltage = read_uint16(p);
    msg->smart_battery_info.charging_minimum_voltage = read_uint16(p);
    msg->smart_battery_info.resting_minimum_voltage = read_uint16(p);
    msg->smart_battery_info.id = read_byte(p);
    for (size_t i = 0; i < 50; i++)
      msg->smart_battery_info.device_name[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SMART_BATTERY_STATUS:
    msg->smart_battery_status.fault_bitmask = read_int32(p);
    msg->smart_battery_status.time_remaining = read_int32(p);
    msg->smart_battery_status.id = read_uint16(p);
    msg->smart_battery_status.capacity_remaining = read_int16(p);
    msg->smart_battery_status.current = read_int16(p);
    msg->smart_battery_status.temperature = read_int16(p);
    msg->smart_battery_status.cell_offset = read_uint16(p);
    for (size_t i = 0; i < 16; i++)
      msg->smart_battery_status.voltages[i] = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ACTUATOR_OUTPUT_STATUS:
    msg->actuator_output_status.time_usec = read_uint64(p);
    msg->actuator_output_status.active = read_uint32(p);
    for (size_t i = 0; i < 32; i++)
      msg->actuator_output_status.actuator[i] = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_TIME_ESTIMATE_TO_TARGET:
    msg->time_estimate_to_target.safe_return = read_int32(p);
    msg->time_estimate_to_target.land = read_int32(p);
    msg->time_estimate_to_target.mission_next_item = read_int32(p);
    msg->time_estimate_to_target.mission_end = read_int32(p);
    msg->time_estimate_to_target.commanded_action = read_int32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_WHEEL_DISTANCE:
    msg->wheel_distance.time_usec = read_uint64(p);
    for (size_t i = 0; i < 16; i++)
      msg->wheel_distance.distance[i] = read_float64(p);
    msg->wheel_distance.count = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_UAVIONIX_ADSB_OUT_CFG:
    msg->uavionix_adsb_out_cfg.ICAO = read_uint32(p);
    msg->uavionix_adsb_out_cfg.stallSpeed = read_uint16(p);
    for (size_t i = 0; i < 9; i++)
      msg->uavionix_adsb_out_cfg.callsign[i] = read_byte(p);
    msg->uavionix_adsb_out_cfg.emitterType = read_byte(p);
    msg->uavionix_adsb_out_cfg.aircraftSize = read_byte(p);
    msg->uavionix_adsb_out_cfg.gpsOffsetLat = read_byte(p);
    msg->uavionix_adsb_out_cfg.gpsOffsetLon = read_byte(p);
    msg->uavionix_adsb_out_cfg.rfSelect = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_UAVIONIX_ADSB_OUT_DYNAMIC:
    msg->uavionix_adsb_out_dynamic.utcTime = read_uint32(p);
    msg->uavionix_adsb_out_dynamic.gpsLat = read_int32(p);
    msg->uavionix_adsb_out_dynamic.gpsLon = read_int32(p);
    msg->uavionix_adsb_out_dynamic.gpsAlt = read_int32(p);
    msg->uavionix_adsb_out_dynamic.baroAltMSL = read_int32(p);
    msg->uavionix_adsb_out_dynamic.accuracyHor = read_uint32(p);
    msg->uavionix_adsb_out_dynamic.accuracyVert = read_uint16(p);
    msg->uavionix_adsb_out_dynamic.accuracyVel = read_uint16(p);
    msg->uavionix_adsb_out_dynamic.velVert = read_int16(p);
    msg->uavionix_adsb_out_dynamic.velNS = read_int16(p);
    msg->uavionix_adsb_out_dynamic.VelEW = read_int16(p);
    msg->uavionix_adsb_out_dynamic.state = read_uint16(p);
    msg->uavionix_adsb_out_dynamic.squawk = read_uint16(p);
    msg->uavionix_adsb_out_dynamic.gpsFix = read_byte(p);
    msg->uavionix_adsb_out_dynamic.numSats = read_byte(p);
    msg->uavionix_adsb_out_dynamic.emergencyStatus = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_UAVIONIX_ADSB_TRANSCEIVER_HEALTH_REPORT:
    msg->uavionix_adsb_transceiver_health_report.rfHealth = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DEVICE_OP_READ:
    msg->device_op_read.request_id = read_uint32(p);
    msg->device_op_read.target_system = read_byte(p);
    msg->device_op_read.target_component = read_byte(p);
    msg->device_op_read.bustype = read_byte(p);
    msg->device_op_read.bus = read_byte(p);
    msg->device_op_read.address = read_byte(p);
    for (size_t i = 0; i < 40; i++)
      msg->device_op_read.busname[i] = read_byte(p);
    msg->device_op_read.regstart = read_byte(p);
    msg->device_op_read.count = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DEVICE_OP_READ_REPLY:
    msg->device_op_read_reply.request_id = read_uint32(p);
    msg->device_op_read_reply.result = read_byte(p);
    msg->device_op_read_reply.regstart = read_byte(p);
    msg->device_op_read_reply.count = read_byte(p);
    for (size_t i = 0; i < 128; i++)
      msg->device_op_read_reply.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DEVICE_OP_WRITE:
    msg->device_op_write.request_id = read_uint32(p);
    msg->device_op_write.target_system = read_byte(p);
    msg->device_op_write.target_component = read_byte(p);
    msg->device_op_write.bustype = read_byte(p);
    msg->device_op_write.bus = read_byte(p);
    msg->device_op_write.address = read_byte(p);
    for (size_t i = 0; i < 40; i++)
      msg->device_op_write.busname[i] = read_byte(p);
    msg->device_op_write.regstart = read_byte(p);
    msg->device_op_write.count = read_byte(p);
    for (size_t i = 0; i < 128; i++)
      msg->device_op_write.data[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DEVICE_OP_WRITE_REPLY:
    msg->device_op_write_reply.request_id = read_uint32(p);
    msg->device_op_write_reply.result = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ADAP_TUNING:
    msg->adap_tuning.desired = read_float32(p);
    msg->adap_tuning.achieved = read_float32(p);
    msg->adap_tuning.error = read_float32(p);
    msg->adap_tuning.theta = read_float32(p);
    msg->adap_tuning.omega = read_float32(p);
    msg->adap_tuning.sigma = read_float32(p);
    msg->adap_tuning.theta_dot = read_float32(p);
    msg->adap_tuning.omega_dot = read_float32(p);
    msg->adap_tuning.sigma_dot = read_float32(p);
    msg->adap_tuning.f = read_float32(p);
    msg->adap_tuning.f_dot = read_float32(p);
    msg->adap_tuning.u = read_float32(p);
    msg->adap_tuning.axis = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_VISION_POSITION_DELTA:
    msg->vision_position_delta.time_usec = read_uint64(p);
    msg->vision_position_delta.time_delta_usec = read_uint64(p);
    for (size_t i = 0; i < 3; i++)
      msg->vision_position_delta.angle_delta[i] = read_float32(p);
    for (size_t i = 0; i < 3; i++)
      msg->vision_position_delta.position_delta[i] = read_float32(p);
    msg->vision_position_delta.confidence = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_AOA_SSA:
    msg->aoa_ssa.time_usec = read_uint64(p);
    msg->aoa_ssa.AOA = read_float32(p);
    msg->aoa_ssa.SSA = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ESC_TELEMETRY_1_TO_4:

    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_1_to_4.voltage[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_1_to_4.current[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_1_to_4.totalcurrent[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_1_to_4.rpm[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_1_to_4.count[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_1_to_4.temperature[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ESC_TELEMETRY_5_TO_8:

    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_5_to_8.voltage[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_5_to_8.current[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_5_to_8.totalcurrent[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_5_to_8.rpm[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_5_to_8.count[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_5_to_8.temperature[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ESC_TELEMETRY_9_TO_12:

    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_9_to_12.voltage[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_9_to_12.current[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_9_to_12.totalcurrent[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_9_to_12.rpm[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_9_to_12.count[i] = read_uint16(p);
    for (size_t i = 0; i < 4; i++)
      msg->esc_telemetry_9_to_12.temperature[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ICAROUS_HEARTBEAT:
    msg->icarous_heartbeat.status = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ICAROUS_KINEMATIC_BANDS:
    msg->icarous_kinematic_bands.min1 = read_float32(p);
    msg->icarous_kinematic_bands.max1 = read_float32(p);
    msg->icarous_kinematic_bands.min2 = read_float32(p);
    msg->icarous_kinematic_bands.max2 = read_float32(p);
    msg->icarous_kinematic_bands.min3 = read_float32(p);
    msg->icarous_kinematic_bands.max3 = read_float32(p);
    msg->icarous_kinematic_bands.min4 = read_float32(p);
    msg->icarous_kinematic_bands.max4 = read_float32(p);
    msg->icarous_kinematic_bands.min5 = read_float32(p);
    msg->icarous_kinematic_bands.max5 = read_float32(p);
    msg->icarous_kinematic_bands.numBands = read_int8(p);
    msg->icarous_kinematic_bands.type1 = read_byte(p);
    msg->icarous_kinematic_bands.type2 = read_byte(p);
    msg->icarous_kinematic_bands.type3 = read_byte(p);
    msg->icarous_kinematic_bands.type4 = read_byte(p);
    msg->icarous_kinematic_bands.type5 = read_byte(p);
    break;
  };
}

static void read_payload_ext(const uint8_t **p,
                             struct ardupilotmega_message *msg) {
  switch (msg->msg_id) {

  case ARDUPILOTMEGA_MESSAGE_GPS_RAW_INT:
    msg->gps_raw_int.alt_ellipsoid = read_int32(p);
    msg->gps_raw_int.h_acc = read_uint32(p);
    msg->gps_raw_int.v_acc = read_uint32(p);
    msg->gps_raw_int.vel_acc = read_uint32(p);
    msg->gps_raw_int.hdg_acc = read_uint32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SERVO_OUTPUT_RAW:
    msg->servo_output_raw.servo9_raw = read_uint16(p);
    msg->servo_output_raw.servo10_raw = read_uint16(p);
    msg->servo_output_raw.servo11_raw = read_uint16(p);
    msg->servo_output_raw.servo12_raw = read_uint16(p);
    msg->servo_output_raw.servo13_raw = read_uint16(p);
    msg->servo_output_raw.servo14_raw = read_uint16(p);
    msg->servo_output_raw.servo15_raw = read_uint16(p);
    msg->servo_output_raw.servo16_raw = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_REQUEST_PARTIAL_LIST:
    msg->mission_request_partial_list.mission_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_WRITE_PARTIAL_LIST:
    msg->mission_write_partial_list.mission_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_ITEM:
    msg->mission_item.mission_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_REQUEST:
    msg->mission_request.mission_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_REQUEST_LIST:
    msg->mission_request_list.mission_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_COUNT:
    msg->mission_count.mission_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_CLEAR_ALL:
    msg->mission_clear_all.mission_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_ACK:
    msg->mission_ack.mission_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SET_GPS_GLOBAL_ORIGIN:
    msg->set_gps_global_origin.time_usec = read_uint64(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GPS_GLOBAL_ORIGIN:
    msg->gps_global_origin.time_usec = read_uint64(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_REQUEST_INT:
    msg->mission_request_int.mission_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_RC_CHANNELS_OVERRIDE:
    msg->rc_channels_override.chan9_raw = read_uint16(p);
    msg->rc_channels_override.chan10_raw = read_uint16(p);
    msg->rc_channels_override.chan11_raw = read_uint16(p);
    msg->rc_channels_override.chan12_raw = read_uint16(p);
    msg->rc_channels_override.chan13_raw = read_uint16(p);
    msg->rc_channels_override.chan14_raw = read_uint16(p);
    msg->rc_channels_override.chan15_raw = read_uint16(p);
    msg->rc_channels_override.chan16_raw = read_uint16(p);
    msg->rc_channels_override.chan17_raw = read_uint16(p);
    msg->rc_channels_override.chan18_raw = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MISSION_ITEM_INT:
    msg->mission_item_int.mission_type = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_COMMAND_ACK:
    msg->command_ack.result_param2 = read_int32(p);
    msg->command_ack.progress = read_byte(p);
    msg->command_ack.target_system = read_byte(p);
    msg->command_ack.target_component = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_OPTICAL_FLOW:
    msg->optical_flow.flow_rate_x = read_float32(p);
    msg->optical_flow.flow_rate_y = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_GLOBAL_VISION_POSITION_ESTIMATE:
    for (size_t i = 0; i < 21; i++)
      msg->global_vision_position_estimate.covariance[i] = read_float32(p);
    msg->global_vision_position_estimate.reset_counter = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_VISION_POSITION_ESTIMATE:
    for (size_t i = 0; i < 21; i++)
      msg->vision_position_estimate.covariance[i] = read_float32(p);
    msg->vision_position_estimate.reset_counter = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_VISION_SPEED_ESTIMATE:
    for (size_t i = 0; i < 9; i++)
      msg->vision_speed_estimate.covariance[i] = read_float32(p);
    msg->vision_speed_estimate.reset_counter = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_VICON_POSITION_ESTIMATE:
    for (size_t i = 0; i < 21; i++)
      msg->vicon_position_estimate.covariance[i] = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DISTANCE_SENSOR:
    msg->distance_sensor.horizontal_fov = read_float32(p);
    msg->distance_sensor.vertical_fov = read_float32(p);
    for (size_t i = 0; i < 4; i++)
      msg->distance_sensor.quaternion[i] = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ATT_POS_MOCAP:
    for (size_t i = 0; i < 21; i++)
      msg->att_pos_mocap.covariance[i] = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_BATTERY_STATUS:
    msg->battery_status.time_remaining = read_int32(p);
    msg->battery_status.charge_state = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_AUTOPILOT_VERSION:
    for (size_t i = 0; i < 18; i++)
      msg->autopilot_version.uid2[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_LANDING_TARGET:
    msg->landing_target.x = read_float32(p);
    msg->landing_target.y = read_float32(p);
    msg->landing_target.z = read_float32(p);
    for (size_t i = 0; i < 4; i++)
      msg->landing_target.q[i] = read_float32(p);
    msg->landing_target.type = read_byte(p);
    msg->landing_target.position_valid = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MEMINFO:
    msg->meminfo.freemem32 = read_uint32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CAMERA_FEEDBACK:
    msg->camera_feedback.completed_captures = read_uint16(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MAG_CAL_REPORT:
    msg->mag_cal_report.orientation_confidence = read_float32(p);
    msg->mag_cal_report.old_orientation = read_byte(p);
    msg->mag_cal_report.new_orientation = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_EKF_STATUS_REPORT:
    msg->ekf_status_report.airspeed_variance = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_HOME_POSITION:
    msg->home_position.time_usec = read_uint64(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_SET_HOME_POSITION:
    msg->set_home_position.time_usec = read_uint64(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_PLAY_TUNE:
    for (size_t i = 0; i < 200; i++)
      msg->play_tune.tune2[i] = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_CAMERA_SETTINGS:
    msg->camera_settings.zoomLevel = read_float32(p);
    msg->camera_settings.focusLevel = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_MOUNT_ORIENTATION:
    msg->mount_orientation.yaw_absolute = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_OBSTACLE_DISTANCE:
    msg->obstacle_distance.increment_f = read_float32(p);
    msg->obstacle_distance.angle_offset = read_float32(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_ODOMETRY:
    msg->odometry.reset_counter = read_byte(p);
    break;

  case ARDUPILOTMEGA_MESSAGE_DEBUG_FLOAT_ARRAY:
    for (size_t i = 0; i < 58; i++)
      msg->debug_float_array.data[i] = read_float32(p);
    break;

  default:; // nix
  };
}

size_t ardupilotmega_message_deserialize(const uint8_t *buf, size_t size,
                                         struct ardupilotmega_message *msg) {
  if (size < 3) {
    return 0;
  }
  switch (buf[0]) {
  case 0xFE:
    if (size < 9 + buf[1]) {
      return 0;
    }
    break;
  case 0xFD:
    if (size < 12 + buf[1] + ((buf[2] & 0x1) ? 13 : 0)) {
      return 0;
    }
    break;
  default:
    return 0;
  }

  const uint8_t *p = buf + 1;

  msg->len = *p++;

  if (buf[0] == 0xFD) {
    p += 2; // skip incompat + compat flags
  }

  msg->seq_dropped =
      *p++ - 1 -
      (uint8_t)(msg->seq_nr); // add difference in least significant byte
  msg->seq_nr += 1 + msg->seq_dropped;

  msg->sys_id = *p++;
  msg->comp_id = *p++;
  msg->msg_id = *p++;
  if (buf[0] == 0xFD) {
    msg->msg_id |= (uint32_t)(*p++) << 8;
    msg->msg_id |= (uint32_t)(*p++) << 16;
  }

  uint8_t tmp[256];
  memset(tmp, 0, sizeof tmp);
  memmove(tmp, p, msg->len);
  p += msg->len;

  uint16_t crc = 0xffff;
  for (const uint8_t *pp = buf + 1; pp < p; ++pp) {
    crc = x25(crc, *pp);
  }
  crc = x25(crc, ardupilotmega_crcextra(msg->msg_id));

  crc ^= *p++;
  crc ^= *p++ << 8;
  msg->crc = crc; // should be zero now

  const uint8_t *q = tmp;
  read_payload_base(&q, msg);
  if (buf[0] == 0xFD) {
    read_payload_ext(&q, msg);
  }
  assert(q - tmp < sizeof tmp);

  msg->link_id = 0;
  if ((buf[0] == 0xFD) && (buf[2] & 0x1)) {
    msg->link_id = *p++;
    msg->timestamp = read_uint16(&p);
    msg->timestamp |= read_uint32(&p) << 16;
    msg->signature = read_uint16(&p);
    msg->signature |= read_uint32(&p) << 16;
  }

  return p - buf;
}

size_t ardupilotmega_message_seek(const uint8_t *buf, size_t size) {
  for (size_t r = 0; r < size; r++) {
    switch (buf[r]) {
    case 0xFD:
    case 0xFE:
      return r;
    }
  }
  return size;
}
